<nz-layout style="height:100%;">
    <nz-header style="padding:0 !important;">
        <div style="float:left;margin-right:20px;">
            <div class="logo">
                <img height="35" src="assets/images/logo/logo.png" style="margin:0 0 20px 15px;">
            </div>
            <!--
            <a (click)="searchToggle()">
                <i nz-icon nzType="search" theme="outline" style="font-size:20px;margin: 0 20px;color:white;"></i>
            </a>
            -->
            <!--
            <nz-drawer [nzWidth]="380" nzTitle="Search" [nzVisible]="searchVisible" nzPlacement="left"
                (nzOnClose)="searchToggle()">
                <app-search></app-search>
            </nz-drawer>
            -->
        </div>
        <ul nz-menu nzTheme="light" nzMode="horizontal"
            [ngStyle]="{'background-color': (authenticatedUser$ | async)?.settings.themeColor.bgColor, 'color': (authenticatedUser$ | async)?.settings.themeColor.primary }">
            <li nz-menu-item nzMatchRouter>
                <a routerLink="/home" routerLinkActive="active-link">
                    Home
                </a>
            </li>
            <li nz-menu-item nzMatchRouter class="nav-badge">
                <a routerLink="/mytrainings" routerLinkActive="active-link">
                    My Trainings
                </a>
            </li>
            <li *ngIf="(authenticatedUser$ | async)?.userType === 'supervisor'" nz-menu-item nzMatchRouter
                class="nav-badge">
                <a routerLink="/myteam" routerLinkActive="active-link">
                    My Team
                </a>
            </li>
            <li *ngIf="(authenticatedUser$ | async)?.userType === 'supervisor' || (authenticatedUser$ | async)?.teamAdmin"
                nz-menu-item nzMatchRouter>
                <a routerLink="/trainings" routerLinkActive="active-link">
                    All Trainings
                </a>
            </li>
            <!--
            <li 
                nz-menu-item nzMatchRouter>
                <a routerLink="/docs" routerLinkActive="active-link">
                    Docs
                </a>
            </li>
            -->
            <li nz-menu-item class="navbar-rhs">
                <span class=" pointer" nz-dropdown [nzDropdownMenu]="profile" [nzTrigger]="'click'"
                    [nzPlacement]="'bottomRight'">
                    <nz-avatar [nzText]="(authenticatedUser$ | async)?.firstName"
                        [ngStyle]="{'background-color': (authenticatedUser$ | async)?.settings.themeColor.secondary, 'color': (authenticatedUser$ | async)?.settings.themeColor.primary}">
                    </nz-avatar>
                </span>
                <nz-dropdown-menu #profile="nzDropdownMenu">
                    <ul nz-menu class="p-b-15 p-t-20">
                        <li class="p-h-20 p-b-15 m-b-10 border-bottom">
                            <div class="d-flex m-r-50">
                                <div class="m-l-10">
                                    <p class="m-b-0 text-dark font-weight-semibold">
                                        {{(authenticatedUser$ | async)?.firstName}}
                                        {{(authenticatedUser$ | async)?.lastName}} </p>
                                </div>
                            </div>
                        </li>
                        <li nz-menu-item>
                            <a class="p-v-5 d-flex align-items-center justify-content-between">
                                <div (click)="userPanelVisible = true">
                                    <i class="" nz-icon nzType="user" theme="outline"
                                        style="vertical-align: baseline;font-size:20px;"></i>
                                    <span class="m-l-10">Edit Profile</span>
                                </div>
                            </a>
                        </li>
                        <li nz-menu-item (click)="logout()">
                            <a class="p-v-5 d-flex align-items-center justify-content-between">
                                <div>
                                    <i class="" nz-icon nzType="logout" theme="outline"
                                        style="vertical-align: baseline;font-size:20px;color:#bbbbbb;"></i>
                                    <span class="m-l-10">Logout</span>
                                </div>
                            </a>
                        </li>
                    </ul>
                </nz-dropdown-menu>
            </li>
            <li class="navbar-rhs" nz-tooltip nzTooltipTitle="Settings" nzTooltipPlacement="bottomLeft">
                <a (click)="quickViewToggle()">
                    <i nz-icon nzType="setting" theme="outline" style="font-size:20px;color:#000000;"></i>
                </a>
            </li>
            <!--
            <li nz-menu-item class="navbar-rhs" nz-tooltip nzTooltipTitle="Notifications"
                nzTooltipPlacement="bottomLeft">
                <a nz-dropdown nzTrigger="click" [nzDropdownMenu]="popNotification" [nzPlacement]="'bottomRight'">
                    <nz-badge nzDot>
                        <i nz-icon nzType="notification" theme="outline" style="font-size:20px;color:#000000;"></i>
                    </nz-badge>
                </a>
                <nz-dropdown-menu #popNotification="nzDropdownMenu">
                    <div nz-menu class="pop-notification">
                        <div class="p-v-15 p-h-25 border-bottom d-flex justify-content-between align-items-center">
                            <p class="text-dark font-weight-semibold m-b-0">
                                <i nz-icon nzType="bell" theme="outline"></i>
                                <span class="m-l-10">Notification</span>
                            </p>
                            <a nz-button nz-button nzSize="small" class="p-v-5" [routerLink]="''">
                                <small>View All</small>
                            </a>
                        </div>
                        <perfect-scrollbar class="overflow-y-auto" style="max-height: 300px">
                            <nz-list class="ant-list-item-links" [nzDataSource]="notificationList" [nzRenderItem]="item"
                                [nzItemLayout]="'horizontal'">
                                <ng-template #item let-item>
                                    <nz-list-item>
                                        <a [routerLink]="''">
                                            <div class="d-flex">
                                                <nz-avatar [nzIcon]="item.icon" [ngClass]="item.color"></nz-avatar>
                                                <div class="m-l-15">
                                                    <p class="m-b-0 text-dark">{{item.title}}</p>
                                                    <p class="m-b-0"><small>{{item.time}} ago</small></p>
                                                </div>
                                            </div>
                                        </a>
                                    </nz-list-item>
                                </ng-template>
                            </nz-list>
                        </perfect-scrollbar>
                    </div>
                </nz-dropdown-menu>
            </li>

            <li class="navbar-rhs" nz-tooltip nzTooltipTitle="Task Tutorials" nzTooltipPlacement="bottom">
                <a (click)="playTaskVideo(null)">
                    <i nz-icon nzType="youtube" theme="outline" style="font-size:20px;margin:0 5px;color:#000000;"></i>
                </a>
                <nz-drawer *ngIf="authenticatedUser$ | async as user" [nzWidth]="300" nzTitle="App Settings"
                    [nzClosable]="false" [nzVisible]="quickViewVisible" nzPlacement="right"
                    (nzOnClose)="quickViewToggle()">
                    <app-settings></app-settings>
                </nz-drawer>
            </li>
            -->
            <!--
            <li class="navbar-rhs" nz-tooltip nzTooltipTitle="Update Training Status" nzTooltipPlacement="bottom">
                <a (click)="runStatusCheck()">
                    <i class="far fa-clipboard-list-check" style="font-size:20px;margin:0 5px;color:#000000;vertical-align: middle;"></i>
                </a>
            </li>
            -->
        </ul>
        <!--
        <nz-alert nzType="error" [nzMessage]="currentHttpError" nzBanner="true"></nz-alert>
        -->
    <ng-template #httpError >

    </ng-template>
        
    </nz-header>
    <nz-content class="inner-content">
        <div *ngIf="(authenticatedUser && authenticatedUser.firstName !== '') && aboutThisPageHash[currentPage]">
            <i *ngIf="!aboutThisPageHash[currentPage].visible" nz-icon nzType="info-circle" [nzTheme]="'twotone'"
                (click)="aboutThisPageHash[currentPage].visible = true" nz-tooltip nzTooltipTitle="About This Page"
                style="font-size:20px;font-weight: 500;cursor:pointer;margin-bottom:20px;"></i>
            <div *ngIf="((authenticatedUser$ | async)?.settings.showPageInfo && aboutThisPageHash[currentPage].visible)"
                style="padding:20px;position:relative;margin-bottom:20px;" class="about-this-page">
                <div>
                    <!--
                    <i nz-icon nzType="info-circle" [nzTheme]="'twotone'" nz-tooltip nzTooltipTitle="About This Page"
                        style="position:absolute;font-size:20px;font-weight: 500;"></i>
                        -->
                    <div style="text-align: center;font-size:20px;font-weight: 400;color: blue;">
                        About This Page
                    </div>
                    <i nz-icon nzType="close-circle" [nzTheme]="'twotone'" [nzTwotoneColor]="'#f74848'"
                        (click)="aboutThisPageHash[currentPage].visible = false"
                        style="position:absolute;top:20px;right:20px;font-size:20px;font-weight: 500;cursor:pointer;"></i>
                </div>
                <div style="font-size:16px;font-weight: 300;padding:20px 40px">
                    <div>
                        {{aboutThisPageHash[currentPage].intro}}
                    </div>
                    <div style="margin:20px 0;color:blue;font-size:16px;">
                        Tasks
                    </div>
                    <div *ngIf="authenticatedUser$ | async as user" style="margin-bottom:20px;padding-left:20px;">
                        <ul style="list-style-type: none;">
                            <li *ngFor="let taskName of taskNames" style="margin-bottom: 10px;">
                                <div
                                    *ngIf="aboutThisPageHash[currentPage].taskHash[taskName].userType.includes(user.userType)">
                                    <i nz-icon nzType="youtube" [nzTheme]="'outline'" nz-tooltip
                                        nzTooltipTitle="Play the task How-To video" (click)="playTaskVideo(taskName)"
                                        style="cursor:pointer;font-size:24px;vertical-align: top;margin-left:20px;color:#52c41a;"></i>
                                    &nbsp;&nbsp;{{aboutThisPageHash[currentPage].taskHash[taskName].desc}}
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!--
            <nz-modal [(nzVisible)]="showTaskVideoModal" nzWidth="700" nzHeight="800" nzTitle="Task Viewer" nzOkText="Close"
                nzCancelDisabled="true" (nzOnOk)="closeTaskVideoModal()" style="text-align: center;">
                -->
            <div [@showVideo]="isVideoOpen ? 'open' : 'closed'"
                style="position: absolute;top:-100%; left: 0;right:0;height:100%;z-index:10;background-color:rgba(0,0,0,0.7);text-align: center;">
                <div
                    style="height:fit-content;width:fit-content;z-index:10;display:inline-block;margin-top:100px;background-color: #f5f5f5;">
                    <div style="display:block;width:100%;padding:10px;">
                        <span style="font-size:18px;">Task Tutorials</span>
                        <i nz-icon nzType="close-circle" [nzTheme]="'outline'" (click)="isVideoOpen = false"
                            style="font-size:20px;font-weight: 200;cursor:pointer;float:right;"></i>
                    </div>
                    <div *ngIf="authenticatedUser$ | async as user"
                        style="text-align: left;float:left;min-width:300px;max-height:500px;overflow:scroll;">
                        <nz-collapse nzBordered="true" nzAccordion="true">
                            <nz-collapse-panel *ngFor="let pageName of pageNames"
                                [nzHeader]="aboutThisPageHash[pageName].title" [nzActive]="currentPage === pageName"
                                style="">
                                <div *ngFor="let taskName of pageTaskHash[pageName]; index as i" style="padding:5px;"
                                    (click)="playTaskVideo(taskName)"
                                    [ngClass]="{'current-task': taskName === currentTask}" class="task">
                                    <div
                                        *ngIf="aboutThisPageHash[pageName].taskHash[taskName].userType.includes(user.userType)">
                                        <i nz-icon nzType="youtube" [nzTheme]="'outline'" nz-tooltip
                                            nzTooltipTitle="Play the task How-To video"
                                            style="cursor:pointer;font-size:24px;vertical-align: top;color:#52c41a;"></i>
                                        &nbsp;&nbsp;
                                        <span>{{aboutThisPageHash[pageName].taskHash[taskName].desc}}</span>
                                    </div>
                                </div>
                            </nz-collapse-panel>
                        </nz-collapse>
                    </div>
                    <div *ngIf="aboutThisPageHash[currentPage] && aboutThisPageHash[currentPage].taskHash[currentTask]"
                        style="text-align: center;float:right;">
                        <!--
                        <div style="padding:10px;">
                            <span style="font-size:16px;float:left;color:white;">
                                Task : {{aboutThisPageHash[currentPage].taskHash[currentTask].desc}}
                            </span>
                        </div>
                        -->
                        <div style="background-color: #000000;width:600px;height:500px;">
                            <vg-player (onPlayerReady)="onPlayerReady($event)">
                                <vg-controls>
                                    <vg-play-pause></vg-play-pause>
                                    <vg-playback-button></vg-playback-button>
                                    <vg-time-display vgProperty="current" vgFormat="mm:ss"></vg-time-display>

                                    <vg-scrub-bar>
                                        <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                        <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                                    </vg-scrub-bar>

                                    <vg-time-display vgProperty="left" vgFormat="mm:ss"></vg-time-display>
                                    <vg-time-display vgProperty="total" vgFormat="mm:ss"></vg-time-display>

                                    <vg-mute></vg-mute>
                                    <vg-volume></vg-volume>

                                    <vg-fullscreen></vg-fullscreen>
                                </vg-controls>
                                <video style="background-color: #dddddd;" [vgMedia]="media" #media id="singleVideo"
                                    preload="none" [src]="(taskBS$ | async)?.safeUrl" crossorigin
                                    [poster]="(taskBS$ | async)?.poster">
                                </video>
                            </vg-player>
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                </div>
            </div>
            <!--
            </nz-modal>
            -->
            <ng-template #taskVideoTemplate>
            </ng-template>
        </div>
        <router-outlet [ngStyle]="{'height.px': browserInnerHeight - 64}"></router-outlet>
        <nz-modal nzWidth="600" [(nzVisible)]="showNewUserModal" nzCancelDisabled="true" nzClosable="false"
            nzTitle="Welcome!" (nzOnOk)="saveName()">
            <div style="padding:20px;color:#000000;">
                <div style="text-align: center;">
                    <h3>Welcome to <span style="color:red;">my</span>Training<span style="color:red;">docs</span>!</h3>
                </div>
                <br>

                <div style="font-size:16px;color:black;">
                    Before we get started, you should be familiar with 2 icons that can help answer questions you might
                    have
                    along the way.
                </div>
                <br>
                <p>
                    <span style="color:#000000;">
                        <i nz-icon nzType="question-circle" nzTheme="twotone"
                            style="margin-left:30px;font-size:20px;"></i>
                        &nbsp;&nbsp;
                        Gives you a tour of the page
                        <br>
                        <i nz-icon nzType="youtube" nzTheme="outline"
                            style="margin-top:10px;color:blue;margin-left:30px;font-size:20px;"></i> &nbsp;&nbsp;
                        Screencasts of common
                        tasks
                        <br>
                        <br>
                        <div>
                            So, let's get started! Oh, one more bit of housekeeping...
                        </div>
                    </span>

            </div>
            <div *ngIf="authenticatedUser$ | async as user" style="background-color: white;">
                <div style="display:block;margin-bottom:10px;width:100%;">
                    <label style="display:inline-block;text-align: right;width:20%;padding-right:10px;">First
                        Name</label>
                    <input style="display:inline-block;width:80%;" nz-input type="text" placeholder="First Name"
                        ngDefaultControl [(ngModel)]="fName">
                </div>
                <div style="display:block;margin-bottom:10px;width:100%;">
                    <label style="display:inline-block;text-align: right;width:20%;padding-right:10px;">Last
                        Name</label>
                    <input style="display:inline-block;width:80%;" nz-input type="text" placeholder="Last Name"
                        ngDefaultControl [(ngModel)]="lName">
                </div>

            </div>
        </nz-modal>
        <nz-drawer *ngIf="authenticatedUser$ | async as user" nzWidth="500px" nzTitle="App Settings"
            [nzClosable]="false" [nzVisible]="quickViewVisible" nzPlacement="right" (nzOnClose)="quickViewToggle()">
            <app-settings></app-settings>
        </nz-drawer>
    </nz-content>
    <!--
    <nz-footer class="footer">Copyright ©2020 Teknetium, LLC</nz-footer>
    -->
    <nz-drawer [nzClosable]="false" [nzMaskClosable]="true" [nzVisible]="userPanelVisible" nzPlacement="right"
        nzTitle="User Profile" [nzWidth]="700">
        <div *ngIf="authenticatedUser" style="display:block;width:100%;">
            <div style="display:block;width:90%;">
                <div style="display:inline-block;width:25%;text-align: right;">
                    <label style="font-size:14px;color:#000000;">
                        First Name
                    </label>
                </div>
                <div style="display:inline-block;width:70%;margin-left:20px;">
                    <input nz-input nzSize="small" type="text" placeholder="First Name" ngDefaultControl
                        [(ngModel)]="authenticatedUser.firstName" style="margin-bottom:2px;">
                </div>
            </div>
            <div style="display:block;width:90%;">
                <div style="display:inline-block;width:25%;text-align: right;">
                    <label style="font-size:14px;color:#000000;">
                        Last Name
                    </label>
                </div>
                <div style="display:inline-block;width:70%;margin-left:20px;">
                    <input nz-input nzSize="small" type="text" placeholder="Last Name" ngDefaultControl
                        [(ngModel)]="authenticatedUser.lastName" style="margin-bottom:2px;">
                </div>
            </div>
            <div style="display:block;width:90%;">
                <div style="display:inline-block;width:25%;text-align: right;">
                    <label style="font-size:14px;color:#000000;">
                        Email
                    </label>
                </div>
                <div style="display:inline-block;width:70%;margin-left:20px;">
                    <!--
                    <input nz-input nzSize="small" type="text" placeholder="Email" ngDefaultControl
                        [(ngModel)]="authenticatedUser.email" style="margin-bottom:2px;">
                        -->
                        <nz-input-group [nzSuffix]="suffixTemplate">
                            <input nz-input nzSize="small" type="text" placeholder="Email" ngDefaultControl [(ngModel)]="currentEmail"
                                (ngModelChange)="checkUniqueEmail($event)" style="margin-bottom:2px;" (keydown.enter)="checkUniqueEmail($event)"
                                (blur)="checkUniqueEmail($event)">
                        </nz-input-group>
                        <ng-template #suffixTemplate>
                            <span *ngIf="!emailUnique" style="font-size:10px;">email taken</span>
                            <span *ngIf="emailUnique" style="font-size:10px;">email available</span>
                        </ng-template>
                </div>
            </div>
            <!--
            <div style="display:block;width:90%;">
                <div style="display:inline-block;width:25%;text-align: right;">
                    <label style="font-size:14px;color:#000000;">
                        Job Title
                    </label>
                </div>
                <div style="display:inline-block;width:70%;margin-left:20px;">
                    <input style="margin-bottom:2px;" placeholder="Job Title" nz-input
                        [(ngModel)]="selectedUser.jobTitle" ngDefaultControl nzSize="small"
                        (ngModelChange)="onJobTitleChange($event)" [nzAutocomplete]="auto"
                        (keydown.enter)="setJobTitle($event)" (blur)="setJobTitle($event)" />
                    <nz-autocomplete [nzDataSource]="matchingJobTitles" #auto></nz-autocomplete>
                </div>
            </div>
            -->
            <div style="display:block;margin-top:20px;width:90%;text-align: center;">
                <div style="display:inline-block;width:60%;">
                    <button nz-button nzSize="small" nzShape="round" (click)="handleUpdateUserCancel()" nzType="default"
                        style="margin: 10px;display:inline-block;">Cancel
                    </button>
                    <button *ngIf="authenticatedUser" nz-button nzSize="small" nzShape="round"
                        (click)="handleUpdateUser()" [disabled]="!emailUnique" nzType="primary" style="margin: 10px;display:inline-block;">Update
                        User
                    </button>
                </div>
            </div>
        </div>
    </nz-drawer>
</nz-layout>