<div *ngIf="authenticatedUser" style="height:100%;">
    <div style="position:relative;width:100%;height:100%;">
        <div
            style="position:relative;margin-left:-20px;margin-top:-20px;margin-right:-20px;background-color: #f1f1f1;border:1px solid #dddddd;padding:10px;">
            <div>
                <div style="float:left;">
                    <div style="float:left;">
                        <button nz-button nzShape="round" (click)="launchImporter()" nzType="primary">
                            Add Users
                        </button>
                    </div>
                    <div *ngIf="authenticatedUser.appAdmin && authenticatedUser.settings.showCSV" style="float:left;">
                        <button nz-button nzShape="round" (click)="testBulkAdd()" nzType="primary"
                            style="display:inline-block;">
                            Test
                        </button>
                        <button nz-button nzShape="round" (click)="createCSV()" nzType="primary"
                            style="display:inline-block;">
                            CSV
                        </button>
                        <div style="display:inline-block;">
                            Max Depth
                            <nz-input-number [(ngModel)]="maxLevel" [nzMin]="1" [nzMax]="10" [nzStep]="1">
                            </nz-input-number>
                        </div>
                        <div style="display:inline-block;">
                            User Min
                            <nz-input-number [(ngModel)]="userMin" [nzMin]="1" [nzMax]="10" [nzStep]="1">
                            </nz-input-number>
                        </div>
                        <div style="display:inline-block;">
                            User Max
                            <nz-input-number [(ngModel)]="userMax" [nzMin]="1" [nzMax]="10" [nzStep]="1">
                            </nz-input-number>
                        </div>
                    </div>
                    <!--
                    <button nz-button nzShape="round" (click)="deleteAllUsers()" nzType="primary"
                        style="float:left;margin-right:10px;">
                        Delete All Users
                    </button>
                    -->
                    <div style="float:left;margin-left:20px;" joyrideStep="Step3-myTeam" stepPosition="right"
                        title="User Search" text="Search for a user in your organization.">
                        <div style="display:inline-block;">
                            <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                                <input type="text" nzSize="small" nz-input placeholder="input search text"
                                    [(ngModel)]="userNameToSearchFor" (ngModelChange)="onUserSearchChange($event)"
                                    [nzAutocomplete]="autoUserSearch" />
                            </nz-input-group>
                            <nz-autocomplete [nzDataSource]="matchingUsers" #autoUserSearch></nz-autocomplete>
                            <ng-template #suffixIconButton>
                                <button nz-button nzType="primary" nzSearch><i nz-icon nzType="search"></i></button>
                            </ng-template>
                        </div>
                    </div>
                </div>
                <div style="float:right;margin-left:20px;">
                    <nz-radio-group [(ngModel)]="showOrgChart" (ngModelChange)="toggleMainView($event)">
                        <label nz-radio-button nzValue="true" nz-tooltip nzTooltipTitle="Org Chart"><i nz-icon
                                nzType="apartment" nzTheme="outline" style="font-size:16px;"></i></label>
                        <label nz-radio-button nzValue="false" nz-tooltip nzTooltipTitle="List"><i nz-icon
                                nzType="unordered-list" nzTheme="outline" style="font-size:16px;"></i></label>
                    </nz-radio-group>
                </div>
                <div style="clear:both;"></div>
                <textarea *ngIf="test" style="display:block;width:100%;" rows="10" nz-input ngDefaultControl
                    [(ngModel)]="usersCSV"></textarea>
            </div>
            <div *ngIf="showOrgChart === 'true' "
                style="position:absolute;top:70px;right:20px;text-align: center;font-size:24px;margin-bottom:20px;z-index:1;"
                joyrideStep="Step1-orgChart" stepPosition="top" title="Org Chart"
                text="If you have a large organization, you are going to love this feature.  Don't be shy...click around and see what there is to see.">
            </div>
        </div>
        <!--
            <i nz-icon nzType="question-circle" nzTheme="twotone"
                style="cursor:pointer;position:absolute;top:80px;left:20;font-size:20px;color:#000000;"
                (click)="startTour('orgChart')" nz-tooltip nzTooltipTitle="A little help"></i>
                -->
        <div *ngIf="showOrgChart === 'true'" style="position:relative;z-index:1;">
            <div style="position:absolute;top:10px;left:0;width:100%">
                <div style="float:left;">
                    <span style="display:block;font-size:14px;font-weight:500;">Highlight</span>
                    <nz-select [(ngModel)]="legend" nzAllowClear [nzOptionHeightPx]="600" [nzOptionOverflowSize]="600"
                        nzPlaceHolder="Select Item To Highlight" style="width:300px;"
                        [nzCustomTemplate]="defaultTemplate" (ngModelChange)="setHighlightItem($event)">
                        <!--
                        <nz-option nzCustomContent nzValue="fas fa-flower-tulip" nzLabel="Clear Highlight">
                            <i class="fas fa-flower-tulip"
                                style="font-size:14px;color:orange;z-index:1;display:inline-block;margin-right:10px;"></i>
                            <span style="font-size:12px;">Clear Highlight</span>
                        </nz-option>
                        -->
                        <nz-option-group nzLabel="User Type">
                            <nz-option nzCustomContent nzValue="individualContributor" nzLabel="Individual Contributor">
                                <i class="fas fa-user"
                                    style="font-size:14px;color:#000000;z-index:1;display:inline-block;margin-right:10px;"></i>
                                <span style="font-size:12px;">Individual Contributor</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="supervisor" nzLabel="Supervisor">
                                <i class="fas fa-user-tie"
                                    style="font-size:14px;color:#000000;z-index:1;display:inline-block;margin-right:10px;"></i>
                                <span style="font-size:12px;">Supervisor</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="volunteer" nzLabel="Volunteer">
                                <i class="fas fa-user-cowboy"
                                    style="font-size:14px;color:#000000;z-index:1;display:inline-block;margin-right:10px;"></i>
                                <span style="font-size:12px;">Volunteer</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="customer" nzLabel="Customer">
                                <i class="fas fa-user-crown"
                                    style="font-size:14px;color:#000000;z-index:1;display:inline-block;margin-right:10px;"></i>
                                <span style="font-size:12px;">Customer</span>
                            </nz-option>
                        </nz-option-group>
                        <nz-option-group nzLabel="User Data Error">
                            <nz-option nzCustomContent nzValue="badEmail" nzLabel="Bad Email">
                                <i class="fas fa-at"
                                    style="font-size:14px;color:red;z-index:1;display:inline-block;line-height:18px;margin-right:10px;">
                                </i>
                                <span style="font-size:12px;">Bad Email</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="unknownSupervisor" nzLabel="Supervisor Not Found">
                                <i class="fas fa-user-tie"
                                    style="font-size:14px;color:red;z-index:1;display:inline-block;line-height:18px;margin-right:10px;">
                                </i>
                                <span style="font-size:12px;">No Supervisor Found</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="accountPending" nzLabel="User Account Pending">
                                <i class="fas fa-exclamation-triangle"
                                    style="font-size:14px;color:red;z-index:1;display:inline-block;line-height:18px;margin-right:10px;">
                                </i>
                                <span style="font-size:12px;">User Account Pending</span>
                            </nz-option>
                        </nz-option-group>
                        <nz-option-group nzLabel="User Training Status">
                            <nz-option nzCustomContent nzValue="none" nzLabel="No Trainings Assigned">
                                <i class="fas fa-user"
                                    style="font-size:14px;color:#000000;z-index:1;display:inline-block;margin-right:10px;"></i>
                                <span style="font-size:12px;">No Trainings Assigned</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="upToDate" nzLabel="All Trainings are Up To Date">
                                <i class="fas fa-user"
                                    style="font-size:14px;color:#46bd15;z-index:1;display:inline-block;margin-right:10px;">
                                </i>
                                <span style="font-size:12px;">All Trainings are Up To Date</span>
                            </nz-option>
                            <nz-option nzCustomContent nzValue="pastDue" nzLabel="At Least One Training is Past Due">
                                <i class="fas fa-user"
                                    style="font-size:14px;color:red;z-index:1;display:inline-block;margin-right:10px;">
                                </i>
                                <span style="font-size:12px;">At Least One Training is Past Due</span>
                            </nz-option>
                        </nz-option-group>
                    </nz-select>
                    <ng-template #defaultTemplate let-selected> <i [ngClass]="highlightHash[selected.nzValue].icon"
                            [ngStyle]="{'color': highlightHash[selected.nzValue].iconColor}"
                            style="vertical-align: baseline;font-size:14px;"></i>
                        &nbsp;&nbsp;&nbsp;{{ selected.nzLabel }}</ng-template>
                </div>
                <div style="float:left;margin-left:10px">
                    <span style="display:block;font-size:14px;font-weight:500;">Selection Mode</span>
                    <nz-select style="width:160px;" nzAllowClear nzPlaceHolder="Select Mode" [(ngModel)]="selectionMode"
                        (ngModelChange)="setSelectionMode($event)">
                        <nz-option nzLabel="Individual" nzValue="Individual"></nz-option>
                        <nz-option nzLabel="Org" nzValue="Org"></nz-option>
                        <nz-option nzLabel="Job Title" nzValue="JobTitle"></nz-option>
                        <nz-option nzLabel="User Type" nzValue="UserType"></nz-option>
                        <nz-option nzLabel="Training" nzValue="Training"></nz-option>
                    </nz-select>
                </div>
                <div *ngIf="selectionMode === 'JobTitle'" style="float:left;margin-left:10px">
                    <span style="display:block;font-size:14px;font-weight:500;">Job Titles</span>
                    <nz-select ngDefaultControl nzMode="tags" nzPlaceHolder="Select Job Titles"
                        [(ngModel)]="currentJobTitlesSelected" (ngModelChange)="jobTitleSelectedChanged($event)"
                        style="width:250px;">
                        <nz-option *ngFor="let jobTitle of listOfJobTitles" [nzLabel]="jobTitle.text"
                            [nzValue]="jobTitle.value"></nz-option>
                    </nz-select>
                </div>
                <div *ngIf="selectionMode === 'Training'" style="float:left;margin-left:10px">
                    <span style="display:block;font-size:14px;font-weight:500;">Trainings</span>
                    <nz-select [nzCustomTemplate]="trainingTemplate" nzAllowClear ngDefaultControl
                        nzPlaceHolder="Select a Training" [(ngModel)]="currentTrainingSelected"
                        nzOptionOverflowSize="600" (ngModelChange)="trainingSelectedChanged($event)"
                        style="width:250px;">
                        <nz-option *ngFor="let training of listOfTrainingTitles" [nzLabel]="training.text"
                            [nzValue]="training.value" nzCustomContent>
                            <i [ngClass]="getSelectedTrainingIconClass(training.value)"
                                [ngStyle]="{'color': getTrainingIconColor(training.value)}"
                                style="font-size:16px;z-index:1;display:inline-block;line-height:18px;margin-right:10px;">
                            </i>
                            <span style="font-size:12px;">{{training.text}}</span>
                        </nz-option>
                    </nz-select>
                    <ng-template #trainingTemplate let-selected>
                        <i [ngClass]="getSelectedTrainingIconClass(selected.nzValue)"
                            [ngStyle]="{'color': getTrainingIconColor(selected.nzValue)}"
                            style="vertical-align: baseline;font-size:16px;"></i>
                        &nbsp;&nbsp;&nbsp;{{ selected.nzLabel }}</ng-template>
                </div>
                <div *ngIf="selectionMode === 'UserType'" style="float:left;margin-left:10px">
                    <span style="display:block;font-size:14px;font-weight:500;">User Types</span>
                    <nz-radio-group [(ngModel)]="currentUserType" (ngModelChange)="userTypeSelectedChanged($event)">
                        <label nz-radio-button nzValue="individualContributor" nz-tooltip
                            nzTooltipTitle="Individual Contributor">
                            <i class="fas fa-fw fa-user"></i>
                        </label>
                        <label nz-radio-button nzValue="supervisor" nz-tooltip nzTooltipTitle="Supervisor">
                            <i class="fas fa-fw fa-user-tie"></i>
                        </label>
                        <label nz-radio-button nzValue="volunteer" nz-tooltip nzTooltipTitle="Volunteer">
                            <i class="fas fa-fw fa-user-cowboy"></i>
                        </label>
                        <label nz-radio-button nzValue="customer" nz-tooltip nzTooltipTitle="Customer">
                            <i class="fas fa-fw fa-user-crown"></i>
                        </label>
                    </nz-radio-group>
                </div>
                <div style="padding-top:25px;float:right;">
                    <div *ngIf="selectionMode !== 'Individual'" class="selected-node"
                        style="padding:0 3px;margin-left:10px;display:inline-block;">
                        {{userIdsSelected.length}} selected
                    </div>
                    <button *ngIf="selectionMode !== 'Individual'" nz-button nzShape="circle" nzType="primary"
                        [disabled]="userIdsSelected.length === 0" style="display:inline-block;margin-left:10px;"
                        (click)="showUserTrainingModal = true" nz-tooltip nzTooltipTitle="Assign Training to Users">
                        <i class="fas fa-arrow-alt-to-right"></i></button>
                    <button *ngIf="selectionMode === 'Training'" nz-button nzShape="circle" [nzDanger]="'true'"
                        [disabled]="userIdsSelected.length === 0" style="display:inline-block;margin-left:10px;"
                        nz-popconfirm nzPopconfirmTitle="Remove this training from all users selected?"
                        (nzOnConfirm)="confirmUserTrainingDelete()" nz-tooltip
                        nzTooltipTitle="Remove Training from Users">
                        <i class="fas fa-arrow-alt-from-right"></i></button>
                    <button nz-button nzShape="circle" nzType="primary" [disabled]="collapsedNodeCnt === 0"
                        style="display:inline-block;margin-left:10px;" (click)="expandAllNodes()" nz-tooltip
                        nzTooltipTitle="Expand All Collapsed Nodes">
                        <i class="fas fa-plus"></i></button>
                    <label nz-checkbox ngDefaultControl [(ngModel)]="includeFullName"
                        style="display:inline-block;cursor:pointer;font-size:12px;color:#000000;z-index:1;margin-left:10px;"
                        nz-tooltip nzTooltipTitle="">Show
                        Names
                    </label>
                    <div style="margin-left:10px;display:inline-block;">
                        <i nz-icon nzType="zoom-in" nzTheme="outline"
                            style="cursor:pointer;display:inline-block;font-size:20px;margin-right:10px;"
                            (click)="zoomIn()" nz-tooltip nzTooltipTitle="Zoom In"></i>
                        <i nz-icon nzType="zoom-out" nzTheme="outline"
                            style="cursor:pointer;display:inline-block;font-size:20px;" nz-tooltip
                            nzTooltipTitle="Zoom Out" (click)="zoomOut()"></i>
                    </div>
                </div>
                <div style="clear: both;"></div>
                <div
                    style="display:block;background:rgba(0,0,255,.2);padding:10px;border:2px solid #afbcf8;width:100%;margin-top:5px;border-radius: 5px;">
                    <div
                        style="float:left;width:30%;background: rgba(255,255,255, .9);border-radius: 5px;height:35px;padding:5px;">
                        <i [ngClass]="userTypeIconHash[currentHoverUser?.userType]" style="font-size:16px;"
                            [ngStyle]="{'color': userTrainingStatusColorHash[currentHoverUser?.trainingStatus]}"
                            nz-tooltip [nzTooltipTitle]=""></i>&nbsp;
                        <span *ngIf="currentHoverUser"
                            style="display:inline-block;font-size:16px;font-weight: 500;color:black;">{{currentHoverUser?.firstName}}
                            {{currentHoverUser?.lastName}}&nbsp;&nbsp;
                        </span>
                        <span *ngIf="currentHoverUser"
                            style="display:inline-block;font-size:16px;font-weight: 300;color:#444444;">({{currentHoverUser?.jobTitle}})</span>
                    </div>
                    <app-user-trainings mode="admin" logSession="off" [uid]="currentHoverUid" compact="yes"
                        style="float:right;width:60%;background: rgba(255,255,255, .9);border-radius: 5px;height:35px;">
                    </app-user-trainings>
                    <div style="clear: both;"></div>
                </div>
            </div>
        </div>
        <div *ngIf="showOrgChart !== 'true'" style="padding-top:20px;">
            <div style="width:100%;height:100;">
                <span style="float:right;margin-right:5px;">1 -
                    {{userListDisplay.length}}</span>
                <div style="clear:both;"></div>
            </div>
            <nz-table #nestedTable [nzData]="userListDisplay" nzPageSize="10000" nzShowRowSelection="true"
                nzShowPagination="false" nzSize="small" [nzScroll]="{ y: '350px' }"
                style="width:100%;background-color: #fafafa;font-size:12px;font-size:12px;display:inline-block;">
                <thead (nzSortChange)="sort($event)" nzSingleSort>
                    <tr style="background-color: #fafafa;">
                        <!--
                    <th nzShowExpand></th>
                    -->
                        <th nzShowSort nzSortKey="trainingStatus" [nzFilters]="listOfTrainingStatus"
                            (nzFilterChange)="filterTrainingStatus($event)" nzShowFilter style="width:10%;">Training
                            Status</th>
                        <th nzShowSort nzSortKey="lastName" style="width:17%;">Name</th>
                        <th nzShowSort nzSortKey="supervisorId" style="width:17%;">Supervisor</th>
                        <th nzShowSort nzSortKey="userType" [nzFilters]="listOfUserTypes"
                            (nzFilterChange)="filterUserType($event)" nzShowFilter style="width:15%;">User Type</th>
                        <th nzShowSort nzSortKey="jobTitle" style="width:10%;" [nzFilters]="listOfJobTitles"
                            (nzFilterChange)="filterJobTitles($event)" nzShowFilter>Job Title</th>
                        <th style="width:15%;">Trainings</th>
                        <!--
                        <th style="width:15%;text-align: center;">Actions</th>
                        -->
                    </tr>
                </thead>
                <tbody>
                    <ng-template ngFor let-data [ngForOf]="nestedTable.data" let-i="index">
                        <tr style="font-size:12px;background-color: white;line-height:10px;"
                            (mouseenter)="hoverUid = data._id" (mouseleave)="hoverUid = null"
                            [ngClass]="{'row-selected': rowSelected === i}">
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:10%;">
                                <i [ngClass]="userTypeIconHash[data.userType]"
                                    style="font-size:16px;display:inline-block;"
                                    [ngStyle]="{'color': userTrainingStatusColorHash[data.trainingStatus], 'font-size.px': iconFontSize}"
                                    nz-tooltip [nzTooltipTitle]=""></i>
                            </td>
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:17%;">
                                {{data.firstName}} {{data.lastName}}
                            </td>
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:17%;">
                                {{myOrgUserHash[data.supervisorId]?.firstName}}
                                {{myOrgUserHash[data.supervisorId]?.lastName}}
                            </td>
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:15%;">
                                {{data.userType}}
                            </td>
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:10%;">
                                {{data.jobTitle}}
                            </td>
                            <td (click)="selectUser(data._id, i)" [ngClass]="{'row-selected': rowSelected === i}"
                                style="width:15%;">
                                <div *ngFor="let ut of uidUTHash[data._id]" style="float:right;margin-left:10px;">
                                    <i [ngClass]="allTrainingIdHash[ut.tid]?.iconClass"
                                        style="font-size:20px;text-align: center;vertical-align: middle;" nz-tooltip
                                        [nzTooltipTitle]="allTrainingIdHash[ut.tid]?.title"
                                        [ngStyle]="{'color': allTrainingIdHash[ut.tid]?.iconColor}">
                                    </i>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </tbody>
            </nz-table>
        </div>
        <div *ngIf="showOrgChart === 'true'" style="position: relative;height:90%;">

            <div style="height:100%;text-align: center;width:100%;overflow: scroll;position:relative;margin-top:150px;">
                <div
                    style="background-color:white;width:fit-content;height:50%;display:inline-block;white-space: nowrap;">
                    <div style="text-align: center;margin-bottom:20px;">
                        <div style="display:inline-block;padding:5px;position:relative;border:2px solid white;cursor:pointer;"
                            (mouseenter)="setHoverData(authenticatedUser._id)" (mouseleave)="setHoverData(null)"
                            (click)="selectUser(authenticatedUser._id)"
                            [ngClass]="{'selected-node': (selectionMode === 'Individual' && userIdSelected === authenticatedUser._id) || (selectionMode !== 'Indiviual' && userIdsSelected.includes(authenticatedUser._id)), 'hover-node': authenticatedUser._id === currentHoverUid  || currentHoverReportChain.includes(authenticatedUser._id)}">

                            <i [ngClass]="userTypeIconHash[authenticatedUser.userType]" style="font-size:16px;"
                                [ngStyle]="{'color': getStatusColor(authenticatedUser._id)}"></i>
                            <span style="display: block;" [ngStyle]="{'font-size.px': textFontSize}">
                                {{authenticatedUser.firstName}}<br>{{authenticatedUser.lastName}}
                            </span>
                            <div *ngIf="authenticatedUser.directReports.length > 0"
                                class="org-chart-vert-connector-bottom">
                            </div>
                        </div>
                    </div>
                    <div style="background-color:white;display:block;">
                        <div *ngFor="let dr of authenticatedUser.directReports; let drIndex = index"
                            style="vertical-align: top;width:fit-content;position:relative;display:inline-block;">
                            <div style="position:relative;">
                                <div class="org-chart-vert-connector">
                                </div>
                                <div *ngIf="!isLast(authenticatedUser.directReports, drIndex)"
                                    class="org-chart-horizontal-connector-right">
                                </div>
                                <div *ngIf="drIndex !== 0" class="org-chart-horizontal-connector-left">
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div (mouseenter)="setHoverData(dr)" (mouseleave)="setHoverData(null)"
                                    class="org-chart-node" [ngStyle]="{'padding.px': orgChartPadding}"
                                    [ngClass]="{'supervisor-node': myOrgUserHash[dr]?.userType === 'supervisor'}">
                                    <div style="border:2px solid white;" (click)="selectUser(dr)"
                                        [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr]?.userType || currentHighlightItem === myOrgUserHash[dr]?.trainingStatus, 'selected-node': (selectionMode === 'Individual' && userIdSelected === dr) || (selectionMode !== 'Indiviual' &&
                                        userIdsSelected.includes(dr)), 'hover-node': userIdSelected !== dr && allActive || dr === currentHoverUid ||
                                        orgChartNodeHash[dr]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr)}">

                                        <i [ngClass]="userTypeIconHash[myOrgUserHash[dr]?.userType]"
                                            style="font-size:16px;" [ngStyle]="{'color': getStatusColor(dr)}"></i>
                                        <span
                                            *ngIf="myOrgUserHash[dr]?.userType === 'supervisor' || (myOrgUserHash[dr]?.userType === 'individualContributor' && includeFullName)"
                                            [ngStyle]="{'font-size.px': textFontSize}" style="display: block;">
                                            {{orgChartNodeHash[dr]?.fName}}<br>{{orgChartNodeHash[dr]?.lName}}
                                        </span>
                                    </div>
                                    <div *ngIf="myOrgUserHash[dr]?.userType === 'supervisor' && !(collapsedNodeHash[dr] && collapsedNodeHash[dr] === true)"
                                        class="org-chart-vert-connector-bottom">
                                    </div>
                                    <div *ngIf="collapsedNodeHash[dr] === false && myOrgUserHash[dr]?.userType === 'supervisor' && maxLevel > 2"
                                        (click)="collapseNode(dr, true)">
                                        <i class="fal fa-minus-circle" style="font-size:12px;"></i>
                                    </div>
                                    <div *ngIf="collapsedNodeHash[dr] === true && myOrgUserHash[dr]?.userType === 'supervisor' && maxLevel > 2"
                                        (click)="collapseNode(dr, false)">
                                        <i class="far fa-plus-circle"
                                            style="margin-top:4px;font-size:16px;color:red;"></i>
                                    </div>
                                </div>
                                <div *ngIf="!(collapsedNodeHash[dr] && collapsedNodeHash[dr] === true)"
                                    style="display:block;">
                                    <div *ngFor="let dr2 of myOrgUserHash[dr]?.directReports; let dr2Index = index"
                                        style="vertical-align: top;width:fit-content;position:relative;"
                                        [ngClass]="{'inline-block': maxLevel > 2, 'block': maxLevel === 2}">
                                        <div *ngIf="maxLevel > 2" style="position:relative;">
                                            <div class="org-chart-vert-connector">
                                            </div>
                                            <div *ngIf="!isLast(myOrgUserHash[dr]?.directReports, dr2Index)"
                                                class="org-chart-horizontal-connector-right">
                                            </div>
                                            <div *ngIf="dr2Index > 0" class="org-chart-horizontal-connector-left">
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div (mouseenter)="setHoverData(dr2)" (mouseleave)="setHoverData(null)"
                                                [ngStyle]="{'padding.px': orgChartPadding}" class="org-chart-node"
                                                [ngClass]="{'supervisor-node': myOrgUserHash[dr2]?.userType === 'supervisor'}">
                                                <div style="border:2px solid white;" (click)="selectUser(dr2)"
                                                    [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr2]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr2]?.userType || currentHighlightItem === myOrgUserHash[dr2]?.trainingStatus,'selected-node': (selectionMode === 'Individual' && userIdSelected === dr2) || (selectionMode !== 'Indiviual' &&
                                                    userIdsSelected.includes(dr2)) , 'hover-node': userIdSelected !== dr2 && allActive || dr2 === currentHoverUid ||
                                                    orgChartNodeHash[dr2]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr2)}">
                                                    <i [ngClass]="userTypeIconHash[myOrgUserHash[dr2]?.userType]"
                                                        style="font-size:16px;"
                                                        [ngStyle]="{'color': getStatusColor(dr2)}"></i>
                                                    <span
                                                        *ngIf="myOrgUserHash[dr2]?.userType === 'supervisor' || myOrgUserHash[dr2]?.userType === 'individualContributor' && includeFullName"
                                                        [ngStyle]="{'font-size.px': textFontSize}"
                                                        style="display: block;">
                                                        {{orgChartNodeHash[dr2]?.fName}}<br>{{orgChartNodeHash[dr2]?.lName}}
                                                    </span>
                                                </div>
                                                <div *ngIf="myOrgUserHash[dr2]?.userType === 'supervisor' && !(collapsedNodeHash[dr2] && collapsedNodeHash[dr2] === true)"
                                                    class="org-chart-vert-connector-bottom">
                                                </div>
                                                <div *ngIf="collapsedNodeHash[dr2] === false && myOrgUserHash[dr2]?.userType === 'supervisor' && maxLevel > 3"
                                                    (click)="collapseNode(dr2, true)">
                                                    <i class="fal fa-minus-circle" style="font-size:12px;"></i>
                                                </div>
                                                <div *ngIf="collapsedNodeHash[dr2] === true && myOrgUserHash[dr2]?.userType === 'supervisor' && maxLevel > 3"
                                                    (click)="collapseNode(dr2, false)">
                                                    <i class="far fa-plus-circle"
                                                        style="margin-top:4px;font-size:16px;color:red;"></i>
                                                </div>
                                            </div>
                                            <div *ngIf="!(collapsedNodeHash[dr2] && collapsedNodeHash[dr2] === true)"
                                                style="display:block;">
                                                <div *ngFor="let dr3 of myOrgUserHash[dr2]?.directReports; let dr3Index = index"
                                                    style="vertical-align: top;position:relative;display:inline-block;"
                                                    [ngClass]="{'inline-block': maxLevel > 3, 'block': maxLevel === 3}">
                                                    <div *ngIf="maxLevel > 3" style="position:relative;">
                                                        <div class="org-chart-vert-connector">
                                                        </div>
                                                        <div *ngIf="!isLast(myOrgUserHash[dr2]?.directReports, dr3Index)"
                                                            class="org-chart-horizontal-connector-right">
                                                        </div>
                                                        <div *ngIf="dr3Index !== 0"
                                                            class="org-chart-horizontal-connector-left">
                                                        </div>
                                                    </div>
                                                    <div style="text-align: center;">
                                                        <div (mouseenter)="setHoverData(dr3)"
                                                            [ngStyle]="{'padding.px': orgChartPadding}"
                                                            class="org-chart-node" (mouseleave)="setHoverData(null)"
                                                            [ngClass]="{'supervisor-node': myOrgUserHash[dr3]?.userType === 'supervisor'}">
                                                            <div style="border:2px solid white;"
                                                                (click)="selectUser(dr3)"
                                                                [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr3]?.jobTitle))|| currentHighlightItem === myOrgUserHash[dr3]?.userType|| currentHighlightItem === myOrgUserHash[dr3]?.trainingStatus,'selected-node': (selectionMode === 'Individual' && userIdSelected === dr3) || (selectionMode !== 'Indiviual' &&
                                                                userIdsSelected.includes(dr3)), 'hover-node': userIdSelected !== dr3 && allActive || dr3 === currentHoverUid ||
                                                                orgChartNodeHash[dr3]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr3)}">
                                                                <i [ngClass]="userTypeIconHash[myOrgUserHash[dr3]?.userType]"
                                                                    style="font-size:16px;"
                                                                    [ngStyle]="{'color': getStatusColor(dr3)}"></i>
                                                                <span
                                                                    *ngIf="myOrgUserHash[dr3]?.userType === 'supervisor' || myOrgUserHash[dr3]?.userType === 'individualContributor' && includeFullName"
                                                                    style="display: block;"
                                                                    [ngStyle]="{'font-size.px': textFontSize}">
                                                                    {{orgChartNodeHash[dr3]?.fName}}<br>{{orgChartNodeHash[dr3]?.lName}}
                                                                </span>
                                                            </div>
                                                            <div *ngIf="myOrgUserHash[dr3]?.userType === 'supervisor' && !(collapsedNodeHash[dr3] && collapsedNodeHash[dr3] === true)"
                                                                class="org-chart-vert-connector-bottom">
                                                            </div>
                                                            <div *ngIf="collapsedNodeHash[dr3] === false && myOrgUserHash[dr3]?.userType === 'supervisor' && maxLevel > 4"
                                                                (click)="collapseNode(dr3, true)">
                                                                <i class="fal fa-minus-circle"
                                                                    style="font-size:12px;"></i>
                                                            </div>
                                                            <div *ngIf="collapsedNodeHash[dr3] === true && myOrgUserHash[dr3]?.userType === 'supervisor' && maxLevel > 4"
                                                                (click)="collapseNode(dr3, false)">
                                                                <i class="far fa-plus-circle"
                                                                    style="margin-top:4px;font-size:16px;color:red;"></i>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="!(collapsedNodeHash[dr3] && collapsedNodeHash[dr3] === true)"
                                                            style="display:block;">
                                                            <div *ngFor="let dr4 of myOrgUserHash[dr3]?.directReports; let dr4Index = index"
                                                                style="vertical-align: top;position:relative;"
                                                                [ngClass]="{'inline-block': maxLevel > 4, 'block': maxLevel === 4}">
                                                                <div *ngIf="maxLevel > 4" style="position:relative;">
                                                                    <div class="org-chart-vert-connector">
                                                                    </div>
                                                                    <div *ngIf="!isLast(myOrgUserHash[dr3]?.directReports, dr4Index)"
                                                                        class="org-chart-horizontal-connector-right">
                                                                    </div>
                                                                    <div *ngIf="dr4Index !== 0"
                                                                        class="org-chart-horizontal-connector-left">
                                                                    </div>
                                                                </div>
                                                                <div style="text-align: center;">
                                                                    <div (mouseenter)="setHoverData(dr4)"
                                                                        [ngStyle]="{'padding.px': orgChartPadding}"
                                                                        (mouseleave)="setHoverData(null)"
                                                                        class="org-chart-node"
                                                                        [ngClass]="{'supervisor-node': myOrgUserHash[dr4]?.userType === 'supervisor'}">
                                                                        <div (click)="selectUser(dr4)"
                                                                            style="border:2px solid white;"
                                                                            [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr4]?.jobTitle))|| currentHighlightItem === myOrgUserHash[dr4]?.userType || currentHighlightItem === myOrgUserHash[dr4]?.trainingStatus,'selected-node': (selectionMode === 'Individual' && userIdSelected === dr4) || (selectionMode !== 'Indiviual' &&
                                                                            userIdsSelected.includes(dr4)), 'hover-node': userIdSelected !== dr4 && allActive || dr4 === currentHoverUid ||
                                                                            orgChartNodeHash[dr4]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr4)}">
                                                                            <i [ngClass]="userTypeIconHash[myOrgUserHash[dr4]?.userType]"
                                                                                style="font-size:16px;"
                                                                                [ngStyle]="{'color': getStatusColor(dr4)}"></i>
                                                                            <span
                                                                                *ngIf="myOrgUserHash[dr4]?.userType === 'supervisor' || myOrgUserHash[dr4]?.userType === 'individualContributor' && includeFullName"
                                                                                style="display: block;"
                                                                                [ngStyle]="{'font-size.px': textFontSize}">
                                                                                {{orgChartNodeHash[dr4]?.fName}}<br>{{orgChartNodeHash[dr4]?.lName}}
                                                                            </span>
                                                                        </div>
                                                                        <div *ngIf="myOrgUserHash[dr4]?.userType === 'supervisor' && !(collapsedNodeHash[dr4] && collapsedNodeHash[dr4] === true)"
                                                                            class="org-chart-vert-connector-bottom">
                                                                        </div>
                                                                        <div *ngIf="collapsedNodeHash[dr4] === false && myOrgUserHash[dr4]?.userType === 'supervisor' && maxLevel > 5"
                                                                            (click)="collapseNode(dr4, true)">
                                                                            <i class="fal fa-minus-circle"
                                                                                style="font-size:10px;"></i>
                                                                        </div>
                                                                        <div *ngIf="collapsedNodeHash[dr4] === true && myOrgUserHash[dr4]?.userType === 'supervisor' && maxLevel > 5"
                                                                            (click)="collapseNode(dr4, false)">
                                                                            <i class="far fa-plus-circle"
                                                                                style="margin-top:4px;font-size:16px;color:red;"></i>
                                                                        </div>
                                                                    </div>
                                                                    <div *ngIf="!(collapsedNodeHash[dr4] && collapsedNodeHash[dr4] === true)"
                                                                        style="display:block;">
                                                                        <div *ngFor="let dr5 of myOrgUserHash[dr4]?.directReports; let dr5Index = index"
                                                                            style="vertical-align: top;position:relative;"
                                                                            [ngClass]="{'inline-block': maxLevel > 5, 'block': maxLevel === 5}">
                                                                            <div *ngIf="maxLevel > 5"
                                                                                style="position:relative;">
                                                                                <div class="org-chart-vert-connector">
                                                                                </div>
                                                                                <div *ngIf="!isLast(myOrgUserHash[dr4]?.directReports, dr5Index)"
                                                                                    class="org-chart-horizontal-connector-right">
                                                                                </div>
                                                                                <div *ngIf="dr5Index !== 0"
                                                                                    class="org-chart-horizontal-connector-left">
                                                                                </div>
                                                                            </div>

                                                                            <div style="text-align: center;">
                                                                                <div (mouseenter)="setHoverData(dr5)"
                                                                                    [ngStyle]="{'padding.px': orgChartPadding}"
                                                                                    (mouseleave)="setHoverData(null)"
                                                                                    class="org-chart-node">
                                                                                    <div (click)="selectUser(dr5)"
                                                                                        style="border:2px solid white;"
                                                                                        [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr5]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr5]?.userType || currentHighlightItem === myOrgUserHash[dr5]?.trainingStatus, 'selected-node': (selectionMode === 'Individual' && userIdSelected === dr5) || (selectionMode !== 'Indiviual' &&
                                                                                        userIdsSelected.includes(dr5)), 'hover-node': userIdSelected !== dr5 && allActive || dr5 === currentHoverUid ||
                                                                                        orgChartNodeHash[dr5]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr5)}">
                                                                                        <i [ngClass]="userTypeIconHash[myOrgUserHash[dr5].userType]"
                                                                                            style="font-size:16px;"
                                                                                            [ngStyle]="{'color': getStatusColor(dr5)}"></i>
                                                                                        <span
                                                                                            *ngIf="myOrgUserHash[dr5]?.userType === 'supervisor' || myOrgUserHash[dr5]?.userType === 'individualContributor' && includeFullName"
                                                                                            style="display: block;"
                                                                                            [ngStyle]="{'font-size.px': textFontSize}">
                                                                                            {{orgChartNodeHash[dr5]?.fName}}<br>{{orgChartNodeHash[dr5]?.lName}}
                                                                                        </span>
                                                                                    </div>
                                                                                    <div *ngIf="myOrgUserHash[dr5]?.userType === 'supervisor' && !(collapsedNodeHash[dr5] && collapsedNodeHash[dr5] === true)"
                                                                                        class="org-chart-vert-connector-bottom">
                                                                                    </div>
                                                                                    <div *ngIf="collapsedNodeHash[dr5] === false && myOrgUserHash[dr5]?.userType === 'supervisor' && maxLevel > 6"
                                                                                        (click)="collapseNode(dr5, true)">
                                                                                        <i class="fal fa-minus-circle"
                                                                                            style="font-size:10px;"></i>
                                                                                    </div>
                                                                                    <div *ngIf="collapsedNodeHash[dr5] === true && myOrgUserHash[dr5]?.userType === 'supervisor' && maxLevel > 6"
                                                                                        (click)="collapseNode(dr5, false)">
                                                                                        <i class="far fa-plus-circle"
                                                                                            style="margin-top:4px;font-size:16px;color:red;"></i>
                                                                                    </div>
                                                                                </div>
                                                                                <div *ngIf="!(collapsedNodeHash[dr5] && collapsedNodeHash[dr5] === true)"
                                                                                    style="display: block;text-align: center;">
                                                                                    <div *ngFor="let dr6 of myOrgUserHash[dr5]?.directReports; let dr6Index = index"
                                                                                        style="vertical-align: top;width:fit-content;display: inline-block;"
                                                                                        [ngClass]="{'inline-block': maxLevel > 6, 'block': maxLevel === 6}">
                                                                                        <div *ngIf="maxLevel > 6"
                                                                                            style="position:relative;">
                                                                                            <div
                                                                                                class="org-chart-vert-connector">
                                                                                            </div>
                                                                                            <div *ngIf="!isLast(myOrgUserHash[dr5]?.directReports, dr6Index)"
                                                                                                class="org-chart-horizontal-connector-right">
                                                                                            </div>
                                                                                            <div *ngIf="dr6Index !== 0"
                                                                                                class="org-chart-horizontal-connector-left">
                                                                                            </div>
                                                                                        </div>
                                                                                        <div
                                                                                            style="text-align: center;">
                                                                                            <div (mouseenter)="setHoverData(dr6)"
                                                                                                [ngStyle]="{'padding.px': orgChartPadding}"
                                                                                                (mouseleave)="setHoverData(null)"
                                                                                                class="org-chart-node">
                                                                                                <div (click)="selectUser(dr6)"
                                                                                                    style="border:2px solid white;"
                                                                                                    [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr6]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr6]?.userType, 'selected-node': (selectionMode === 'Individual' && userIdSelected === dr6) || (selectionMode !== 'Indiviual' &&
                                                                                                    userIdsSelected.includes(dr6)), 'hover-node': userIdSelected !== dr6 && allActive || dr6 === currentHoverUid ||
                                                                                                    orgChartNodeHash[dr6]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr6)}">
                                                                                                    <i [ngClass]="userTypeIconHash[myOrgUserHash[dr6]?.userType]"
                                                                                                        style="font-size:16px;"
                                                                                                        [ngStyle]="{'color': getStatusColor(dr6)}"></i>

                                                                                                    <span
                                                                                                        *ngIf="myOrgUserHash[dr6]?.userType === 'supervisor' || myOrgUserHash[dr6]?.userType === 'individualContributor' && includeFullName"
                                                                                                        style="display: block;"
                                                                                                        [ngStyle]="{'font-size.px': textFontSize}">
                                                                                                        {{orgChartNodeHash[dr6]?.fName}}<br>{{orgChartNodeHash[dr6]?.lName}}
                                                                                                    </span>
                                                                                                </div>
                                                                                                <div *ngIf="myOrgUserHash[dr6]?.userType === 'supervisor' && !(collapsedNodeHash[dr6] && collapsedNodeHash[dr6] === true)"
                                                                                                    class="org-chart-vert-connector-bottom">
                                                                                                </div>
                                                                                                <div *ngIf="collapsedNodeHash[dr6] === false && myOrgUserHash[dr6]?.userType === 'supervisor' && maxLevel > 7"
                                                                                                    (click)="collapseNode(dr6, true)">
                                                                                                    <i class="fal fa-minus-circle"
                                                                                                        style="font-size:10px;"></i>
                                                                                                </div>
                                                                                                <div *ngIf="collapsedNodeHash[dr6] === true && myOrgUserHash[dr6]?.userType === 'supervisor' && maxLevel > 7"
                                                                                                    (click)="collapseNode(dr6, false)">
                                                                                                    <i class="far fa-plus-circle"
                                                                                                        style="margin-top:4px;font-size:16px;color:red;"></i>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div *ngIf="!(collapsedNodeHash[dr6] && collapsedNodeHash[dr6] === true)"
                                                                                                style="display: block;">
                                                                                                <div *ngFor="let dr7 of myOrgUserHash[dr6]?.directReports"
                                                                                                    style="vertical-align: top;width:fit-content;"
                                                                                                    [ngClass]="{'inline-block': maxLevel > 7, 'block': maxLevel === 7}">
                                                                                                    <div
                                                                                                        class="org-chart-vert-connector">
                                                                                                    </div>
                                                                                                    <div *ngIf="!isLast(myOrgUserHash[dr6]?.directReports, dr7Index)"
                                                                                                        class="org-chart-horizontal-connector-right">
                                                                                                    </div>
                                                                                                    <div *ngIf="dr7Index !== 0"
                                                                                                        class="org-chart-horizontal-connector-left">
                                                                                                    </div>
                                                                                                    <div
                                                                                                        style="text-align: center;">
                                                                                                        <div (mouseenter)="setHoverData(dr7)"
                                                                                                            [ngStyle]="{'padding.px': orgChartPadding}"
                                                                                                            (mouseleave)="setHoverData(null)"
                                                                                                            class="org-chart-node">
                                                                                                            <div (click)="selectUser(dr7)"
                                                                                                                style="border:2px solid white;"
                                                                                                                [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr7]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr7]?.userType, 'selected-node': (selectionMode === 'Individual' && userIdSelected === dr7) || (selectionMode !== 'Indiviual' &&
                                                                                                                userIdsSelected.includes(dr7)), 'hover-node': userIdSelected !== dr7 && allActive || dr7 === currentHoverUid ||
                                                                                                                orgChartNodeHash[dr7]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr7)}">
                                                                                                                <i [ngClass]="userTypeIconHash[myOrgUserHash[dr7]?.userType]"
                                                                                                                    style="font-size:14px;"
                                                                                                                    [ngStyle]="{'color': getStatusColor(dr7)}"></i>
                                                                                                                <span
                                                                                                                    *ngIf="myOrgUserHash[dr7]?.userType === 'supervisor' || myOrgUserHash[dr7]?.userType === 'individualContributor' && includeFullName"
                                                                                                                    style="display: block;"
                                                                                                                    [ngStyle]="{'font-size.px': textFontSize}">
                                                                                                                    {{orgChartNodeHash[dr7]?.fName}}<br>{{orgChartNodeHash[dr7]?.lName}}
                                                                                                                </span>
                                                                                                            </div>
                                                                                                            <div *ngIf="myOrgUserHash[dr7]?.userType === 'supervisor'"
                                                                                                                class="org-chart-vert-connector-bottom">
                                                                                                            </div>
                                                                                                            <div *ngIf="collapsedNodeHash[dr7] === false"
                                                                                                                (click)="collapseNode(dr7, true)">
                                                                                                                <i class="fal fa-minus-circle"
                                                                                                                    style="font-size:10px;"></i>
                                                                                                            </div>
                                                                                                            <div *ngIf="collapsedNodeHash[dr7] === true"
                                                                                                                (click)="collapseNode(dr7, false)">
                                                                                                                <i class="far fa-plus-circle"
                                                                                                                    style="margin-top:4px;font-size:16px;color:red;"></i>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            style="display: block;">
                                                                                                            <div *ngFor="let dr8 of myOrgUserHash[dr7]?.directReports"
                                                                                                                style="vertical-align: top;width:fit-content;"
                                                                                                                [ngClass]="{'inline-block': maxLevel > 8, 'block': maxLevel === 8}">
                                                                                                                <div
                                                                                                                    class="org-chart-vert-connector">
                                                                                                                </div>
                                                                                                                <div *ngIf="!isLast(myOrgUserHash[dr7]?.directReports, dr8Index)"
                                                                                                                    class="org-chart-horizontal-connector-right">
                                                                                                                </div>
                                                                                                                <div *ngIf="dr8Index !== 0"
                                                                                                                    class="org-chart-horizontal-connector-left">
                                                                                                                </div>
                                                                                                                <div
                                                                                                                    style="text-align: center;">
                                                                                                                    <div (mouseenter)="setHoverData(dr8)"
                                                                                                                        [ngStyle]="{'padding.px': orgChartPadding}"
                                                                                                                        (mouseleave)="setHoverData(null)"
                                                                                                                        class="org-chart-node">
                                                                                                                        <div (click)="selectUser(dr8)"
                                                                                                                            style="border:2px solid white;"
                                                                                                                            [ngClass]="{'highlight': (currentJobTitleFilters.length > 0 && currentJobTitleFilters.includes(myOrgUserHash[dr8]?.jobTitle)) || currentHighlightItem === myOrgUserHash[dr8]?.userType, 'selected-node': (selectionMode === 'Individual' && userIdSelected === dr8) || (selectionMode !== 'Indiviual' &&
                                                                                                                            userIdsSelected.includes(dr8)), 'hover-node': userIdSelected !== dr8 && allActive || dr8 === currentHoverUid ||
                                                                                                                            orgChartNodeHash[dr8]?.extra.reportChain.includes(currentHoverUid) || currentHoverReportChain.includes(dr8)}">
                                                                                                                            <i [ngClass]="userTypeIconHash[myOrgUserHash[dr8]?.userType]"
                                                                                                                                [ngStyle]="{'color': getStatusColor(dr8), 'font-size.px': iconFontSize}"></i>
                                                                                                                        </div>
                                                                                                                        <span
                                                                                                                            *ngIf="myOrgUserHash[dr8]?.userType === 'supervisor' || myOrgUserHash[dr8]?.userType === 'individualContributor' && includeFullName"
                                                                                                                            style="display: block;"
                                                                                                                            [ngStyle]="{'font-size.px': textFontSize}">
                                                                                                                            {{orgChartNodeHash[dr8]?.fName}}<br>{{orgChartNodeHash[dr8]?.lName}}
                                                                                                                        </span>
                                                                                                                    </div>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="position:absolute;left:0;bottom:0;">
            <i nz-icon nzType="menu-unfold" style="font-size:32px;cursor:pointer;" (click)="openUserDetails()"
                nz-tooltip nzTooltipTitle="Show the User Detail panel"></i>
        </div>
        <div [@userDetailSlide]="userDetailIsVisible ? 'open' : 'closed'" class="member-detail-card"
            style="position:absolute;bottom:-40px;left:0;width:100%;z-index: 11;">
            <div class="my-card-header">
                <i [ngClass]="userTypeIconHash[selectedUser?.userType]" style="font-size:16px;"
                    [ngStyle]="{'color': userTrainingStatusColorHash[selectedUser?.trainingStatus]}" nz-tooltip
                    [nzTooltipTitle]=""></i>&nbsp;
                <span *ngIf="selectedUser"
                    style="display:inline-block;font-size:16px;font-weight: 500;color:black;margin-bottom:10px;">{{selectedUser?.firstName}}
                    {{selectedUser?.lastName}}&nbsp;&nbsp;
                </span>
                <span *ngIf="selectedUser"
                    style="display:inline-block;font-size:16px;font-weight: 300;color:#444444;margin-bottom:10px;">({{selectedUser?.jobTitle}})</span>
                <span *ngIf="!selectedUser"
                    style="display:inline-block;font-size:16px;font-weight: 500;color:#444444;margin-bottom:10px;">No
                    User Selected
                </span>
                <i nz-icon nzType="menu-fold" style="font-size:22px;float:right;margin-right:20px;cursor:pointer;"
                    (click)="closeUserDetails()" nz-tooltip nzTooltipTitle="Hide this panel"></i>
            </div>
            <div joyrideStep="Step1-memberDetails" stepPosition="left" title="Member Details"
                style="position: relative;display:block;padding:0 20px;background: rgba(253, 239, 178, 1);"
                text="This is where the rubber hits the road!  Assign trainings, update profile information, set due dates, etc...">
                <div
                    style="width:100%;overflow:scroll;height:fit-content;text-align: left;background-color: white;border: 1px solid #eaab10;">
                    <app-user-trainings mode="admin" logSession="off"></app-user-trainings>
                </div>
            </div>
            <div class="my-card-footer">
                <div class="card-action" style="border-right:1px solid #eaab10;">
                    <div (click)="showUserTrainingModal = true" class="my-action">
                        <i nz-icon nzType="plus-circle" style="color:blue;"></i><br>
                        <span style="color:blue;font-size:10px;">Assign a Training</span>
                    </div>
                </div>
                <div class="card-action" style="border-right:1px solid #eaab10;">
                    <div (click)="editUser()" class="my-action">
                        <i nz-icon nzType="edit" style="color:blue;"></i><br>
                        <span style="color:blue;font-size:10px;">Edit User Profile</span>
                    </div>
                </div>
                <div class="card-action" style="border-right:1px solid #eaab10;">
                    <div (click)="resendRegistrationMsg(selectedUser.email, authenticatedUser.email)" class="my-action">
                        <i nz-icon nzType="redo" style="color:blue;"></i><br>
                        <span style="color:blue;font-size:10px;">Resend Registration Email</span>
                    </div>
                </div>
                <div class="card-action">
                    <div nz-popconfirm nzPopconfirmTitle="Delete this user?" (nzOnConfirm)="confirmDelete(selectedUser)"
                        class="my-action">
                        <i nz-icon nzType="delete" style="color:red;"></i><br>
                        <span style="color:red;font-size:10px;">Delete this User</span>
                    </div>
                </div>
            </div>
        </div>
        <nz-drawer [nzClosable]="false" [nzMaskClosable]="true" [nzVisible]="userPanelVisible" nzPlacement="right"
            nzTitle="User Profile" [nzWidth]="700">
            <div *ngIf="selectedUser" style="display:block;width:100%;">
                <div style="display:block;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                        <label style="font-size:14px;color:#000000;">
                            First Name
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <input nz-input nzSize="small" type="text" placeholder="First Name" ngDefaultControl
                            [(ngModel)]="selectedUser.firstName" style="margin-bottom:2px;">
                    </div>
                </div>
                <div style="display:block;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                        <label style="font-size:14px;color:#000000;">
                            Last Name
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <input nz-input nzSize="small" type="text" placeholder="Last Name" ngDefaultControl
                            [(ngModel)]="selectedUser.lastName" style="margin-bottom:2px;">
                    </div>
                </div>
                <div *ngIf="newUser" style="display:block;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                        <label style="font-size:14px;color:#000000;">
                            Email
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <nz-input-group [nzSuffix]="suffixTemplate">
                            <input nz-input nzSize="small" type="text" placeholder="Email" ngDefaultControl
                                [(ngModel)]="selectedUser.email" (ngModelChange)="checkUniqueEmail($event)"
                                style="margin-bottom:2px;" (keydown.enter)="checkUniqueEmail($event)"
                                (blur)="checkUniqueEmail($event)">
                        </nz-input-group>
                        <ng-template #suffixTemplate>
                            <i *ngIf="!emailUnique" nz-icon nz-tooltip nzTooltipTitle="Extra information"
                                nzType="close-circle" [nzTheme]="'twotone'" nzTwotoneColor="red"></i>
                            <i *ngIf="emailUnique" nz-icon nz-tooltip nzTooltipTitle="Extra information"
                                nzType="check-circle" [nzTheme]="'twotone'" nzTwotoneColor="#46bc16"></i>
                        </ng-template>
                    </div>
                </div>
                <div style="display:block;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                        <label style="font-size:14px;color:#000000;">
                            Job Title
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <input style="margin-bottom:2px;" placeholder="Job Title" nz-input
                            [(ngModel)]="selectedUser.jobTitle" ngDefaultControl nzSize="small"
                            (ngModelChange)="onJobTitleChange($event)" [nzAutocomplete]="auto"
                            (keydown.enter)="setJobTitle($event)" (blur)="setJobTitle($event)" />
                        <nz-autocomplete [nzDataSource]="matchingJobTitles" #auto></nz-autocomplete>
                    </div>
                </div>
                <div *ngIf="selectedUser?._id !== authenticatedUser._id" style="display:block;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                        <label style="font-size:14px;color:#000000;">
                            Supervisor
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <input style="margin-bottom:2px;" nz-input placeholder="Supervisor Name"
                            [(ngModel)]="supervisorName" nzSize="small" (ngModelChange)="onSupervisorNameChange($event)"
                            [nzAutocomplete]="autoSupervisor" />
                        <nz-autocomplete [nzDataSource]="matchingSupervisors" #autoSupervisor>
                        </nz-autocomplete>
                    </div>
                </div>
                <div style="display:block;margin-top:10px;width:90%;">
                    <div style="float:left;width:25%;text-align: right;">
                        <label>
                            User Type
                        </label>
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <nz-radio-group ngDefaultControl [(ngModel)]="selectedUser.userType"
                            style="margin-bottom:20px;">
                            <label nz-radio nzValue="individualContributor" (click)="newSupervisorSelected(false)"
                                style="display:block;font-size:20px;">
                                <i class="fad fa-user" style="vertical-align: bottom;"></i>
                                <span style="margin-left:10px;font-size:12px;">Individual
                                    Contributor</span>
                            </label>
                            <label nz-radio nzValue="supervisor" (click)="newSupervisorSelected(true)"
                                style="display:block;font-size:20px;">
                                <i class="fad fa-user-tie" style="vertical-align: bottom;"></i>
                                <span style="margin-left:10px;font-size:12px;">Supervisor</span>
                            </label>
                            <label nz-radio nzValue="volunteer" (click)="newSupervisorSelected(false)"
                                style="display:block;font-size:20px;">
                                <i class="fad fa-user-cowboy" style="vertical-align: bottom;"></i>
                                <span style="margin-left:10px;font-size:12px;">Volunteer</span>
                            </label>
                            <label nz-radio nzValue="customer" (click)="newSupervisorSelected(false)"
                                style="display:block;font-size:20px;">
                                <i class="fad fa-user-crown" style="vertical-align: bottom;"></i>
                                <span style="margin-left:10px;  font-size:12px;">Customer</span>
                            </label>
                        </nz-radio-group>
                    </div>
                </div>
                <div style="display:block;margin-top:10px;width:90%;">
                    <div style="display:inline-block;width:25%;text-align: right;">
                    </div>
                    <div style="display:inline-block;width:70%;margin-left:20px;">
                        <label nz-checkbox ngDefaultControl [(ngModel)]="selectedUser.teamAdmin"
                            style="margin-top:5px;font-size:12px;" nz-tooltip
                            nzTooltipTitle="Give this person the ability to create, update, delete trainings.">Training
                            Admin
                            Access</label>
                    </div>
                </div>

                <hr>

                <div style="display:block;margin-top:20px;width:90%;text-align: center;">
                    <div style="display:inline-block;width:60%;">
                        <button nz-button nzSize="small" nzShape="round" (click)="handleCancel()" nzType="default"
                            style="margin: 10px;display:inline-block;">Cancel
                        </button>
                        <button *ngIf="newUser" nz-button nzSize="small" nzShape="round" (click)="handleAddUser(true)"
                            nzType="primary" style="margin: 10px;display:inline-block;" [disabled]="!emailUnique">Add
                            Person
                        </button>
                        <button *ngIf="!newUser" nz-button nzSize="small" nzShape="round" (click)="handleUpdateUser()"
                            nzType="primary" style="margin: 10px;display:inline-block;"
                            [disabled]="invalidSupervisorName">Update
                            User
                        </button>
                    </div>
                </div>
            </div>
        </nz-drawer>
        <nz-modal [nzVisible]="showUserTrainingModal" nzTitle="Assign Training"
            [nzCancelDisabled]="assignableTrainings.length === 0" (nzOnCancel)="handleCancelUserTraining()"
            [nzOkDisabled]="!selectedTrainingId" (nzOnOk)="handleAssignUserTraining()"
            style="width:500px;padding:10px;float:left;">
            <div>
                <div style="background-color:white;display:inline-block;width:100%;">
                    <div *ngIf="teamTrainings.length === 0">
                        You have not created any trainings yet!<br> Head over to the <span style="color:blue;">All
                            Trainings</span> page to create your
                        trainings.
                    </div>
                    <div *ngIf="teamTrainings.length > 0 && assignableTrainings.length === 0">
                        You have already assigned all trainings to this user!
                    </div>
                    <div *ngIf="assignableTrainings.length > 0">
                        Select the training you would like to assign.
                    </div>
                    <div *ngFor="let training of assignableTrainings" class="all-training-list-entry"
                        style="padding:10px 20px;width:100%;"
                        [ngClass]="{'selected-training': selectedTrainingId === training._id}"
                        (click)="selectedTrainingId = training._id">
                        <i [ngClass]="allTrainingIdHash[training._id]?.iconClass"
                            style="display:inline-block;font-size:20px;margin-right:10px;vertical-align: middle;"
                            [ngStyle]="{'color': allTrainingIdHash[training._id]?.iconColor}">
                        </i>
                        <div style="display:inline-block;font-size:14px;">
                            {{ training.title }}
                        </div>
                    </div>
                </div>
            </div>
        </nz-modal>
    </div>
</div>