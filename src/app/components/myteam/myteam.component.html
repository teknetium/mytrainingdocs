<div *ngIf="authenticatedUser" style="height:100%;">
    <div class="my-team" style="height:100%;">
        <div *ngIf="myTeam && myTeam.length > 0" style="height:95%;" (drop)="drop($event)"
            (dragover)="allowDrop($event)">
            <div class="team-container" [ngStyle]="{'width.%': teamContainerWidth}">
                <div class="direct-report-container">
                    <div>
                        <span style="font-size:24px;">Team Members</span>
                        <hr style="margin-bottom:10px 0;">
                    </div>
                    <div style="display:block;margin-bottom:20px;">
                        <button nz-button nzShape="round" nzSize="small" (click)="addUser()" nzType="primary"
                            style="float:left;">
                            <i nz-icon nzType="user-add" [nzTheme]="'outline'"
                                style="display:inline-block;font-size:18px;vertical-align:baseline;"></i>Add User
                        </button>
                        <button nz-button nzShape="round" (click)="launchImporter()" nzSize="small" nzType="primary"
                            style="float:right;margin-right:10px;">
                            <i nz-icon nzType="usergroup-add" [nzTheme]="'outline'"
                                style="display:inline-block;font-size:18px;vertical-align:baseline;"></i>Bulk Add
                        </button>
                        <div style="clear:both;"> </div>
                    </div>
                    <div>

                        <hr style="margin-bottom:5px;">
                        <div style="text-align: center;">
                            <span style="font-size:20px;margin-bottom:40px;">Filters</span>&nbsp;&nbsp;
                            <span style="font-size:10px;">(Click to toggle)</span>
                            <div style="display: flex;justify-content:space-between;margin:20px 0;font-size:16px;">
                                <div style="">
                                    <div class="filter-item"
                                        (click)="toggleFilter('up-to-date')"
                                        [ngClass]="{'showing': showUpToDate, 'not-showing': !showUpToDate}" nz-tooltip
                                        nzTooltipTitle="Users who have NO past due trainings">
                                        <i class="fad fa-user" style="color:#75c140"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('past-due')"
                                        [ngClass]="{'showing': showPastDue, 'not-showing': !showPastDue}" nz-tooltip
                                        nzTooltipTitle="Users with at least one Past Due training">
                                        <i class="fad fa-user" style="color:red;"></i>
                                    </div>
                                </div>
                                <div style="">
                                    <!--
                                    <div style="display:block;">
                                        <span style="font-size:12px;">User Type</span>
                                    </div>
                                    -->
                                    <div class="filter-item"
                                        (click)="toggleFilter('individual-contributor')"
                                        [ngClass]="{'showing': showIndividualContributors, 'not-showing': !showIndividualContributors}"
                                        nz-tooltip nzTooltipTitle="Individual Contributors">
                                        <i class="fad fa-user" style="color:#000000"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('supervisor')"
                                        [ngClass]="{'showing': showSupervisors, 'not-showing': !showSupervisors}"
                                        nz-tooltip nzTooltipTitle="Supervisors">
                                        <i class="fad fa-user-tie" style="color:#000000;"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('volunteer')"
                                        [ngClass]="{'showing': showVolunteers, 'not-showing': !showVolunteers}"
                                        nz-tooltip nzTooltipTitle="Volunteers">
                                        <i class="fad fa-user-cowboy" style="color:#000000;"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('customer')"
                                        [ngClass]="{'showing': showCustomers, 'not-showing': !showCustomers}" nz-tooltip
                                        nzTooltipTitle="Customers">
                                        <i class="fad fa-user-crown" style="color:#000000;"></i>
                                    </div>
                                </div>
                                <div style="">
                                    <div class="filter-item"
                                        (click)="toggleFilter('trainingUpToDate')"
                                        [ngClass]="{'showing': showUpToDateTrainings, 'not-showing': !showUpToDateTrainings}"
                                        nz-tooltip nzTooltipTitle="In Progress Trainings">
                                        <i nz-icon nzType="smile" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'"
                                            style="vertical-align: middle;"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('trainingCompleted')"
                                        [ngClass]="{'showing': showCompletedTrainings, 'not-showing': !showCompletedTrainings}"
                                        nz-tooltip nzTooltipTitle="Completed Trainings">
                                        <i nz-icon nzType="check-circle" [nzTheme]="'twotone'"
                                            [nzTwotoneColor]="'#4891f7'" style="vertical-align: middle;"></i>
                                    </div>
                                    <div class="filter-item"
                                        (click)="toggleFilter('trainingPastDue')"
                                        [ngClass]="{'showing': showPastDueTrainings, 'not-showing': !showPastDueTrainings}"
                                        nz-tooltip nzTooltipTitle="Past Due Trainings">
                                        <i nz-icon nzType="exclamation-circle" [nzTheme]="'twotone'"
                                            [nzTwotoneColor]="'red'" style="vertical-align: middle;"></i>
                                    </div>
                                </div>
                                <div style="">
                                    <div class="filter-item"
                                        (click)="toggleFilter('onetime')" [ngClass]="{'showing': showOnetime, 'not-showing': !showOnetime}" nz-tooltip
                                        nzTooltipTitle="One-time Trainings" style="padding-top:5px;">
                                        <div style="border:1px solid black;border-radius: 8px;width:16px;height:16px;text-align: center;">
                                            <span style="font-size:10px;vertical-align: top;">1</span>
                                        </div>
                                    </div>
                                    <div  class="filter-item" (click)="toggleFilter('recurring')"
                                        [ngClass]="{'showing': showRecurring, 'not-showing': !showRecurring}" nz-tooltip
                                        nzTooltipTitle="Recurring Trainings">
                                        <i class="far fa-redo-alt" style="color:black;font-size:14px;vertical-align: middle;"></i>
                                    </div>
                                </div>
                                <!--
                                <div style="display:block;width:100%;text-align: center;margin-top:10px;">
                                    <span style="display:block;font-size:12px;">Trainings</span>
                                    <div *ngFor="let training of teamTrainings" (click)="toggleFilter(training._id)"
                                        style="margin-right:1px;cursor:pointer;display:inline-block;padding:2px;border-radius:4px;border:1px solid #bbbbbb;">
                                        <i [ngClass]="training.iconClass" style="display:inline-block;font-size:16px;"
                                            [ngStyle]="{'color': training.iconColor}">
                                        </i>
                                    </div>
                                    <div style="clear:both;"></div>
                                </div>
                                -->
                            </div>
                        </div>
                    </div>
                    <div style="background-color: white;text-align:left;">
                        <div *ngIf="authenticatedUser$ | async as user" class='user-button' style="font-size:20px;"
                            (click)="selectUser(user._id)"
                            [ngClass]="{'user-selected': selectedUser._id === user._id }">
                            <i [ngClass]="userTypeIconHash[user.userType]"
                                [ngStyle]="{'color': userTrainingStatusColorHash[user.trainingStatus]}" nz-tooltip
                                [nzTooltipTitle]=""></i>&nbsp;
                            <span style="display:inline-block;">{{ user.firstName }} {{ user.lastName }} </span>&nbsp;
                            <div *ngFor="let ut of uidUTHash[user._id]" style="float:right;margin-left:3px;" nz-tooltip
                                [nzTooltipTitle]="allTrainingIdHash[ut.tid].title"
                                [ngClass]="{'displayNone': (!showUpToDateTrainings && ut.status === 'upToDate') || (!showCompletedTrainings && ut.status === 'completed') || (!showPastDueTrainings && ut.status === 'pastDue') || (!showOnetime && allTrainingIdHash[ut.tid].type === 'onetime') || (!showRecurring && allTrainingIdHash[ut.tid].type === 'recurring')}">
                                <i [ngClass]="allTrainingIdHash[ut.tid].iconClass"
                                    style="font-size:16px;text-align: center;vertical-align: middle;"
                                    [ngStyle]="{'color': allTrainingIdHash[ut.tid].iconColor}">
                                </i>
                            </div>
                        </div>
                        <div style="cursor:pointer;width:100%;">
                            <div *ngFor="let user of myTeam"
                                [ngClass]="{'displayNone': (!showUpToDate && user.trainingStatus === 'upToDate') || (!showPastDue && user.trainingStatus === 'pastDue') || (!showIndividualContributors && user.userType === 'individualContributor') || (!showSupervisors && user.userType === 'supervisor') || (!showVolunteers && user.userType === 'volunteer') || (!showCustomers && user.userType === 'customer')}"
                                style="width:100%;">
                                <div *ngIf="user._id !== authenticatedUser._id" class="user-button"
                                    [ngClass]="{'user-selected': selectedUser._id === user._id}"
                                    (click)="selectUser(user._id)" style="width:100%;">
                                    <i [ngClass]="userTypeIconHash[user.userType]"
                                        [ngStyle]="{'color': userTrainingStatusColorHash[user.trainingStatus]}"
                                        style="margin:5px 4px 0 10px;float:left;"></i>&nbsp;
                                    <span style="float:left;margin:2px 4px 0 0;">{{ user.firstName }}
                                        {{ user.lastName }}</span>&nbsp;
                                    <nz-badge *ngIf="user.teamAdmin === true" nzColor="purple" nz-tooltip
                                        nzTooltipTitle="Admin User" style="float:left;margin:2px 4px 0 0;"></nz-badge>
                                    <nz-badge *ngIf="user.userStatus === 'pending'" nzColor="gold" nz-tooltip
                                        nzTooltipTitle="User Account Pending" style="float:left;margin:2px 4px 0 0;;">
                                    </nz-badge>
                                    <div *ngFor="let ut of uidUTHash[user._id]" style="float:right;margin-left:3px;"
                                        [ngClass]="{'displayNone': (!showUpToDateTrainings && ut.status === 'upToDate') || (!showCompletedTrainings && ut.status === 'completed') || (!showPastDueTrainings && ut.status === 'pastDue') || (!showOnetime && allTrainingIdHash[ut.tid].type === 'onetime') || (!showRecurring && allTrainingIdHash[ut.tid].type === 'recurring') }">
                                        <i [ngClass]="allTrainingIdHash[ut.tid].iconClass"
                                            style="font-size:16px;text-align: center;vertical-align: middle;" nz-tooltip
                                            [nzTooltipTitle]="allTrainingIdHash[ut.tid].title"
                                            [ngStyle]="{'color': allTrainingIdHash[ut.tid].iconColor}">
                                        </i>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div style="position:relative;cursor:grabbing;width:1px;float:left;height:100%;color:#dddddd;border:1px solid #dddddd;"
                [ngStyle]="{'background-color': resizeBarColor}" draggable="true" (dragstart)="onDragStart($event)"
                (drag)="onDrag($event)" (dragend)="onDragEnd($event)">
                <i class="fas fa-grip-lines-vertical"
                    style="cursor:grabbing;position:absolute;top:50%;right:-6px;color:black;font-size:24px;"></i>
            </div>
            <div class="my-team-rightside" [ngStyle]="{'width.%': 99 - teamContainerWidth}" style="position:relative;">
                <div style="text-align: center;">
                    <span style="font-size:24px;display:inline-block;">Member Details</span>
                    <hr style="margin-bottom:10px 0;">
                </div>
                <div *ngIf="selectedUser" style="overflow-y: hidden;">
                    <div class="" style="width:100%;height:44px;text-align: center;">
                        <i [ngClass]="userTypeIconHash[selectedUser.userType]" style="font-size:20px;"
                            [ngStyle]="{'color': userTrainingStatusColorHash[selectedUser.trainingStatus]}" nz-tooltip
                            [nzTooltipTitle]=""></i>&nbsp;
                        <span
                            style="display:inline-block;margin-left:10px;font-size:26px;font-weight: 300;">{{selectedUser.firstName}}
                            {{selectedUser.lastName}}</span>
                        &nbsp;&nbsp;&nbsp;
                    </div>
                    <div style=" width:100%;">
                        <nz-modal [nzVisible]="showUserTrainingModal" nzTitle="Assign Training To User"
                            [nzCancelDisabled]="assignableTrainings.length === 0"
                            (nzOnCancel)="handleCancelUserTraining()" [nzOkDisabled]="!selectedTrainingId"
                            (nzOnOk)="handleAssignUserTraining()" style="width:500px;padding:10px;float:left;">
                            <div>
                                <div style="background-color:white;display:inline-block;width:100%;">
                                    <div *ngIf="teamTrainings.length === 0">
                                        You have not created any trainings yet!<br> Head over to the <span
                                            style="color:blue;">All
                                            Trainings</span> page to create your
                                        trainings.
                                    </div>
                                    <div *ngIf="teamTrainings.length > 0 && assignableTrainings.length === 0">
                                        You have already assigned all trainings to this user!
                                    </div>
                                    <div *ngIf="assignableTrainings.length > 0">
                                        Select the training you would like to assign to this user.
                                    </div>
                                    <div *ngFor="let training of assignableTrainings" class="all-training-list-entry"
                                        style="padding:10px 20px;width:100%;"
                                        [ngClass]="{'selected-training': selectedTrainingId === training._id}"
                                        (click)="selectedTrainingId = training._id">
                                        <!--
                                        <i *ngIf="allTrainingIdHash[training._id].status === 'unlocked'" nz-icon
                                            nzType="unlock" [nzTheme]="'twotone'"
                                            style="margin-right:10px;display:inline-block;font-size:12px;vertical-align: middle;"
                                            [nzTwotoneColor]="'#52c41a'"></i>
                                        <i *ngIf="allTrainingIdHash[training._id].status === 'locked'" nz-icon
                                            nzType="lock" [nzTheme]="'twotone'"
                                            style="margin-right:10px;display:inline-block;font-size:12px;vertical-align: middle;"
                                            [nzTwotoneColor]="'red'"></i>
                                            -->

                                        <i [ngClass]="allTrainingIdHash[training._id].iconClass"
                                            style="display:inline-block;font-size:20px;margin-right:10px;vertical-align: middle;"
                                            [ngStyle]="{'color': allTrainingIdHash[training._id].iconColor}">
                                        </i>
                                        <div style="display:inline-block;font-size:14px;">
                                            {{ training.title }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </nz-modal>

                        <div style="width:100%;">
                            <button nz-button nzType="primary" nzShape="round" nzSize="small"
                                (click)="showUserTrainingModal = true" style="margin-right:10px;">
                                Assign a Training
                            </button>
                            <button nz-button nzType="primary" nzShape="round" nzSize="small" style="margin-right:10px;"
                                (click)="editUser()">
                                Edit Profile
                            </button>
                            <button nz-button nzType="primary" nzShape="round" nzSize="small" style="margin-right:10px;"
                                nz-popconfirm nzPopconfirmTitle="Delete this user?"
                                (nzOnConfirm)="confirmDelete(selectedUser)">
                                Delete User
                            </button>
                            <div style="clear:both;margin-bottom:20px;"></div>
                            <app-user-trainings mode="admin" logSession="off"></app-user-trainings>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <nz-modal [(nzVisible)]="showNewUserModal" nzTitle="Team Member Registration" (nzOnCancel)="handleCancel()"
            (nzOnOk)="handleAddUser(true)">
            <div style="padding:20px;color:#000000;">
                <p style="font-size:16px;">
                    An email will be sent to the team member being registered in order for them to complete the
                    registration
                    process.
                </p>

            </div>
            <div style="z-index: 1000;background-color: white;">
                <input nz-input nzSize="small" type="text" placeholder="First Name" ngDefaultControl
                    [(ngModel)]="newTeamMember.firstName" style="margin-bottom:10px;">
                <input nz-input nzSize="small" type="text" placeholder="Last Name" ngDefaultControl
                    [(ngModel)]="newTeamMember.lastName" style="margin-bottom:10px;">
                <input nz-input nzSize="small" type="text" placeholder="Email" ngDefaultControl
                    [(ngModel)]="newTeamMember.email" style="margin-bottom:20px;">
                <input nz-input nzSize="small" type="text" placeholder="Job Title" ngDefaultControl
                    [(ngModel)]="newTeamMember.jobTitle" style="display:inline-block;margin-bottom:20px;"
                    (input)="onInput($event.target?.value)" [nzAutocomplete]="auto">
                <nz-autocomplete nzBackfill #auto>
                    <nz-auto-option *ngFor="let option of options" [nzValue]="option">
                        {{ option }}
                    </nz-auto-option>
                </nz-autocomplete>
                <span style="margin-right:20px;float:left;">User Type</span>
                <nz-radio-group ngDefaultControl [(ngModel)]="newTeamMember.userType" style="margin-bottom:20px;">
                    <label nz-radio nzValue="individualContributor" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:28px;">
                        <i class="fad fa-user" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:14px;">Individual Contributor</span>
                    </label>
                    <label nz-radio nzValue="supervisor" (click)="newSupervisorSelected(true)"
                        style="display:block;font-size:28px;">
                        <i class="fad fa-user-tie" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:14px;">Supervisor</span>

                    </label>
                    <label nz-radio nzValue="volunteer" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:28px;">
                        <i class="fad fa-user-cowboy" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:14px;">Volunteer</span>

                    </label>
                    <label nz-radio nzValue="customer" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:28px;">
                        <i class="fad fa-user-crown" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;  font-size:14px;">Customer</span>

                    </label>
                </nz-radio-group>
            </div>
            <div [@supervisorSignupToggle]="isNewSupervisorPanelOpen ? 'open' : 'closed'"
                style="z-index: -1;height:50px;overflow: hidden;padding-left:30px;">
                <label nz-checkbox ngDefaultControl [(ngModel)]="includeNewSupervisorsTeam">Have this supervisor
                    register their team</label>
            </div>
            <label nz-checkbox ngDefaultControl [(ngModel)]="newTeamMember.teamAdmin" nz-tooltip
                nzTooltipTitle="Give this person the ability to create, update, delete trainings.">Training Admin
                Access</label>
        </nz-modal>
    </div>
</div>
<nz-drawer [nzClosable]="false" [nzMaskClosable]="true" [nzVisible]="userPanelVisible" nzPlacement="right"
    nzTitle="User Profile" [nzWidth]="700">
    <div style="display:block;width:100%;">
        <div style="display:block;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
                <label style="font-size:14px;color:#000000;">
                    First Name
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <input nz-input nzSize="small" type="text" placeholder="First Name" ngDefaultControl
                    [(ngModel)]="selectedUser.firstName" style="margin-bottom:2px;">
            </div>
        </div>
        <div style="display:block;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
                <label style="font-size:14px;color:#000000;">
                    Last Name
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <input nz-input nzSize="small" type="text" placeholder="Last Name" ngDefaultControl
                    [(ngModel)]="selectedUser.lastName" style="margin-bottom:2px;">
            </div>
        </div>
        <div style="display:block;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
                <label style="font-size:14px;color:#000000;">
                    Email
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <input nz-input nzSize="small" type="text" placeholder="Email" ngDefaultControl
                    [(ngModel)]="selectedUser.email" style="margin-bottom:2px;">
            </div>
        </div>
        <div style="display:block;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
                <label style="font-size:14px;color:#000000;">
                    Job Title
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <input style="margin-bottom:2px;" placeholder="Job Title" nz-input [(ngModel)]="selectedUser.jobTitle"
                    ngDefaultControl nzSize="small" (ngModelChange)="onJobTitleChange($event)" [nzAutocomplete]="auto"
                    (keydown.enter)="setJobTitle($event)" (blur)="setJobTitle($event)" />
                <nz-autocomplete [nzDataSource]="matchingJobTitles" #auto></nz-autocomplete>
            </div>
        </div>
        <div style="display:block;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
                <label style="font-size:14px;color:#000000;">
                    Supervisor
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <input nz-input nzSize="small" type="text" placeholder="Supervisor" ngDefaultControl
                    [(ngModel)]="selectedUser.supervisor" style="margin-bottom:2px;">
            </div>
        </div>
        <div style="display:block;margin-top:10px;width:90%;">
            <div style="float:left;width:25%;text-align: right;">
                <label>
                    User Type
                </label>
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <nz-radio-group ngDefaultControl [(ngModel)]="selectedUser.userType" style="margin-bottom:20px;">
                    <label nz-radio nzValue="individualContributor" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:20px;">
                        <i class="fad fa-user" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:12px;">Individual
                            Contributor</span>
                    </label>
                    <label nz-radio nzValue="supervisor" (click)="newSupervisorSelected(true)"
                        style="display:block;font-size:20px;">
                        <i class="fad fa-user-tie" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:12px;">Supervisor</span>
                    </label>
                    <label nz-radio nzValue="volunteer" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:20px;">
                        <i class="fad fa-user-cowboy" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;font-size:12px;">Volunteer</span>
                    </label>
                    <label nz-radio nzValue="customer" (click)="newSupervisorSelected(false)"
                        style="display:block;font-size:20px;">
                        <i class="fad fa-user-crown" style="vertical-align: bottom;"></i>
                        <span style="margin-left:10px;  font-size:12px;">Customer</span>
                    </label>
                </nz-radio-group>
            </div>
        </div>
        <div style="display:block;margin-top:10px;width:90%;">
            <div style="display:inline-block;width:25%;text-align: right;">
            </div>
            <div style="display:inline-block;width:70%;margin-left:20px;">
                <label nz-checkbox ngDefaultControl [(ngModel)]="selectedUser.teamAdmin"
                    style="margin-top:5px;font-size:12px;" nz-tooltip
                    nzTooltipTitle="Give this person the ability to create, update, delete trainings.">Training
                    Admin
                    Access</label>
            </div>
        </div>

        <hr>

        <div style="display:block;margin-top:20px;width:90%;text-align: center;">
            <div style="display:inline-block;width:60%;">
                <button nz-button nzSize="small" nzShape="round" (click)="handleCancel()" nzType="default"
                    style="margin: 10px;display:inline-block;">Cancel
                </button>
                <button *ngIf="newUser" nz-button nzSize="small" nzShape="round" (click)="handleAddUser(true)"
                    nzType="primary" style="margin: 10px;display:inline-block;">Add Person
                </button>
                <button *ngIf="!newUser" nz-button nzSize="small" nzShape="round" (click)="handleUpdateUser()"
                    nzType="primary" style="margin: 10px;display:inline-block;">Update User
                </button>
            </div>
        </div>
    </div>
</nz-drawer>