<div *ngIf="selectedTraining$ | async as selectedTraining"
    [ngClass]="{'training-viewer': !fullscreen, 'training-viewer-fullscreen': fullscreen}">
    <div class="training-header">
        <!--
        <div>
            <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" (click)="closeViewer()"
                style="position:absolute;top:10px;right:40px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Close Training"></i>
        </div>
        -->
        <div>
            <i *ngIf="!fullscreen" nz-icon nzType="fullscreen" [nzTheme]="'outline'" (click)="fullscreen = true"
                style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Expand"></i>
            <i *ngIf="fullscreen" nz-icon nzType="fullscreen-exit" [nzTheme]="'outline'" (click)="fullscreen = false"
                style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Shrink"></i>
        </div>
        <div *ngIf="mode === 'view'"
            style="position:absolute;bottom:5px;right:5px;height:fit-content;width: fit-content;">
            <i nz-icon nzType="like" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'" (click)="like()"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:10px;">
            </i>
            <i nz-icon nzType="dislike" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" (click)="dislike()"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;">
            </i>
            <i nz-icon nzType="message" [nzTheme]="'twotone'" [nzTwotoneColor]="'#6e3fbe'" (click)="addComment()"
                nz-tooltip nzTooltipTitle="Add Comment"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;">
            </i>
            <i nz-icon nzType="check-square" [nzTheme]="'twotone'" (click)="markCompleted()" nz-tooltip
                nzTooltipTitle="Mark As Completed"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;">
            </i>
            <nz-rate [ngModel]="rating" nzAllowHalf></nz-rate>
            <i nz-icon nzType="edit" [nzTheme]="'twotone'" (click)="mode = 'edit'" [nzTwotoneColor]="'orange'" nz-tooltip
                nzTooltipTitle="Edit Mode"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;margin-left:20px;">
            </i>

        </div>
        <div *ngIf="mode === 'edit'"
            style="position:absolute;bottom:5px;right:5px;height:fit-content;width: fit-content;">
            <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" (click)="closeViewer()"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;"
                nz-tooltip nzTooltipTitle="Close Training">
            </i>
            <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'#6e3fbe'"
                nz-tooltip nzTooltipTitle="Delete Training" nz-popconfirm nzPopconfirmTitle="Delete this Training?"
                [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'bottom'" (nzOnConfirm)="confirmDelete(item)"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;">
            </i>
            <i nz-icon nzType="eye" [nzTheme]="'twotone'" nz-tooltip nzTooltipTitle="Preview"
                style="display:inline-block;cursor:pointer;font-size:14px;vertical-align: baseline;margin-right:20px;"
                (click)="mode='view'">
            </i>

        </div>

        <!--
            <div>
                <i *ngIf="mode === 'edit'" nz-icon nzType="question-circle" [nzTheme]="'twotone'"
                    [nzTwotoneColor]="'#6e3fbe'" (click)="helpPanelIsVisible = !helpPanelIsVisible"
                    style="position:absolute;top:40px;right:10px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                    nz-tooltip nzTooltipTitle="Toggle Help Visibility"></i>
            </div>
            -->
        <div class="header-left">
            <i *ngIf="mode === 'edit'" [ngClass]="selectedTraining.iconClass"
                style="display: block;font-size:40px;cursor: pointer;" [ngStyle]="{'color': selectedTraining.iconColor}"
                (click)="isIconSelectModalVisible = true">
            </i>
            <i *ngIf="mode === 'view'" [ngClass]="selectedTraining.iconClass"
                style="display: inlne-block;font-size:40px; " [ngStyle]="{'color': selectedTraining.iconColor}">
            </i>
            <div *ngIf="mode === 'edit'" [style.color]="iconColor" [cpPosition]="'right'"
                [cpPositionRelativeToArrow]="true" (colorPickerChange)="onColorChange($event)"
                [(colorPicker)]="selectedTraining.iconColor" style="cursor: pointer;"
                [ngStyle]="{'color': selectedTraining.iconColor}" nz-tooltip nzTooltipPlacement="bottom"
                nzTooltipTitle="Select icon color">
                <i class="fas fa-palette" style="font-size:14px;color:red;"></i>
            </div>
        </div>
        <div class="header-right">
            <div *ngIf="mode === 'edit'">
                <div style="display:inline-block;margin-right:30px;">
                    <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Training Title</label>
                    <input style="display:inline-block;color:black;margin-bottom:0;font-size:14px;" nz-input
                        [(ngModel)]="selectedTraining.title" nzSize="small" (blur)="saveTraining()" />

                    <span *ngIf="mode === 'view'"
                        style="font-size:18px;display:block;">&nbsp;{{selectedTraining.title}}</span>
                </div>
                <div style="display:inline-block;margin-right:30px;">

                    <label style="margin-bottom: 0;display: block;font-size:12px;color:#bbbbbb;">Estimated Time To
                        Complete</label>
                    <nz-input-number nzSize="small" nzId="estTimeToComplete" class="foo" style="font-size:12px;"
                        [(ngModel)]="selectedTraining.estimatedTimeToComplete" [nzMin]="10" [nzMax]="240" [nzStep]="5"
                        (blur)="saveTraining()">
                    </nz-input-number>
                    <span *ngIf="mode === 'view'">{{ selectedTraining.estimatedTimeToComplete}}</span>
                    <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp; minutes</span>
                </div>

                <div style="display:inline-block;">
                    <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Job Title</label>
                    <input style="display:inline-block;color:black;margin-bottom:0;font-size:14px;" nz-input
                        [(ngModel)]="selectedTraining.jobTitle" nzSize="small" (blur)="saveTraining()" />

                    <span *ngIf="mode === 'view'" style="display:block;">&nbsp;{{selectedTraining.jobTitle}}</span>
                </div>
            </div>
            <div *ngIf="mode === 'view'">
                <span style="font-size:32px;display:inline-block;">&nbsp;{{selectedTraining.title}}</span>

            </div>
        </div>
        <!--
        <div *ngIf="helpPanelIsVisible && mode === 'edit'" class="help-panel">
            <div style="width:80px;position:absolute;top:20px;">
                <i nz-icon nzType="question-circle" [nzTheme]="'twotone'" [twoToneColor]="'#6e3fbe'"
                    style="font-size:40px;margin-left:20px;"></i>
            </div>
            <div class="help-content" [innerHTML]="helpTextHash[currentPageId]">
            </div>
        </div>
        -->
        <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon" (nzOnCancel)="handleIconSelectCancel()"
            nzOkDisabled="false" (nzOnOk)="handleIconSelectConfirm()">
            <mtd-icon-picker (icon)="setIcon($event)"></mtd-icon-picker>
        </nz-modal>
    </div>
    <div style="width:100%; height: 84%; overflow: scroll;">
        <div class="main-content">
            <div *ngIf="!isOpen" class="toc-opener">
                <i nz-icon nzType="menu-unfold" [nzTheme]="'outline'" (click)="toggleTOC(true)"
                    style="cursor:pointer;font-size:24px;vertical-align: baseline;"></i>

            </div>
            <div [@tocToggle]="isOpen ? 'open' : 'closed'" class="toc">
                <div style="position: relative;text-align: left;">
                    <div class="toc-title">
                        Table of Contents
                        <i nz-icon nzType="menu-fold" [nzTheme]="'outline'" (click)="toggleTOC(false)"
                            style="float:right;cursor:pointer;font-size:24px;vertical-align: baseline;margin-left:20px;"></i>
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('intro')"
                        [ngClass]="{'active-toc':currentPageId === 'intro'}">
                        {{selectedTraining.introductionLabel}}
                    </div>

                    <div class="toc-entry" (click)="setCurrentPage('mainContent')"
                        [ngClass]="{'active-toc':currentPageId === 'mainContent'}">
                        Upload Your Content Here
                    </div>

                    <ng-container *ngIf="mode === 'view'">
                        <div class="toc-entry" *ngFor="let page of selectedTraining.pages; index as i"
                            (click)="setCurrentPage(page._id)" [ngClass]="{'active-toc':currentPageId === page._id}">
                            {{page.title}}
                        </div>
                    </ng-container>
                    <div class="toc-entry" (click)="setCurrentPage('assessment')"
                        [ngClass]="{'active-toc':currentPageId === 'assessment'}">
                        Assessment
                    </div>
                </div>
            </div>
            <div class="page-container" [ngStyle]="{'margin-left.px': pageContainerMarginLeft}">
                <div *ngIf="currentPageId === 'intro'" class="page">
                    <div style="margin-top:50px;">
                        <span>
                            <h4>{{selectedTraining.introductionLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'introduction')" nzEditable
                                [(nzContent)]="selectedTraining.introduction"></p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.introduction}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:50px;">
                        <h4>
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummaryLabel')" nzEditable
                                [(nzContent)]="selectedTraining.execSummaryLabel">
                            </p>
                        </h4>
                        <span *ngIf="mode === 'view'">
                            <h4>{{selectedTraining.execSummaryLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummary')" nzEditable
                                [(nzContent)]="selectedTraining.execSummary"></p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.execSummary}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:50px;">
                        <h4>
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'goalsLabel')" nzEditable
                                [(nzContent)]="selectedTraining.goalsLabel">
                            </p>
                        </h4>
                        <span *ngIf="mode === 'view'">
                            <h4>{{selectedTraining.goalsLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph (nzContentChange)="contentChanged($event, 'goals')"
                                nzEditable [(nzContent)]="selectedTraining.goals">
                            </p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.goals}}
                            </span>
                        </span>
                    </div>
                </div>
                <div *ngIf="currentPageId === 'mainContent'" class="page">
                    <mtd-file-mgr></mtd-file-mgr>
                    <!--
                    <i nz-tooltip nzTooltipTitle="Add New File" style="display:inline-block;font-size: 34px;" nz-icon
                        twoToneColor="#619ef3" nzType="file-add" theme="twotone"
                        (click)="openPicker(selectedTraining._id)">
                    </i>
                    <div *ngFor="let fileId of selectedTraining.files; index as fileIndex"
                        style="display:inline-block;">
                        {{fileId}}
                    </div>
                    -->
                </div>

                <div *ngIf="mode === 'view'">
                    <div *ngFor="let page of selectedTraining.pages; index as pageIndex">
                        <div *ngIf="currentPageId === page._id" class="page">
                            <div>
                                <h3>
                                    <p *ngIf="mode === 'edit'" nz-paragraph
                                        (nzContentChange)="pageContentChanged($event, pageIndex, 'title')" nzEditable
                                        [(nzContent)]="page.title">
                                    </p>
                                </h3>
                                <span *ngIf="mode === 'view'">
                                    <h3>{{page.title}}</h3>
                                </span>
                            </div>

                            <div style="padding-left: 30px;">
                                <span style="font-size:18px;">
                                    <p *ngIf="mode === 'edit'" nz-paragraph
                                        (nzContentChange)="pageContentChanged($event, pageIndex, 'intro')" nzEditable
                                        [(nzContent)]="page.intro"></p>
                                    <span *ngIf="mode === 'view'">
                                        {{page.intro}}
                                    </span>
                                </span>
                            </div>
                            <div style="width:100%;height:100%;">

                                <!--
                                <div *ngIf="mode === 'edit'">
                                    <i style="font-size:30px;margin-top: 10px;" twoToneColor="#3f87f5" nz-icon
                                        nzType="file-unknown" theme="twotone" (click)="setContent(portlet)" nz-tooltip
                                        nzTooltipTitle="Change Content">
                                    </i>
                                </div>
                                -->
                                <div style="width:100%;height:100%;">
                                    <div
                                        *ngIf="!(page.file === null) && fileService.getFile(page.file).iconType === 'image'">
                                        <img [src]="fileService.getFile(page.file).versions[0].url" alt="blah" />
                                    </div>
                                    <!-- this next block uses the filestack document viewer -->
                                    <div *ngIf="!(page.file === null)  && previewDocTypes.includes(fileService.getFile(page.file).iconType)"
                                        style="width:100%;height:100%">
                                        <iframe [src]="privateDocumentHash[page._id]" allowfullscreen width="100%"
                                            height="100%">
                                        </iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--
                        <nz-modal [(nzVisible)]="isFileSelectModalVisible" nzTitle="Select Document"
                            (nzOnCancel)="handleCancel()" nzOkDisabled="true">
                            <ul style="list-style-type:none;">
                                <li *ngFor="let item of files$ | async; index as i" class="fileList"
                                    (click)="selectFile(item, i)" style="padding:5px 0;">
                                    <div style="display: inline-block;">
                                        <i *ngIf="item.iconSource === 'ngZorro'" class="font-size-24"
                                            [twoToneColor]="item.iconColor" nz-icon [nzType]="item.iconClass"
                                            theme="twotone"></i>
                                        <i *ngIf="item.iconSource === 'fontawesome'" class="font-size-24"
                                            [ngStyle]="{'color': item.iconColor}" [ngClass]="item.iconClass"></i>
                                    </div>
                                    <div class="" style="display: inline-block;">
                                        &nbsp;&nbsp;&nbsp;&nbsp;{{ item.name }}
                                    </div>
                                </li>
                            </ul>
                        </nz-modal>
                        -->
                        <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon"
                            (nzOnCancel)="handleIconSelectCancel()" nzOkDisabled="false"
                            (nzOnOk)="handleIconSelectConfirm()">
                            <mtd-icon-picker (icon)="setIcon($event)"></mtd-icon-picker>
                        </nz-modal>
                    </div>
                </div>
                <div *ngIf="currentPageId === 'ratingsComments'" class="page">
                    <h3>Ratings & Comments</h3>
                    <nz-rate [(ngModel)]="rating" style="display:block;text-align:left;"></nz-rate>
                </div>
                <div *ngIf="currentPageId === 'assessment'" class="page">
                    <h3>Assessment</h3>
                    <div>
                        <div style="margin-bottom:2px;">
                            Create a test to evaluate mastery of the content presented in this training. Questions are
                            multiple
                            choice and can have multiple correct choices. Each test must include at least 3 questions.
                        </div>
                        <label nz-checkbox [(ngModel)]="applyAssessment"
                            (ngModelChange)="applyAssessmentChanged($event)" style="display:block;margin:20px 0;"
                            nz-popconfirm nzPopconfirmTitle="Remove this assessment?" nzPopconfirmPlacement="bottom"
                            (nzOnConfirm)="deleteItemConfirm()" (nzOnCancel)="deleteItemCancel()">Use
                            this assessment</label>
                        <div>
                            <div *ngFor="let item of assessment.items; index as itemIndex"
                                style="width:90%;border-bottom: 1px solid #bbbbbb;">
                                <span style="display:inline-block;font-size:18px;margin-right:20px;">Question
                                    {{ itemIndex + 1 }}</span>

                                <span style="display: inline-block;width:80%;font-size:22px;">
                                    <p *ngIf="mode === 'edit'" nz-paragraph
                                        (nzContentChange)="questionChanged($event, itemIndex)" nzEditable
                                        [(nzContent)]="item.question">
                                    </p>
                                    <span *ngIf="mode === 'view'">
                                        {{item.question}}
                                    </span>
                                </span>
                                <div style="padding-left:80px;">
                                    <ng-container *ngIf="mode === 'edit'">
                                        <span style="font-size:16px;">Choices - </span>
                                        <span style="font-size:12px;"> select the checkbox to indicate that the choice
                                            is correct. </span>

                                    </ng-container>
                                    <div *ngFor="let choice of item.choices; index as choiceIndex" style="width:100%;">
                                        <ng-container *ngIf="mode === 'edit'">
                                            <label nz-checkbox [(ngModel)]="choice.correct"
                                                (ngModelChange)="choiceContentChanged($event, itemIndex, choiceIndex, 'correct')"
                                                style="display:inline-block;">&nbsp;&nbsp;</label>
                                            <p nz-paragraph
                                                (nzContentChange)="choiceContentChanged($event, itemIndex, choiceIndex, 'text')"
                                                nzEditable [(nzContent)]="choice.text"
                                                style="display:inline-block;width:90%;">
                                        </ng-container>
                                        <div *ngIf="mode === 'view'">
                                            <label nz-checkbox style="display:inline-block;">&nbsp;&nbsp;</label>
                                            <span>{{choice.text}}</span>
                                        </div>
                                    </div>
                                    <i *ngIf="mode === 'edit'" class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon
                                        nzType="plus-square" theme="twotone" (click)="addNewChoice(itemIndex)"
                                        style="margin-bottom:10px;cursor: pointer;"></i>

                                </div>
                            </div>
                            <i *ngIf="mode === 'edit'" class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon
                                nzType="plus-square" theme="twotone" (click)="addNewQuestion()"
                                style="margin-top:10px;cursor: pointer;"></i>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>