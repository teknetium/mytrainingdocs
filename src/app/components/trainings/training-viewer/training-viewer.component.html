<div *ngIf="selectedTraining$ | async as selectedTraining" style="margin:10px;text-align: center;">
    <i class="fad fa-hat-wizard"
        style="color:#951eca;font-size:24px;margin-right:10px;vertical-align: baseline;display:inline-block;"></i>
    <span style="display:inline-block;font-size:20px;">Training Wizard</span>
</div>
<div *ngIf="selectedTraining$ | async as selectedTraining"
    [ngClass]="{'training-viewer': !fullscreen, 'training-viewer-fullscreen': fullscreen}">
    <div class="training-header" [ngClass]="{'activeHelp': currentHelpPanel === 'trainingHeader'}">
        <div>
            <i *ngIf="!fullscreen" nz-icon nzType="fullscreen" [nzTheme]="'outline'" (click)="fullscreen = true"
                style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Expand"></i>
            <i *ngIf="fullscreen" nz-icon nzType="fullscreen-exit" [nzTheme]="'outline'" (click)="fullscreen = false"
                style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Shrink"></i>
            <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" (click)="closeViewer()"
                style="position:absolute;top:10px;right:40px;cursor:pointer;font-size:20px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Close Training">
            </i>
        </div>
        <div *ngIf="trainingStatus === 'Under Development'"
            style="position:absolute;bottom:5px;right:10px;height:fit-content;width: fit-content;">

            <div style="width:fit-content;display:inline-block;">
                <span style="display:inline-block;font-size:12px;">Mode&nbsp;&nbsp;:&nbsp;&nbsp;</span>
                <span nz-dropdown [nzDropdownMenu]="menu"
                    style="display:inline-block;font-size:12px;color: #3958e3;margin-right:20px;">{{ mode }}
                    <i nz-icon nzType="down" style="font-size:12px;vertical-align: middle;"></i>
                </span>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                    <ul nz-menu nzSelectable>

                        <li style="font-size:12px;color: #3958e3;" nz-menu-item (click)="setMode('Edit')"
                            [ngClass]="{'selected-status': mode === 'Edit'}">Edit</li>
                        <li style="font-size:12px;color: #3958e3;" nz-menu-item (click)="setMode('Preview')"
                            [ngClass]="{'selected-status': mode === 'Preview'}">Preview</li>
                    </ul>
                </nz-dropdown-menu>
            </div>
            <div *ngIf="mode === 'Edit'" style="display:inline-block;">
                <i nz-icon nzType="mail" theme="twotone" [nzTwotoneColor]="'gold'" nz-tooltip
                    nzTooltipTitle="Email Interest List" class="header-icon" (click)="postMessageDialog()">
                </i>
                <!--
                <i nz-icon nzType="file-add" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'" nz-tooltip
                    nzTooltipTitle="Add New Document" class="header-icon" (click)="fileService.openPicker($event)"></i>
                    -->
                <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                    nzTooltipTitle="Delete Training" nz-popconfirm nzPopconfirmTitle="Delete this Training?"
                    [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'bottom'"
                    (nzOnConfirm)="confirmDelete(item)" class="header-icon">
                </i>
            </div>
        </div>

        <div class="header-left">
            <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'"
                [ngClass]="selectedTraining.iconClass" nz-tooltip nzTooltipTitle="click to change icon"
                style="display: inline-block;font-size:40px;cursor: pointer;margin:10px;vertical-align: middle;"
                [ngStyle]="{'color': selectedTraining.iconColor}" (click)="showIconSelectModal()">
            </i>
            <i *ngIf="mode === 'Preview'" [ngClass]="selectedTraining.iconClass"
                style="display: inlne-block;font-size:40px;margin:10px;vertical-align: middle;"
                [ngStyle]="{'color': selectedTraining.iconColor}">
            </i>
        </div>
        <div class="header-right">
            <div *ngIf="mode === 'Edit'">
                <div style="margin-right:30px;display: inline-block;">
                    <input style="display:inline-block;color:black;width:350px;font-size:14px;" nz-input
                        [(ngModel)]="selectedTraining.title" nzSize="small" (blur)="saveTraining(false)" />
                </div>
            </div>
            <div *ngIf="mode === 'Preview' || selectedTraining.status === 'In Production'">
                <span
                    style="font-size:26px;display:inline-block;vertical-align: middle;">&nbsp;{{selectedTraining.title}}</span>

            </div>
        </div>
        <nz-modal [(nzVisible)]="messageDialogVisible" nzTitle="Email Interest List"
            (nzOnCancel)="handleEmailInterestListCancel()" (nzOnOk)="emailInterestList()">
            <div style="z-index: 1000;background-color: white;">
                <label style="margin-bottom: 3px;font-size:12px;color:#aaaaaa;">Subject</label>
                <input nz-input type="text" placeholder="Subject" ngDefaultControl [(ngModel)]="subject"
                    style="margin-bottom:10px;">
                <label style="margin-bottom: 3px;font-size:12px;color:#aaaaaa;">Message</label>
                <textarea rows="4" nz-input [(ngModel)]="messageBody"></textarea>
            </div>
        </nz-modal>

        <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon" nzWidth="800"
            (nzOnCancel)="handleIconSelectCancel()" [nzOkDisabled]="okDisabled" [nzCancelDisabled]="cancelDisabled"
            (nzOnOk)="handleIconSelectConfirm()" style="width:800px;">
            <mtd-icon-picker (icon)="setIcon($event)"></mtd-icon-picker>
        </nz-modal>
        <nz-modal [(nzVisible)]="markCompletedModalIsVisible" nzTitle="Mark this Training as Completed" nzWidth="800"
            (nzOnCancel)="handleMarkAsCompletedCancel()" (nzOnOk)="markTrainingAsComplete(selectedTraining)"
            style="width:800px;">
            <span style="display:block;">Rate this Training</span>
            <nz-rate style="display:block;margin-bottom:20px;" [ngModel]="rating" nzAllowHalf class="small"></nz-rate>
            <span style="display:block;">Comments/Feedback</span>
            <textarea style="display:block;" rows="4" nz-input [(ngModel)]="inputValue"></textarea>
        </nz-modal>
    </div>
    <div style="width:100%;overflow: scroll;"
        [ngClass]="{'main-content-container-fullscreen': fullscreen, 'main-content-container': !fullscreen}">
        <div class="main-content">
            <div *ngIf="!isOpen" class="toc-opener">
                <i nz-icon nzType="menu-unfold" [nzTheme]="'outline'" (click)="toggleTOC(true)"
                    style="cursor:pointer;font-size:24px;vertical-align: middle;"></i>

            </div>
            <div [@tocToggle]="isOpen ? 'open' : 'closed'" class="toc"
                [ngClass]="{'activeHelp': currentHelpPanel === 'tableOfContents'}">
                <div style="position: relative;text-align: left;">
                    <div class="toc-title">
                        Table of Contents
                        <i nz-icon nzType="menu-fold" [nzTheme]="'outline'" (click)="toggleTOC(false)"
                            style="float:right;cursor:pointer;font-size:24px;vertical-align: baseline;margin-left:10px;"></i>
                    </div>
                    <div *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" class="toc-entry"
                        (click)="setCurrentPage('trainingWizardTour')"
                        [ngClass]="{'active-toc':currentPageId === 'trainingWizardTour'}">
                        <i nz-icon nzType="car" [nzTheme]="'twotone'" [nzTwotoneColor]="'#d64594'"
                            style="vertical-align: middle;margin-right:10px;"></i>
                        Training Wizard Tour
                    </div>
                    <div *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" class="toc-entry"
                        (click)="setCurrentPage('config')" [ngClass]="{'active-toc':currentPageId === 'config'}">
                        <i nz-icon nzType="setting" [nzTheme]="'twotone'" [nzTwotoneColor]="'orange'"
                            style="vertical-align: middle;margin-right:10px;"></i>
                        Training Configuration
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('intro')"
                        [ngClass]="{'active-toc':currentPageId === 'intro'}">
                        {{selectedTraining.introductionLabel}}
                    </div>
                    <div class="toc-entry" style="cursor: default;">
                        <div style="display:inline-block;line-height:18px;">
                            Main Content
                        </div>
                        <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-icon
                            nzType="file-add" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'" nz-tooltip
                            nzTooltipTitle="Add New Document"
                            style="cursor:pointer;line-height:18px;float:right;font-size:16px;margin-right:10px;"
                            (click)="fileService.openPicker($event)"></i>

                    </div>
                    <div class="toc-main-content-entry" *ngFor="let page of selectedTraining.pages; index as pageIndex"
                        (click)="setCurrentPage(page._id)" [ngClass]="{'active-toc':currentPageId === page._id}">
                        <div style="display:inline-block;line-height:18px;">
                            {{page.title}}
                        </div>
                        <!--
                        <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-icon
                            nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                            nzTooltipTitle="Delete Page" nz-popconfirm nzPopconfirmTitle="Delete this Page?"
                            [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'right'"
                            (nzOnConfirm)="confirmDeletePage(pageIndex)"
                            style="float:right;;cursor:pointer;font-size:14px;vertical-align: baseline;line-height:18px;">
                        </i>
                        -->
                    </div>
                    <div *ngIf="mode === 'Edit' || (mode === 'Preview' && selectedTraining.useAssessment)"
                        class="toc-entry" (click)="setCurrentPage('assessment')"
                        [ngClass]="{'active-toc':currentPageId === 'assessment'}">
                        Assessment
                    </div>
                    <div *ngIf="selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'"
                        class="toc-entry" (click)="setCurrentPage('comments')"
                        [ngClass]="{'active-toc':currentPageId === 'comments'}">
                        <i nz-icon nzType="message" [nzTheme]="'twotone'" [nzTwotoneColor]="'#6e3fbe'"
                            style="vertical-align: middle;margin-right:10px;"></i>
                        Comments
                    </div>
                </div>
            </div>
            <div class="page-container" [ngStyle]="{'margin-left.px': pageContainerMarginLeft}"
                [ngClass]="{'activeHelp': currentHelpPanel === 'mainContent'}">
                <div *ngIf="currentPageId === 'config' && mode === 'Edit' && selectedTraining.status === 'Under Development'"
                    class="page">
                    <i nz-icon nzType="setting" [nzTheme]="'twotone'" [nzTwotoneColor]="'orange'"
                        style="display:inline-block;cursor:pointer;font-size:24px;vertical-align: baseline;margin-right:20px;">
                    </i>
                    <h3 style="display:inline-block;text-align: left;margin-bottom:30px;">Training Configuration</h3>
                    <div>
                        <h5>General</h5>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;display: inline-block;font-size:12px;color:#bbbbbb;">
                                    Estimated Time To Complete
                                </label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <nz-input-number nzSize="small" nzId="estTimeToComplete" class="foo"
                                    style="font-size:12px;" [(ngModel)]="selectedTraining.estimatedTimeToComplete"
                                    [nzMin]="10" [nzMax]="240" [nzStep]="5" (blur)="saveTraining(false)">
                                </nz-input-number>
                                <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp; minutes</span>
                            </div>
                        </div>

                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Job Title</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">

                                <input
                                    style="display:inline-block;color:black;margin-bottom:0;font-size:14px;width:50%;"
                                    nz-input [(ngModel)]="selectedTraining.jobTitle" nzSize="small"
                                    (blur)="saveTraining(false)" />
                            </div>
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;float:left;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Interest List</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <div>
                                    <div style="width:35%;text-align: left;display:inline-block;">
                                        <input nz-input nzSize="small" class="foo" style="font-size:12px;"
                                            [(ngModel)]="emailAddr" placeholder="Email Address" />
                                    </div>
                                    <i class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon nzType="plus-square"
                                        theme="twotone" [nzTwotoneColor]="'#52c41a'" (click)="addEmailToInterestList()"
                                        style="display:inline-block;cursor: pointer;margin-left:10px;" nz-tooltip
                                        nzTooltipTitle="Add Email to List"></i>
                                </div>

                                <div style="display:block;padding-top:5px;"
                                    *ngFor="let email of selectedTraining.interestList; index as i">
                                    {{ email }}
                                    <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                        nz-popconfirm nzPopconfirmTitle="Delete this email address?"
                                        [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'right'"
                                        (nzOnConfirm)="deleteInterestListItem(i)"
                                        style="font-size:14px;vertical-align: baseline; margin-left:10px;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--
                    <div style="margin-top:30px;">
                        <h5>Assessment</h5>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Use Assessment</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">

                                <label nz-checkbox [(ngModel)]="selectedTraining.useAssessment"
                                    (click)="saveTraining()"></label>
                            </div>
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Assessment Time
                                    Limit</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <nz-input-number nzSize="small" nzId="timeLimit" class="foo" style="font-size:12px;"
                                    [(ngModel)]="selectedTraining.assessment.timeLimit" [nzMin]="0" [nzMax]="60"
                                    [nzStep]="1" (blur)="saveTraining()">
                                </nz-input-number>
                                <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp; minutes&nbsp;&nbsp;( 0
                                    indicates no time limit )</span>
                            </div>
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Passing Grade</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <nz-input-number nzSize="small" nzId="passingGrade" class="foo" style="font-size:12px;"
                                    [(ngModel)]="selectedTraining.assessment.passingGrade" [nzMin]="50" [nzMax]="100"
                                    [nzStep]="5">
                                </nz-input-number>
                                <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp;%</span>
                            </div>
                        </div>
                    </div>
                    -->
                </div>

                <div *ngIf="currentPageId === 'trainingWizardTour' && mode === 'Edit' && selectedTraining.status === 'Under Development'"
                    class="page" [ngClass]="{'activeHelp': currentHelpPanel === 'mainContent'}">
                    <i nz-icon nzType="car" [nzTheme]="'twotone'" [nzTwotoneColor]="'#d64594'"
                        style="display:inline-block;cursor:pointer;font-size:24px;vertical-align: baseline;margin-right:20px;">
                    </i>
                    <h3 style="display:inline-block;text-align: left;margin-bottom:30px;">Training Wizard Tour </h3>

                    <div>
                        <div>
                            <div style="text-align: center;margin-bottom:10px;font-size: 18px;">
                                Welcome to the Training Wizard Tour!
                            </div>
                            <p>
                                This page introduces you to the 3 components of the Training Wizard.
                            </p>
                        </div>
                        <button *ngIf="!runningTour" nz-button nzType="primary" (click)="beginTour()"
                            style="margin-top:10px;">Begin
                            Tour</button>
                        <nz-collapse *ngIf="runningTour" [nzBordered]="false" [nzAccordion]="true">
                            <nz-collapse-panel [nzHeader]="trainingHeader"
                                (nzActiveChange)="setCurrentHelpPanel('trainingHeader')">
                                <div style="padding:0 30px;margin-bottom:20px;">
                                    This component gives you access to the following features and functions:
                                </div>
                                <div style="display:block;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:14px;font-weight:300;color:#999999;">
                                        <i [ngClass]="selectedTraining.iconClass"
                                            [ngStyle]="{'color': selectedTraining.iconColor}"
                                            style="font-size:18px;color:black;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This is the icon that will be used to identify your training. Clicking the icon
                                        brings up the customization dialog.
                                    </div>
                                </div>
                                <nz-divider></nz-divider>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:14px;font-weight:400">
                                        Mode
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This dropdown menu allows you to toggle between <span
                                            style="color:blue;">Edit</span> and <span style="color:blue;">Preview</span>
                                        mode. <span style="color:blue;">Preview</span>
                                        mode removes all of the editing and configuration features to simulate the
                                        training in a production environment.
                                    </div>
                                </div>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="mail" [nzTheme]="'twotone'" [nzTwotoneColor]="'gold'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This icon brings up a dialog that allows you to send a message to the email
                                        addresses
                                        on the interest list for this training.
                                    </div>
                                </div>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="file-add" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This icon brings up the file upload dialog. From there you can
                                        identfy and upload the documents used in this training.
                                    </div>
                                </div>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        Clicking this icon deletes the training (with confirmation).
                                    </div>
                                </div>
                                <nz-divider></nz-divider>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="fullscreen" [nzTheme]="'outline'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        Clicking on this icon switches to fullscreen mode.
                                    </div>
                                </div>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        Clicking on this icon closes the training.
                                    </div>
                                </div>
                            </nz-collapse-panel>
                            <nz-collapse-panel [nzHeader]="tableOfContents"
                                (nzActiveChange)="setCurrentHelpPanel('tableOfContents')">
                                <div style="padding:0 30px;margin-bottom:20px;">
                                    This component provides page navigation.
                                    <br><br>
                                    The following two pages are only available when the <b>Mode</b> is
                                    <span style="color:blue;">Edit</span>.
                                    <div style="display:block;margin-top:20px;">
                                        <div
                                            style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                            <i nz-icon nzType="car" [nzTheme]="'twotone'" [nzTwotoneColor]="'#d64594'"
                                                style="font-size:18px;vertical-align: top;"></i>
                                        </div>
                                        <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                            This loads the page you are currently viewing.
                                        </div>
                                    </div>
                                    <div style="display:block;margin-top:20px;">
                                        <div
                                            style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                            <i nz-icon nzType="setting" [nzTheme]="'twotone'"
                                                [nzTwotoneColor]="'orange'"
                                                style="font-size:18px;vertical-align: top;"></i>
                                        </div>
                                        <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                            This loads the Training Configuration page.
                                        </div>
                                    </div>
                                    <br><br>
                                    <span style="font-weight:600;">Training Introduction</span> - This page needs no
                                    explanation.
                                    <br><br>
                                    <span style="font-weight:600;">Assessment</span> - This is where you create the exam
                                    to verify mastery of the training content.
                                    Validation of the test is done in <span style="color:blue;">Preview</span> mode.
                                    <br><br>
                                    When documents are uploaded to a training, the document name is added to this list.
                                </div>
                            </nz-collapse-panel>
                            <nz-collapse-panel [nzHeader]="mainContent"
                                (nzActiveChange)="setCurrentHelpPanel('mainContent')">
                                <div style="padding:0 30px;margin-bottom:20px;">
                                    This is the content viewing component. &nbsp;&nbsp; Selecting entries in the Table
                                    of Contents
                                    loads the selected page here.
                                </div>
                            </nz-collapse-panel>
                            <ng-template #trainingHeader>
                                <span style="font-size:16px;font-weight:300;"
                                    [ngClass]="{'activeHelpPanelHeader': currentHelpPanel === 'trainingHeader'}">Training
                                    Header</span>
                            </ng-template>
                            <ng-template #tableOfContents>
                                <span style="font-size:16px;font-weight:300;"
                                    [ngClass]="{'activeHelpPanelHeader': currentHelpPanel === 'tableOfContents'}">Table
                                    Of Contents</span>
                            </ng-template>
                            <ng-template #mainContent>
                                <span style="font-size:16px;font-weight:300;"
                                    [ngClass]="{'activeHelpPanelHeader': currentHelpPanel === 'mainContent'}">Main
                                    Content Area</span>
                            </ng-template>
                        </nz-collapse>
                        <button *ngIf="runningTour" nz-button nzType="primary" (click)="endTour()"
                            style="margin-top:10px;">End
                            Tour</button>
                    </div>
                </div>

                <div *ngIf="currentPageId === 'comments' && (mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production')"
                    class="page">
                    <i nz-icon nzType="message" [nzTheme]="'twotone'" [nzTwotoneColor]="'#6e3fbe'"
                        style="display:inline-block;cursor:pointer;font-size:24px;vertical-align: baseline;margin-right:20px;">
                    </i>
                    <h3 style="display:inline-block;text-align: left;margin-bottom:30px;">Comments</h3>
                    <div style="padding:20px;background-color:white;">
                        <nz-list *ngIf="data.length" [nzDataSource]="data" [nzRenderItem]="item"
                            [nzItemLayout]="'horizontal'">
                            <ng-template #item let-item>
                                <nz-comment [nzAuthor]="item.author" [nzDatetime]="item.displayTime">
                                    <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="item.avatar"></nz-avatar>
                                    <nz-comment-content>
                                        <p>{{ item.content }}</p>
                                    </nz-comment-content>
                                </nz-comment>
                            </ng-template>
                        </nz-list>
                        <nz-comment>
                            <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="user.avatar"></nz-avatar>
                            <nz-comment-content>
                                <nz-form-item>
                                    <textarea [(ngModel)]="inputValue" nz-input rows="4"></textarea>
                                </nz-form-item>
                                <nz-form-item>
                                    <button nz-button nzType="primary" [nzLoading]="submitting" [disabled]="!inputValue"
                                        (click)="handleSubmit()">
                                        Add Comment
                                    </button>
                                </nz-form-item>
                            </nz-comment-content>
                        </nz-comment>

                    </div>
                </div>
                <div *ngIf="currentPageId === 'intro'" class="page">
                    <h3 style="text-align: center;margin-bottom:20px;">{{selectedTraining.introductionLabel}}</h3>

                    <div>
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'introduction')" nzEditable
                                [(nzContent)]="selectedTraining.introduction"></p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                                {{selectedTraining.introduction}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:30px;">
                        <h4>
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummaryLabel')" nzEditable
                                [(nzContent)]="selectedTraining.execSummaryLabel">
                            </p>
                        </h4>
                        <span
                            *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                            <h4>{{selectedTraining.execSummaryLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding:0 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummary')" nzEditable
                                [(nzContent)]="selectedTraining.execSummary"></p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                                {{selectedTraining.execSummary}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:30px;">
                        <h4>
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'goalsLabel')" nzEditable
                                [(nzContent)]="selectedTraining.goalsLabel">
                            </p>
                        </h4>
                        <span
                            *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                            <h4>{{selectedTraining.goalsLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding:0 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'goals')" nzEditable
                                [(nzContent)]="selectedTraining.goals">
                            </p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                                {{selectedTraining.goals}}
                            </span>
                        </span>
                    </div>
                </div>
                <div>
                    <div *ngFor="let page of selectedTraining.pages; index as pageIndex">
                        <!-- page actions -->
                        <div *ngIf="currentPageId === page._id" class="page">
                            <div style="position:absolute;top:20px;right:20px;width:fit-content;height:fit-content;">
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-icon
                                    nzType="up-square" [ngClass]="{'disabled': pageIndex === 0}" [nzTheme]="'twotone'"
                                    nz-tooltip nzTooltipTitle="Move document up in list"
                                    (click)="movePage(pageIndex, -1)" class="page-action">
                                </i>
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-icon
                                    nzType="down-square" [nzTheme]="'twotone'" nz-tooltip
                                    [ngClass]="{'disabled': pageIndex === selectedTraining.pages.length - 1}"
                                    nzTooltipTitle="Move document down in list" (click)="movePage(pageIndex, 1)"
                                    class="page-action">
                                </i>
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'" nz-icon
                                    nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                                    nzTooltipTitle="Delete Page" nz-popconfirm nzPopconfirmTitle="Delete this Page?"
                                    [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'right'"
                                    (nzOnConfirm)="confirmDeletePage(pageIndex)" class="page-action">
                                </i>

                            </div>
                            <div>
                                <h3 *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'"
                                    style="text-align: center;margin-bottom:30px;">
                                    <p nz-paragraph (nzContentChange)="pageContentChanged($event, pageIndex, 'title')"
                                        nzEditable [(nzContent)]="page.title">
                                    </p>
                                </h3>
                                <span
                                    *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                                    <h3 style="text-align: center;margin-bottom:30px;">{{page.title}}</h3>
                                </span>
                            </div>

                            <div>
                                <span style="font-size:16px;">
                                    <p *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'"
                                        nz-paragraph (nzContentChange)="pageContentChanged($event, pageIndex, 'intro')"
                                        nzEditable [(nzContent)]="page.intro"></p>
                                    <span
                                        *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'">
                                        {{page.intro}}
                                    </span>
                                </span>
                            </div>
                            <div *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'">
                                <button *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'"
                                    nz-button nzType="default" [nzSize]="'small'" (click)="uploadNewVersion()">
                                    <i nz-icon nzType="upload" [nzTheme]="'outline'"></i>
                                    <span style="font-size:12px;">Upload New Version</span>
                                </button>
                                <div
                                    style="text-align:center;display:block;width:100%;margin-top:2px;margin-bottom:5px;font-size:12px;">
                                    <nz-table nzSize="small" nzBordered="false" nzShowPagination="false"
                                        [nzData]="fileService.getFile(page.file).versions"
                                        style="width:100%;background-color: #fafafa;font-size:12px;display:inline-block;">
                                        <thead>
                                            <tr style="font-size:12px;">
                                                <th>Version</th>
                                                <th>Comments</th>
                                                <th>Date Uploaded</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let version of fileService.getFile(page.file).versions; let i = index;"
                                                [ngClass]="{'current-version': currentVersionIndex === i}"
                                                (click)="viewVersion(i)"
                                                style="cursor: pointer;font-size:12px;background-color: white;line-height:10px;">
                                                <td style="font-size:12px;width:10%;">
                                                    {{ version.version }}
                                                </td>
                                                <td style="font-size:12px;width:50%;">
                                                    {{ version.changeLog }}
                                                </td>
                                                <td style="font-size:12px;width:25%;">
                                                    {{ version.dateUploaded | date:'medium'}}
                                                </td>
                                                <td style="font-size:14px;width:15%;text-align: center;">
                                                    <i nz-icon nzType="download" [nzTheme]="'outline'" nz-tooltip
                                                        nzTooltipTitle="Download Document"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </nz-table>
                                </div>
                                <nz-modal [(nzVisible)]="isNewVersionModalVisible"
                                    [nzTitle]="fileService.getFile(page.file).name" nzWidth="60%" nzOkDisabled="false"
                                    nzCancelDisabled="false" (nzOnCancel)="dismissNewVersionModal()"
                                    (nzOnOk)="handleNewVersionContinue()">
                                    <div style="display: inline-block;width:20%;padding-bottom:30px;">
                                    </div>
                                    <div style="display:inline-block;width:80%;">
                                        <h3 nz-title>
                                            What actions should be taken as a result of the changes you have made?
                                        </h3>
                                    </div>
                                    <div style="clear: both;"></div>
                                    <div style="display: block;">
                                        <nz-radio-group [(ngModel)]="changeLevel">
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="major">Reset
                                                training
                                                status for all responsible users. </label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="middle">Notify
                                                all
                                                responsible users.</label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="minor">No action
                                                needed.</label>
                                        </nz-radio-group>
                                        <p *ngIf="error1" style="color:red;">Please select one of the 3 options.</p>
                                        <p>
                                            Please describe the changes you have made.
                                        </p>
                                        <textarea rows="4" nz-input [(ngModel)]="newVersion.changeLog"></textarea>
                                        <p *ngIf="error2" style="color:red;">Please enter a description of the changes
                                            made.</p>

                                    </div>
                                </nz-modal>
                            </div>
                            <vg-player (onPlayerReady)="onPlayerReady($event)"
                                *ngIf="pageFileHash[page._id].iconType === 'video'" style="margin-top:20px;">
                                <!--
    <vg-overlay-play></vg-overlay-play>
    <vg-buffering></vg-buffering>
    -->

                                <vg-controls>
                                    <vg-play-pause></vg-play-pause>
                                    <vg-playback-button></vg-playback-button>

                                    <vg-time-display vgProperty="current" vgFormat="mm:ss"></vg-time-display>

                                    <vg-scrub-bar>
                                        <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                        <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                                    </vg-scrub-bar>

                                    <vg-time-display vgProperty="left" vgFormat="mm:ss"></vg-time-display>
                                    <vg-time-display vgProperty="total" vgFormat="mm:ss"></vg-time-display>

                                    <vg-track-selector></vg-track-selector>
                                    <vg-mute></vg-mute>
                                    <vg-volume></vg-volume>

                                    <vg-fullscreen></vg-fullscreen>
                                </vg-controls>

                                <video [vgMedia]="media" #media id="singleVideo" preload="auto" crossorigin>
                                    <source
                                        [src]="(fsHandleSafeUrl$Hash[pageFileHash[page._id].versions[0].fsHandle] | async)"
                                        type="video/mp4">
                                </video>
                            </vg-player>
                            <div *ngIf="pageFileHash[page._id].iconType !== 'video'"
                                style="text-align: center;height:90%;margin-top:30px;">
                                <div style="width:100%;height:900px;display:inline-block;">
                                    <iframe
                                        [src]="(fsHandleSafeUrl$Hash[pageFileHash[page._id].versions[0].fsHandle] | async)"
                                        allowfullscreen width="100%" height="100%">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="currentPageId === 'assessment'" class="page">
                    <h3 style="text-align: center;margin-bottom:30px;">Assessment</h3>
                    <div *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'">
                        <div style="display:block;margin-bottom:10px;">
                            <div style="display:inline-block;">
                                <nz-switch nzSize="small" [(ngModel)]="selectedTraining.useAssessment"
                                    (ngModelChange)="saveTraining(false)"></nz-switch>
                            </div>
                            <div *ngIf="!selectedTraining.useAssessment" style="display:inline-block;margin-left:20px;">
                                <label>Assessment page is disabled!</label>
                            </div>
                            <div *ngIf="selectedTraining.useAssessment" style="display:inline-block;margin-left:20px;">
                                <label>Assessment page is enabled</label>
                            </div>
                        </div>
                        <div *ngIf="selectedTraining.useAssessment">
                            <div>
                                <div style="margin-bottom: 30px;">
                                    <div style="width:20%;text-align: center;display:inline-block;">
                                        <label style="font-size:12px;color:#bbbbbb;">Passing
                                            Grade</label>
                                    </div>
                                    <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                        <nz-input-number nzSize="small" nzId="passingGrade" class="foo"
                                            style="font-size:12px;"
                                            [(ngModel)]="selectedTraining.assessment.passingGrade" [nzMin]="0"
                                            [nzMax]="100" [nzStep]="5">
                                        </nz-input-number>
                                        <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp;%</span>
                                    </div>
                                </div>

                            </div>
                            <div *ngFor="let item of assessment.items; index as itemIndex"
                                style="width:90%;border-bottom: 1px solid #bbbbbb;position:relative;margin-top:10px;">
                                <div style="position:absolute;top:5px; right:5px;">
                                    <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                                        nzTooltipTitle="Delete Question" nz-popconfirm
                                        nzPopconfirmTitle="Delete this Question?" [nzPopconfirmTrigger]="'click'"
                                        [nzPopconfirmPlacement]="'top'" (nzOnConfirm)="confirmDeleteQuestion(itemIndex)"
                                        style="display:inline-block;cursor:pointer;font-size:22px;vertical-align: baseline;">
                                    </i>

                                </div>
                                <div style="color:black;font-size:16px;font-weight:500;margin-right:20px;float:left;">
                                    Question
                                    {{ itemIndex + 1 }}
                                </div>

                                <div style="display: inline-block;width:80%;font-size:16px;">
                                    <input nz-input type="text" nzSize="small" placeholder="Question" ngDefaultControl
                                        [(ngModel)]="item.question" style="margin-bottom:10px;"
                                        (blur)="questionChanged()">

                                </div>
                                <div>
                                    <div style="font-size:16px;">Choices</div>
                                    <nz-radio-group [(ngModel)]="item.correctChoice" style="display:block;"
                                        (ngModelChange)="saveTraining(false)">
                                        <div *ngFor="let choice of item.choices; index as choiceIndex"
                                            style="width:100%;padding-left:50px;margin-bottom: 10px;">
                                            <label nz-radio [nzValue]="choiceIndex"
                                                style="display:inline-block;"></label>
                                            <span style="font-weight:500;">{{alpha[choiceIndex]}}&nbsp;&nbsp;</span>
                                            <input nz-input type="text" placeholder="Choice Text" ngDefaultControl
                                                (blur)="choiceContentChanged(choice, itemIndex, choiceIndex)"
                                                [(ngModel)]="choice" nzSize="small" style="width:90%;">
                                        </div>
                                    </nz-radio-group>
                                    <i class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon nzType="plus-square"
                                        theme="twotone" [nzTwotoneColor]="'#52c41a'" (click)="addNewChoice(itemIndex)"
                                        style="display:block;text-align:left;padding-left:50px;margin-bottom:10px;cursor: pointer;"
                                        nz-tooltip nzTooltipTitle="Add new Choice"></i>
                                </div>
                            </div>
                            <i *ngIf="mode === 'Edit' && selectedTraining.status === 'Under Development'"
                                class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon nzType="plus-square"
                                theme="twotone" [nzTwotoneColor]="'#52c41a'" (click)="addNewQuestion()"
                                style="margin-top:10px;cursor: pointer;" nz-tooltip
                                nzTooltipTitle="Add new Question"></i>
                        </div>
                    </div>
                    <div *ngIf="mode === 'Preview' || selectedTraining.status === 'In Review' || selectedTraining.status === 'In Production'"
                        style="position:relative;">
                        <div *ngIf="currentAssessmentItemIndex === -1 && !assessmentComplete">
                            <button nz-button nzType="primary" (click)="beginAssessment()">Begin Assessment</button>
                        </div>
                        <div *ngIf="assessmentComplete && selectedTraining.status === 'Under Development'">
                            <button nz-button nzType="primary" (click)="resetAssessment()">Reset Assessment</button>
                        </div>
                        <div *ngIf="currentAssessmentItemIndex > -1" style="margin-bottom:20px;">
                            <div>
                                <div style="display: inline-block;">
                                    <i nz-icon nzType="check-circle" theme="twotone" [nzTwotoneColor]="'#52c41a'"
                                        style="font-size: 24px;vertical-align: baseline;"></i>
                                    <span style="font-size:20px;margin-right:30px;">
                                        &nbsp;{{ assessmentCorrectCnt }}</span>
                                </div>
                                <div style="display: inline-block;">
                                    <i nz-icon nzType="close-circle" theme="twotone" [nzTwotoneColor]="'red'"
                                        style="font-size: 24px;vertical-align: baseline;display:inline-block;"></i>
                                    <span style="font-size:20px;margin-right:30px;">
                                        &nbsp;{{ assessmentIncorrectCnt }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div *ngIf="assessmentComplete && passedAssessment" style="margin:20px 0;">
                                <h3>Congratulations, you passed!</h3>
                            </div>
                            <div *ngIf="assessmentComplete && !passedAssessment" style="margin:20px 0;">
                                <h3 style="display:block;">Sorry, you did not pass!</h3>

                                <button nz-button nzType="primary" (click)="retake()"
                                    style="display:block;margin-top:20px;">Retake</button>

                            </div>
                        </div>
                        <div *ngIf="!assessmentComplete">
                            <div *ngFor="let item of assessment.items; index as itemIndex"
                                [@questionSlide]="slideNewQuestionHash[itemIndex] ? 'in' : 'out'"
                                style="position:absolute;top:40px;left:600px;width:80%;height:  200px;"
                                [ngStyle]="{'z-index': 10000 - itemIndex}">
                                <div style="width:90%;position:relative;padding:10px">
                                    <div
                                        style="color:black;font-size:16px;font-weight:500;margin-right:20px;float:left;">
                                        Question
                                        {{ itemIndex + 1 }}
                                    </div>
                                    <div style="display: inline-block;font-size:16px;">
                                        <div style="color:black;font-weight: 200;">
                                            {{item.question}}
                                        </div>
                                    </div>
                                    <div style="padding:10px 0 0 0;">
                                        <nz-radio-group [(ngModel)]="assessmentResponseHash[itemIndex]"
                                            [nzDisabled]="showNext" style="display:block;"
                                            (ngModelChange)="answeredQuestion(itemIndex)">
                                            <div *ngFor="let choice of item.choices; index as choiceIndex"
                                                style="width:100%;padding-left:50px;position:relative;margin:10px 0;"
                                                [ngClass]="">
                                                <i *ngIf="(assessmentResponseHash[itemIndex] !== null || assessmentResponseHash[itemIndex] !== undefined) && assessmentResponseHash[itemIndex] === choiceIndex && assessmentResponseHash[itemIndex] !== item.correctChoice"
                                                    nz-icon nzType="close-circle" theme="twotone"
                                                    [nzTwotoneColor]="'red'"
                                                    style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                <i *ngIf="(assessmentResponseHash[itemIndex] !== null || assessmentResponseHash[itemIndex] !== undefined) && assessmentResponseHash[itemIndex] === choiceIndex && assessmentResponseHash[itemIndex] === item.correctChoice"
                                                    nz-icon nzType="check-circle" theme="twotone"
                                                    [nzTwotoneColor]="'#52c41a'"
                                                    style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                <i *ngIf="showNext && item.correctChoice === choiceIndex" nz-icon
                                                    nzType="check-circle" theme="twotone" [nzTwotoneColor]="'#52c41a'"
                                                    style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                <label nz-radio [nzValue]="choiceIndex"
                                                    style="display:inline-block;"></label>
                                                <span
                                                    style="font-weight:500;">{{alpha[choiceIndex]}}&nbsp;)&nbsp;&nbsp;</span>
                                                <span style="font-size:14px;">{{choice}}</span>
                                            </div>
                                        </nz-radio-group>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="showNext" style="position:absolute;top:330px;left:0;">
                            <button nz-button nzType="primary" (click)="nextQuestion()">Next Question</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>