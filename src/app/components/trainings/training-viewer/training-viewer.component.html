<ng-template #messageTemplate let-message>
    <div style="background-color: black;">
    </div>
</ng-template>
<div *ngIf="selectedTraining$ | async as selectedTraining" class="training-viewer-fullscreen">
    <div style="position:relative;width:100%;padding-top:5px;background-color: #fcfcfc;">
        <div style="position:absolute;left:5px;top:5px;margin-right:20px;display:inline-block;">
            <i *ngIf="selectedTraining.status === 'unlocked'" nz-icon nzType="unlock" [nzTheme]="'twotone'"
                [nzTwotoneColor]="'#52c41a'" (click)="lockTraining(selectedTraining)"
                style="cursor:pointer;font-size:20px;vertical-align: baseline;" nz-tooltip
                nzTooltipTitle="This training is unlocked"></i>
            <i *ngIf="selectedTraining.status === 'locked'" nz-icon nzType="lock" [nzTheme]="'twotone'"
                [nzTwotoneColor]="'red'" (click)="unlockTraining(selectedTraining)"
                style="cursor:pointer;font-size:20px;vertical-align: baseline;" nz-tooltip
                nzTooltipTitle="This training is unlocked">
            </i>
        </div>
        <div>
            <div
                style="display:inline-block;text-align: center;background-color:#fcfcfc;width:100%;text-align: center;">
                <i class="fad fa-hat-wizard"
                    style="color:#951eca;font-size:20px;margin-right:10px;vertical-align: baseline;display:inline-block;"></i>
                <span style="display:inline-block;font-size:16px;">Training Wizard</span>
            </div>
        </div>
        <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" (click)="closeViewer()"
            style="display:inline-block;cursor:pointer;font-size:20px;vertical-align: baseline;position:absolute;right:5px;top:5px;"
            nz-tooltip nzTooltipTitle="Close Training">
        </i>
    </div>
    <div class="training-header" [ngClass]="{'activeStep': currentStep === 0}" style="position:relative;">
        <div style="display:block;width:100%;">
            <div class="header-left">
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                    [ngClass]="selectedTraining.iconClass" nz-tooltip nzTooltipTitle="click to change icon"
                    style="display: inline-block;font-size:40px;cursor: pointer;margin:10px;vertical-align: middle;"
                    [ngStyle]="{'color': selectedTraining.iconColor}" (click)="showIconSelectModal()">
                </i>
                <i *ngIf="production === 'true' || selectedTraining.status === 'locked' || mode === 'Preview'"
                    [ngClass]="selectedTraining.iconClass"
                    style="display: inlne-block;font-size:40px;margin:10px;vertical-align: middle;"
                    [ngStyle]="{'color': selectedTraining.iconColor}">
                </i>
            </div>
            <div class="header-right">
                <div *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'">
                    <div style="margin-right:30px;display: inline-block;">
                        <input style="display:inline-block;color:black;width:350px;font-size:14px;" nz-input
                            [(ngModel)]="selectedTraining.title" nzSize="small" (keydown.enter)="saveTraining(true)"
                            (blur)="saveTraining(true)" />
                        <div *ngIf="authenticatedUser.userType === 'supervisor'"
                            style="display:inline-block;margin-left:40px;">
                            <span style="color:#bbbbbb;"> Assigned Users</span>
                            <span style="display:inline-block;margin-right:10px;"></span>
                            <div *ngFor="let uid of users$ | async; index as i"
                                style="display:inline-block;width:fit-content;text-align: center;margin:0 4px;vertical-align: middle;">
                                <div *ngIf="myTeamHash[uid]">
                                    <i [ngClass]="userTypeIconHash[myTeamHash[uid].userType]"
                                        [ngStyle]="{'color': trainingStatusColorHash[myTeamHash[uid].trainingStatus]}"
                                        style="display:inline;font-size:22px;"></i>
                                    <span style="display:block;font-size:10px;">{{myTeamHash[uid].firstName}}</span>
                                </div>
                            </div>
                            <i nz-icon nzType="user-add" theme="outline" nz-tooltip nzTooltipTitle="Assign To User"
                                class="header-icon" (click)="showAssignmentDialog()"
                                style="font-size:20px;color:#5972eb;">
                            </i>

                        </div>
                    </div>
                </div>
                <div *ngIf="production === 'true' || selectedTraining.status === 'locked' || mode === 'Preview'">
                    <span
                        style="font-size:26px;display:inline-block;vertical-align: middle;">&nbsp;{{selectedTraining.title}}</span>

                </div>
            </div>
            <nz-modal [(nzVisible)]="messageDialogVisible" nzTitle="Email Interest List"
                (nzOnCancel)="handleEmailInterestListCancel()" (nzOnOk)="emailInterestList()">
                <div style="display:block;padding-top:5px;"
                    *ngFor="let email of selectedTraining.interestList; index as i">
                    {{ email }}
                    <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-popconfirm
                        nzPopconfirmTitle="Delete this email address?" [nzPopconfirmTrigger]="'click'"
                        [nzPopconfirmPlacement]="'right'" (nzOnConfirm)="deleteInterestListItem(i)"
                        style="font-size:14px;vertical-align: baseline; margin-left:10px;"></i>
                </div>
                <div style="z-index: 1000;background-color: white;">
                    <label style="margin-bottom: 3px;font-size:12px;color:#aaaaaa;">Subject</label>
                    <input nz-input type="text" placeholder="Subject" ngDefaultControl [(ngModel)]="subject"
                        style="margin-bottom:10px;">
                    <label style="margin-bottom: 3px;font-size:12px;color:#aaaaaa;">Message</label>
                    <textarea rows="4" nz-input [(ngModel)]="messageBody"></textarea>
                </div>
            </nz-modal>

            <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon" nzWidth="800"
                (nzOnCancel)="handleIconSelectCancel()" [nzOkDisabled]="okDisabled" [nzCancelDisabled]="cancelDisabled"
                (nzOnOk)="handleIconSelectConfirm()" style="width:800px;">
                <app-icon-picker (icon)="setIcon($event)"></app-icon-picker>
            </nz-modal>
        </div>
        <div style="display:block;width:100%;height:30px;margin-top:10px;">
                <div *ngIf="selectedTraining.status === 'unlocked'" style="font-size:12px;width:fit-content;display:inline-block;margin-right:30px;">
                    Version : {{selectedTraining.versionPending}}
                </div>
                <div *ngIf="selectedTraining.status === 'locked'" style="font-size:12px;width:fit-content;display:inline-block;margin-right:30px;">
                    Version : {{selectedTraining.versions[0]}}
                </div>

            <div *ngIf="production === 'false' && selectedTraining.status === 'unlocked'"
                style="width:fit-content;display:inline-block;">
                <span style="display:inline-block;font-size:12px;">Mode&nbsp;&nbsp;:&nbsp;&nbsp;</span>
                <a nz-dropdown [nzDropdownMenu]="menu" nzTrigger="click"
                    style="display:inline-block;font-size:12px;color: #3958e3;margin-right:20px;">{{ mode }}
                    <i nz-icon nzType="down" style="font-size:12px;vertical-align: middle;"></i>
                </a>
                <nz-dropdown-menu #menu="nzDropdownMenu" style="z-index:100010;">
                    <ul nz-menu nzSelectable>

                        <li style="font-size:12px;color: #3958e3;" nz-menu-item (click)="setMode('Edit')"
                            [ngClass]="{'selected-status': mode === 'Edit'}">Edit</li>
                        <li style="font-size:12px;color: #3958e3;" nz-menu-item (click)="setMode('Preview')"
                            [ngClass]="{'selected-status': mode === 'Preview'}">Preview</li>
                    </ul>
                </nz-dropdown-menu>
            </div>
            <div style="display:inline-block;float:right;">
                <i *ngIf="production === 'false' && selectedTraining.status === 'locked'" nz-icon nzType="edit"
                    theme="twotone" nz-tooltip nzTooltipTitle="Edit Training" class="header-icon"
                    [ngClass]="{'disabled': selectedTraining.status === 'unlocked'}" (click)="unlockTraining()">
                </i>
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'" nz-icon
                    nzType="copy" theme="twotone" [nzTwotoneColor]="'orange'" nz-tooltip
                    [ngClass]="{'disabled': selectedTraining.status === 'locked' || !(trainingIsValid$ | async) }"
                    nzTooltipTitle="Save As New Version" class="header-icon" (click)="createNewVersion()">
                </i>
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'" nz-icon
                    nzType="rollback" theme="outline" nz-tooltip nzTooltipTitle="Discard Changes"
                    [ngClass]="{'disabled': selectedTraining.status === 'locked' || !rollback}" style="color:blue;"
                    class="header-icon" (click)="Rollback()">
                </i>
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'" nz-icon
                    nzType="reload" theme="outline" nz-tooltip nzTooltipTitle="Reload" class="header-icon"
                    (click)="reload()" style="color:purple;">
                </i>
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'" nz-icon
                    nzType="mail" theme="twotone" [nzTwotoneColor]="'gold'" nz-tooltip
                    nzTooltipTitle="Email Interest List" class="header-icon" (click)="postMessageDialog()">
                </i>
                <i *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'" nz-icon
                    nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                    nzTooltipTitle="Delete Training" class="header-icon" (click)="showConfirmDelete()">
                </i>
            </div>
            <nz-modal [(nzVisible)]="showAssignToUserDialog" nzTitle="Assign to User" [nzOkDisabled]="assignToDisabled"
                (nzOnCancel)="cancelAssignToUser()" (nzOnOk)="confirmAssignmentToUser()" nzOkText="Assign to User">
                <div *ngIf="assignableUsers.length > 0" style="display:block;font-weight: 300;">
                    Select the user you would like to assign this training to.
                </div>
                <div *ngIf="assignableUsers.length === 0 && teamMembers.length > 0"
                    style="display:block;font-weight: 300;">
                    This training has already been assigned to all members of your team!
                </div>
                <div *ngIf="teamMembers.length === 0" style="display:block;font-weight: 300;">
                    You have not added any team members yet!
                </div>
                <div *ngFor="let userId of assignableUsers" style="display:block;font-weight: 500;">
                    <div (click)="selectTeamMemberToAssign(userId)"
                        style="display:block;padding:10px 20px;font-weight: 500;"
                        [ngClass]="{'selected-user-to-assign': userId === currentSelectedUserToAssign}"
                        class="user-to-assign">
                        {{myTeamHash[userId].firstName}} {{myTeamHash[userId].lastName}}
                    </div>
                </div>
            </nz-modal>

            <nz-modal [(nzVisible)]="showConfirmDeleteTrainingWithAffectedUsers" nzTitle="Delete Training Confirmation"
                (nzOnCancel)="cancelDelete()" (nzOnOk)="confirmDelete()" nzOkText="Delete Training">
                <div style="display:block;font-weight: 300;">
                    This training will be removed from the assigned trainings of the following users:
                </div>
                <div style="display:block;padding:20px;font-weight: 500;">
                    <div *ngFor="let user of usersAffected; index as i">
                        {{user.firstName}} {{user.lastName}}
                    </div>
                </div>
            </nz-modal>
            <nz-modal [(nzVisible)]="showConfirmDeleteTrainingWithoutAffectedUsers"
                nzTitle="Delete Training Confirmation" (nzOnCancel)="cancelDelete()" (nzOnOk)="confirmDelete()"
                nzOkText="Delete Training">
                <div style="display:block;font-weight: 300;">
                    Are you sure you want to delete this Training?
                </div>
            </nz-modal>
        </div>
    </div>
    <div style="width:100%;overflow: scroll;"
        [ngClass]="{'main-content-container-fullscreen': fullscreen, 'main-content-container': !fullscreen}">
        <div class="main-content">
            <div *ngIf="!isOpen" class="toc-opener">
                <i nz-icon nzType="menu-unfold" [nzTheme]="'outline'" (click)="toggleTOC(true)"
                    style="cursor:pointer;font-size:24px;vertical-align: middle;"></i>

            </div>
            <div [@tocToggle]="isOpen ? 'open' : 'closed'" class="toc" [ngClass]="{'activeStep': currentStep === 1}">
                <div style="position: relative;text-align: left;">
                    <div class="toc-title">
                        Table of Contents
                        <i nz-icon nzType="menu-fold" [nzTheme]="'outline'" (click)="toggleTOC(false)"
                            style="float:right;cursor:pointer;font-size:24px;vertical-align: baseline;margin-left:10px;"></i>
                    </div>
                    <div *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                        class="toc-entry" (click)="setCurrentPage('trainingWizardTour')"
                        [ngClass]="{'active-toc':currentPageId === 'trainingWizardTour', 'disabled': assessmentInProgress}">
                        <i *ngIf="selectedTraining.versions.length === 0 && !selectedTraining.isValid['trainingWizardTour']" nz-icon nzType="minus"
                            [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:red;"></i>
                        <i *ngIf="selectedTraining.versions.length === 0 && selectedTraining.isValid['trainingWizardTour']" nz-icon nzType="check"
                            [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:#52c41a;"></i>
                        Training Wizard Tour
                    </div>
                    <div *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                        class="toc-entry" (click)="setCurrentPage('config')"
                        [ngClass]="{'active-toc':currentPageId === 'config', 'disabled': assessmentInProgress}">

                        <i *ngIf="selectedTraining.versions.length === 0 && !selectedTraining.isValid['config']" nz-icon nzType="minus" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:red;"></i>
                        <i *ngIf="selectedTraining.versions.length === 0 && selectedTraining.isValid['config']" nz-icon nzType="check" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:#52c41a;"></i>
                        Training Configuration
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('intro')"
                        [ngClass]="{'active-toc':currentPageId === 'intro', 'disabled': assessmentInProgress}">
                        <i *ngIf="selectedTraining.versions.length === 0 && !selectedTraining.isValid['intro'] && production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                            nz-icon nzType="minus" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:red;"></i>
                        <i *ngIf="selectedTraining.versions.length === 0 && selectedTraining.isValid['intro'] && production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                            nz-icon nzType="check" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:#52c41a;"></i>
                        {{selectedTraining.introductionLabel}}
                    </div>
                    <div *ngIf="production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                        class="toc-entry" style="cursor: default;"
                        [ngClass]="{'active-toc':currentPageId === 'mainContent', 'disabled': assessmentInProgress}"
                        (click)="setCurrentPage('mainContent')">
                        <i *ngIf="selectedTraining.versions.length === 0 && !selectedTraining.isValid['mainContent']" nz-icon nzType="minus" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:red;"></i>
                        <i *ngIf="selectedTraining.versions.length === 0 && selectedTraining.isValid['mainContent']" nz-icon nzType="check" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:#52c41a;"></i>
                        Main Content
                    </div>
                    <div *ngIf="production === 'true' || selectedTraining.status === 'locked' || mode === 'Preview'"
                        class="toc-entry" style="cursor: default;" [ngClass]="{'disabled': assessmentInProgress}">
                        Main Content
                    </div>
                    <div class="toc-main-content-entry" *ngFor="let page of selectedTraining.pages; index as pageIndex"
                        (click)="setCurrentPage(page._id)"
                        [ngClass]="{'active-toc':currentPageId === page._id, 'disabled': assessmentInProgress}">
                        <div style="display:inline-block;line-height:18px;">
                            {{page.title}}
                        </div>
                    </div>
                    <div *ngIf="selectedTraining.useAssessment || selectedTraining.status === 'unlocked' && production === 'false' && mode === 'Edit'"
                        class="toc-entry" (click)="setCurrentPage('assessment')"
                        [ngClass]="{'active-toc':currentPageId === 'assessment', 'disabled': currentUser}">
                        <i *ngIf="selectedTraining.versions.length === 0 && !selectedTraining.isValid['assessment'] && production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                            nz-icon nzType="minus" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:red;"></i>
                        <i *ngIf="selectedTraining.versions.length === 0 && selectedTraining.isValid['assessment'] && production === 'false' && selectedTraining.status === 'unlocked' && mode === 'Edit'"
                            nz-icon nzType="check" [nzTheme]="'outline'"
                            style="vertical-align: middle;font-size:14px;margin-right:0;color:#52c41a;"></i>
                        Assessment
                    </div>
                    <!--
                    <div *ngIf="selectedTraining.status === 'locked' || production === 'true'" class="toc-entry"
                        (click)="setCurrentPage('comments')" [ngClass]="{'active-toc':currentPageId === 'comments'}">
                        Comments
                    </div>
                    -->
                </div>
            </div>
            <div class="page-container" [ngStyle]="{'margin-left.px': pageContainerMarginLeft}"
                [ngClass]="{'activeStep': currentStep === 2}">
                <div *ngIf="currentPageId === 'config' && mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                    class="page">
                    <h3 style="display:inline-block;text-align: center;margin-bottom:30px;width:100%;">Training
                        Configuration</h3>
                    <div>
                        <div>
                            <span style="color:red;font-size:30px;">*</span> &nbsp;&nbsp; Required
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;display: inline-block;font-size:12px;color:#bbbbbb;">
                                    <span style="color:red;font-size:30px;">*</span>Estimated Time To Complete
                                </label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <nz-input-number nzSize="small" nzId="estTimeToComplete" class="foo"
                                    style="font-size:12px;" [(ngModel)]="selectedTraining.estimatedTimeToComplete"
                                    [nzMin]="10" [nzMax]="240" [nzStep]="5" (ngModelChange)="configChanged($event)">
                                </nz-input-number>
                                <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp; minutes</span>
                            </div>
                        </div>

                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Job Title</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">

                                <input
                                    style="display:inline-block;color:black;margin-bottom:0;font-size:14px;width:50%;"
                                    nz-input [(ngModel)]="selectedTraining.jobTitle" nzSize="small"
                                    (ngModelChange)="saveTraining(false)" />
                            </div>
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;display:inline-block;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Share With Other
                                    Teams</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">

                                <label nz-checkbox [(ngModel)]="selectedTraining.shared"
                                    (click)="saveTraining()"></label>
                            </div>
                        </div>
                        <div class="config-page-row">
                            <div style="width:25%;text-align: right;float:left;padding-right:10px;">
                                <label style="margin-bottom: 0;font-size:12px;color:#bbbbbb;">Interest List</label>
                            </div>
                            <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                <div>
                                    <div style="width:35%;text-align: left;display:inline-block;">
                                        <input nz-input nzSize="small" class="foo" style="font-size:12px;"
                                            [(ngModel)]="emailAddr" placeholder="Email Address"
                                            (keydown.enter)="addEmailToInterestList()" />
                                    </div>
                                    <i class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon nzType="plus-square"
                                        theme="twotone" [nzTwotoneColor]="'#52c41a'" (click)="addEmailToInterestList()"
                                        style="display:inline-block;cursor: pointer;margin-left:10px;" nz-tooltip
                                        nzTooltipTitle="Add Email to List"></i>
                                </div>

                                <div style="display:block;padding-top:5px;"
                                    *ngFor="let email of selectedTraining.interestList; index as i">
                                    {{ email }}
                                    <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                        nz-popconfirm nzPopconfirmTitle="Delete this email address?"
                                        [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'right'"
                                        (nzOnConfirm)="deleteInterestListItem(i)"
                                        style="font-size:14px;vertical-align: baseline; margin-left:10px;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="currentPageId === 'trainingWizardTour' && mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                    class="page" [ngClass]="{'activeStep': currentStep === 2}">
                    <h3 style="display:inline-block;text-align: center;margin-bottom:30px;width:100%;">Training Wizard
                        Tour </h3>

                    <div>
                        <div style="padding-bottom:20px;">
                            <p>
                                This page introduces you to the 3 components of the Training Wizard.<br>
                                Select step 1 to begin the tour.
                            </p>
                        </div>
                        <nz-steps (nzIndexChange)="setCurrentStepPanel($event)" [nzCurrent]="currentStep">
                            <nz-step nzTitle="Training Header"></nz-step>
                            <nz-step nzTitle="Table of Contents"></nz-step>
                            <nz-step nzTitle="Main Content"></nz-step>
                        </nz-steps>
                        <div *ngIf="currentStep === 0" style="padding-top:40px;">
                            <div style="padding:0 30px;margin-bottom:20px;">
                                This component gives you access to the following features and functions:
                            </div>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:14px;font-weight:300;color:#999999;">
                                    <i [ngClass]="selectedTraining.iconClass"
                                        [ngStyle]="{'color': selectedTraining.iconColor}"
                                        style="font-size:18px;color:black;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    This is the icon that will be used to identify your training. Clicking the icon
                                    brings up the customization dialog.
                                </div>
                            </div>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:14px;font-weight:300;color:#999999;">
                                    <input nz-input nzSize="small" style="font-size:12px;width:80%;" [(ngModel)]="foo"
                                        placeholder="Training Title" />
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    This is where you enter the Title of the training.
                                </div>
                            </div>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                    <i nz-icon nzType="user-add" [nzTheme]="'outline'"
                                        style="font-size:18px;vertical-align: top;color:#5972eb;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    Selecting this icon brings up the assignment dialog where you can select users to be
                                    assigned to this training.
                                </div>
                            </div>
                            <nz-divider></nz-divider>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:14px;font-weight:400">
                                    Mode
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    This dropdown menu allows you to toggle between <span
                                        style="color:blue;">Edit</span> and <span style="color:blue;">Preview</span>
                                    mode. <span style="color:blue;">Preview</span>
                                    mode removes all of the editing and configuration features to simulate the
                                    training in a production environment.
                                </div>
                            </div>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                    <i nz-icon nzType="mail" [nzTheme]="'twotone'" [nzTwotoneColor]="'gold'"
                                        style="font-size:18px;vertical-align: top;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    This icon brings up a dialog that allows you to send a message to the email
                                    addresses
                                    on the interest list for this training.
                                </div>
                            </div>
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                    <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                        style="font-size:18px;vertical-align: top;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    Clicking this icon deletes the training (with confirmation).
                                </div>
                            </div>
                            <nz-divider></nz-divider>
                            <!--
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                    <i nz-icon nzType="fullscreen" [nzTheme]="'outline'"
                                        style="font-size:18px;vertical-align: top;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    Clicking on this icon switches to fullscreen mode.
                                </div>
                            </div>
                            -->
                            <div style="display:block;margin-top:20px;">
                                <div
                                    style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                    <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                        style="font-size:18px;vertical-align: top;"></i>
                                </div>
                                <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                    Clicking on this icon closes the training.
                                </div>
                            </div>
                        </div>
                        <div *ngIf="currentStep === 1" style="padding-top:40px;">
                            <div style="padding:0 30px;margin-bottom:20px;">
                                This component provides page navigation.
                                <br><br>
                                The following two pages are only available when the <b>Mode</b> is
                                <span style="color:blue;">Edit</span>.
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="car" [nzTheme]="'twotone'" [nzTwotoneColor]="'#d64594'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This loads the page you are currently viewing.
                                    </div>
                                </div>
                                <div style="display:block;margin-top:20px;">
                                    <div
                                        style="width:20%;text-align: center;float:left;padding-right:10px;font-size:18px;font-weight:400">
                                        <i nz-icon nzType="setting" [nzTheme]="'twotone'" [nzTwotoneColor]="'orange'"
                                            style="font-size:18px;vertical-align: top;"></i>
                                    </div>
                                    <div style="width:80%;text-align:left;display:inline-block;padding-left:10px;">
                                        This loads the Training Configuration page.
                                    </div>
                                </div>
                                <br><br>
                                <span style="font-weight:600;">Training Introduction</span> - This page needs no
                                explanation.
                                <br><br>
                                <span style="font-weight:600;">Main Content</span> - This page is the home of the
                                Content Wizard.
                                The Content Wizard helps you quickly add your content to the training.
                                <br><br>
                                <span style="font-weight:600;">Assessment</span> - This is where you create the exam
                                to verify mastery of the training content.
                                Validation of the test is done in <span style="color:blue;">Preview</span> mode.
                            </div>
                        </div>
                        <div *ngIf="currentStep === 2" style="padding-top:40px;">
                            <div style="padding:0 30px;margin-bottom:20px;">
                                This is the content viewing component. &nbsp;&nbsp; Selecting entries in the Table
                                of Contents
                                loads the selected page here.
                            </div>
                        </div>
                    </div>
                    <div style="width:100%;float:left;margin-top:40px;">
                        <button *ngIf="runningTour" nz-button nzType="primary" nzSize="small" (click)="endTour()">
                            End Tour
                        </button>
                    </div>
                </div>

                <div *ngIf="currentPageId === 'comments'" class="page">
                    <h3 style="display:inline-block;text-align: left;margin-bottom:30px;">Comments</h3>
                    <div style="padding:20px;background-color:white;">
                        <nz-list *ngIf="data.length" [nzDataSource]="data" [nzRenderItem]="item"
                            [nzItemLayout]="'horizontal'">
                            <ng-template #item let-item>
                                <nz-comment [nzAuthor]="item.author" [nzDatetime]="item.displayTime">
                                    <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="item.avatar"></nz-avatar>
                                    <nz-comment-content>
                                        <p>{{ item.content }}</p>
                                    </nz-comment-content>
                                </nz-comment>
                            </ng-template>
                        </nz-list>
                        <nz-comment>
                            <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="user.avatar"></nz-avatar>
                            <nz-comment-content>
                                <nz-form-item>
                                    <textarea [(ngModel)]="inputValue" nz-input rows="4"></textarea>
                                </nz-form-item>
                                <nz-form-item>
                                    <button nz-button nzType="primary" [nzLoading]="submitting" nzSize="small"
                                        [disabled]="!inputValue" (click)="handleSubmit()">
                                        Add Comment
                                    </button>
                                </nz-form-item>
                            </nz-comment-content>
                        </nz-comment>

                    </div>
                </div>
                <div *ngIf="currentPageId === 'mainContent' && selectedTraining.status === 'unlocked' && production === 'false'"
                    class="page">
                    <h3 style="text-align: center;margin-bottom:20px;">Main Content</h3>
                    <div>
                        <div>
                            <div style="text-align: left;font-size:12px;">
                                <div style="margin-top: 10px;">
                                    <nz-alert nzType="info" [nzMessage]="mainContentTitleTemplate"
                                        [nzDescription]="mainContentDescriptionTemplate" nzShowIcon nzCloseable="true"
                                        style="margin-bottom:20px;" [nzCloseText]="mainContentCloseTemplate">
                                    </nz-alert>
                                    <ng-template #mainContentCloseTemplate>
                                        <i nz-icon nzType="close-circle" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                            style="font-size: 24px;"></i>
                                    </ng-template>
                                    <ng-template #mainContentTitleTemplate>
                                        <div style="width:100%;padding:0 20px 20px 0;">
                                            Welcome to the Content Wizard. This is where you setup the content
                                            for this
                                            training.
                                        </div>
                                    </ng-template>
                                    <ng-template #mainContentDescriptionTemplate>
                                        <p>
                                            Files may be uploaded from your Google Drive, DropBox or your local
                                            file
                                            system.
                                        </p>
                                    </ng-template>
                                    <div style=" margin:40px 0;position:relative;">
                                        Select the content type you would like to upload

                                        <i [@itemFocus]="itemWithFocus === 'doc' ? 'in' : 'out'" nz-icon nzType="file"
                                            (mouseenter)="itemWithFocus = 'doc'" (mouseleave)="itemWithFocus = ''"
                                            [nzTheme]="'twotone'" (click)="openPicker('doc')"
                                            style="cursor:pointer;position:absolute;bottom:-30px;left:0;" nz-tooltip
                                            nzTooltipTitle="Upload a Document"></i>
                                        <i [@itemFocus]="itemWithFocus === 'video' ? 'in' : 'out'" nz-icon
                                            (click)="openPicker('video')" nzType="video-camera" [nzTheme]="'twotone'"
                                            (mouseenter)="itemWithFocus = 'video'" (mouseleave)="itemWithFocus = ''"
                                            style="cursor:pointer;position:absolute;bottom:-30px;left:60px;" nz-tooltip
                                            nzTooltipTitle="Upload a Video"></i>
                                        <i [@itemFocus]="itemWithFocus === 'audio' ? 'in' : 'out'" nz-icon
                                            nzType="audio" [nzTheme]="'twotone'" (click)="openPicker('audio')"
                                            (mouseenter)="itemWithFocus = 'audio'" (mouseleave)="itemWithFocus = ''"
                                            style="cursor:pointer;position:absolute;bottom:-30px;left:120px;" nz-tooltip
                                            nzTooltipTitle="Upload an Audio File"></i>
                                        <i [@itemFocus]="itemWithFocus === 'image' ? 'in' : 'out'" nz-icon
                                            nzType="file-image" [nzTheme]="'twotone'" (click)="openPicker('image')"
                                            (mouseenter)="itemWithFocus = 'image'" (mouseleave)="itemWithFocus = ''"
                                            style="cursor:pointer;position:absolute;bottom:-30px;left:180px;" nz-tooltip
                                            nzTooltipTitle="Upload an Image File"></i>
                                    </div>

                                </div>
                                <div style="margin-top:60px;height:60px;position:relative;">
                                    <div style="">
                                        Use an existing web page
                                    </div>
                                    <nz-alert *ngIf="badUrl" nzType="error" nzCloseable="true"
                                        nzMessage="URL format error.  URL's must use HTTPS!" nzShowIcon
                                        style="margin:10px 0;"></nz-alert>
                                    <br>
                                    <input
                                        style="margin-left:20px;  display:inline-block;color:black;font-size:14px;width:50%;"
                                        nz-input [(ngModel)]="pageUrl" nzSize="small" (keydown.enter)="pageUrlChanged()"
                                        (blur)="pageUrlChanged()"
                                        placeholder="Enter a website URL   https://example.com" />

                                </div>
                                <!--
                                <div style="margin-top:60px;height:60px;position:relative;">
                                    <div style="">
                                        Use embeddable HTML
                                    </div>
                                    <input style="margin-left:20px;  display:inline-block;color:black;font-size:14px;width:50%;" nz-input
                                        [(ngModel)]="pageHtml" nzSize="small" (keydown.enter)="pageHtmlChanged()" (blur)="pageHtmlChanged()"
                                        placeholder="Enter embeddable HTML <iframe width='560' height='315' src='https://www.youtube.com/embed..." />
                                
                                </div>
                                -->
                                <!--
                                <li style="height:60px;position:relative;">
                                    Create your own custom HTML page
                                    <br>
                                    <i [@itemFocus]="itemWithFocus === 'html' ? 'in' : 'out'" nz-icon nzType="code"
                                        [nzTheme]="'twotone'" (click)="showHTMLEditor = !showHTMLEditor"
                                        (mouseenter)="itemWithFocus = 'html'" (mouseleave)="itemWithFocus = ''"
                                        style="cursor:pointer;position:absolute;bottom:10px;left:20px;"
                                        nz-tooltip nzTooltipTitle="Open HTML Editor"></i>
                                </li>
                                -->
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="currentPageId === 'intro'" class="page">
                    <h3 style="text-align: center;margin-bottom:20px;">{{selectedTraining.introductionLabel}}</h3>

                    <div>
                        <span
                            *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                            style="color:#bbbbbb;">Introduction</span>
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-paragraph (nzContentChange)="contentChanged($event, 'introduction')" nzEditable
                                [(nzContent)]="selectedTraining.introduction"></p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                                {{selectedTraining.introduction}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:30px;">
                        <span
                            *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                            style="color:#bbbbbb;">Executive Summary Heading</span>
                        <h4>
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-paragraph (nzContentChange)="contentChanged($event, 'execSummaryLabel')" nzEditable
                                [(nzContent)]="selectedTraining.execSummaryLabel">
                            </p>
                        </h4>
                        <span
                            *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                            <h4>{{selectedTraining.execSummaryLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding:0 30px;">
                        <span
                            *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                            style="color:#bbbbbb;">Executive Summary</span>
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-paragraph (nzContentChange)="contentChanged($event, 'execSummary')" nzEditable
                                [(nzContent)]="selectedTraining.execSummary"></p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                                {{selectedTraining.execSummary}}
                            </span>
                        </span>
                    </div>
                    <!--
                    <div style="margin-top:30px;">
                        <span
                            *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                            style="color:#bbbbbb;">Goals Heading</span>
                        <h4>
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-paragraph (nzContentChange)="contentChanged($event, 'goalsLabel')" nzEditable
                                [(nzContent)]="selectedTraining.goalsLabel">
                            </p>
                        </h4>
                        <span
                            *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                            <h4>{{selectedTraining.goalsLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding:0 30px;">
                        <span
                            *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                            style="color:#bbbbbb;">Goals</span>
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-paragraph (nzContentChange)="contentChanged($event, 'goals')" nzEditable
                                [(nzContent)]="selectedTraining.goals">
                            </p>
                            <span
                                *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                                {{selectedTraining.goals}}
                            </span>
                        </span>
                    </div>
                    -->
                </div>
                <div>
                    <div *ngFor="let page of selectedTraining.pages; index as pageIndex">
                        <!-- page actions -->
                        <div *ngIf="currentPageId === page._id"
                            [ngClass]="{'page': page.type === 'file', 'page-url': page.type === 'url'}">
                            <div style="position:absolute;top:20px;right:20px;width:fit-content;height:fit-content;">
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                    nz-icon nzType="up-square" [ngClass]="{'disabled': pageIndex === 0}"
                                    [nzTheme]="'twotone'" nz-tooltip nzTooltipTitle="Move document up in list"
                                    (click)="movePage(pageIndex, -1)" class="page-action">
                                </i>
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                    nz-icon nzType="down-square" [nzTheme]="'twotone'" nz-tooltip
                                    [ngClass]="{'disabled': pageIndex === selectedTraining.pages.length - 1}"
                                    nzTooltipTitle="Move document down in list" (click)="movePage(pageIndex, 1)"
                                    class="page-action">
                                </i>
                                <i *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                    nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'" nz-tooltip
                                    nzTooltipTitle="Delete Page" nz-popconfirm nzPopconfirmTitle="Delete this Page?"
                                    [nzPopconfirmTrigger]="'click'" [nzPopconfirmPlacement]="'right'"
                                    (nzOnConfirm)="confirmDeletePage(pageIndex)" class="page-action">
                                </i>

                            </div>
                            <div>
                                <h3 *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                    style="text-align: center;margin-bottom:30px;">
                                    <p nz-paragraph (nzContentChange)="pageContentChanged($event, pageIndex, 'title')"
                                        nzEditable [(nzContent)]="page.title">
                                    </p>
                                </h3>
                                <span
                                    *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                                    <h3 style="text-align: center;margin-bottom:30px;">{{page.title}}</h3>
                                </span>
                            </div>

                            <div>
                                <span style="font-size:16px;">
                                    <p *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                        nz-paragraph (nzContentChange)="pageContentChanged($event, pageIndex, 'intro')"
                                        nzEditable [(nzContent)]="page.intro"></p>
                                    <span
                                        *ngIf="mode === 'Preview' || selectedTraining.status === 'locked' || production === 'true'">
                                        {{page.intro}}
                                    </span>
                                </span>
                            </div>
                            <div
                                *ngIf="page.type === 'file' && (mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false')">
                                <button
                                    *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                    nz-button nzType="primary" nzSize="small" (click)="uploadNewVersion()">
                                    <i nz-icon nzType="upload" [nzTheme]="'outline'"></i>
                                    <span style="font-size:12px;">Upload New Version</span>
                                </button>
                                <div
                                    style="text-align:center;display:block;width:100%;margin-top:10px;margin-bottom:5px;font-size:12px;">
                                    <nz-table nzSize="small" nzBordered="false" nzShowPagination="false"
                                        [nzData]="fileService.getFile(page.file).versions"
                                        style="width:100%;background-color: #fafafa;font-size:12px;display:inline-block;">
                                        <thead>
                                            <tr style="font-size:12px;">
                                                <th>Version</th>
                                                <th>Comments</th>
                                                <th>Date Uploaded</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let version of fileService.getFile(page.file).versions; let i = index;"
                                                [ngClass]="{'current-version': currentVersionIndex === i}"
                                                (click)="viewVersion(i)"
                                                style="cursor: pointer;font-size:12px;background-color: white;line-height:10px;">
                                                <td style="font-size:12px;width:10%;">
                                                    {{ version.version }}
                                                </td>
                                                <td style="font-size:12px;width:50%;">
                                                    {{ version.changeLog }}
                                                </td>
                                                <td style="font-size:12px;width:25%;">
                                                    {{ version.dateUploaded | date:'medium'}}
                                                </td>
                                                <td style="font-size:14px;width:15%;text-align: center;">
                                                    <i nz-icon nzType="download" [nzTheme]="'outline'" nz-tooltip
                                                        nzTooltipTitle="Download Document"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </nz-table>
                                </div>
                                <nz-modal [(nzVisible)]="isNewVersionModalVisible"
                                    [nzTitle]="fileService.getFile(page.file).name" nzWidth="60%" nzOkDisabled="false"
                                    nzCancelDisabled="false" (nzOnCancel)="dismissNewVersionModal()"
                                    (nzOnOk)="handleNewVersionContinue()">
                                    <div style="display: inline-block;width:20%;padding-bottom:30px;">
                                    </div>
                                    <div style="display:inline-block;width:80%;">
                                        <h3 nz-title>
                                            What actions should be taken as a result of the changes you have made?
                                        </h3>
                                    </div>
                                    <div style="clear: both;"></div>
                                    <div style="display: block;">
                                        <nz-radio-group [(ngModel)]="changeLevel">
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="major">Reset
                                                training
                                                status for all responsible users. </label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="minor">Notify
                                                all
                                                responsible users.</label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="patch">No action
                                                needed.</label>
                                        </nz-radio-group>
                                        <p *ngIf="error1" style="color:red;">Please select one of the 3 options.</p>
                                        <p>
                                            Please describe the changes you have made.
                                        </p>
                                        <textarea rows="4" nz-input [(ngModel)]="newVersion.changeLog"></textarea>
                                        <p *ngIf="error2" style="color:red;">Please enter a description of the
                                            changes
                                            made.</p>

                                    </div>
                                </nz-modal>
                                <nz-modal [(nzVisible)]="lockTrainingModalIsVisible" [nzTitle]="selectedTraining.title"
                                    nzWidth="60%" nzOkDisabled="false" nzCancelDisabled="false"
                                    (nzOnCancel)="cancelLockTraining()" (nzOnOk)="handleLockTraining()">
                                    <div style="display: inline-block;width:20%;padding-bottom:30px;">
                                    </div>
                                    <div style="display:inline-block;width:80%;">
                                        <h3 nz-title>
                                            What actions should be taken as a result of the changes that were made?
                                        </h3>
                                    </div>
                                    <div style="clear: both;"></div>
                                    <div style="display: block;">
                                        <nz-radio-group [(ngModel)]="changeLevel">
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="major">Reset
                                                training
                                                status for all responsible users. </label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="minor">Notify
                                                all
                                                responsible users.</label>
                                            <label nz-radio
                                                [ngStyle]="{display: 'block', height: '30px',lineHeight: '30px'}"
                                                nzValue="patch">No action
                                                needed.</label>
                                        </nz-radio-group>
                                        <p *ngIf="error1" style="color:red;">Please select one of the 3 options.</p>
                                        <p>
                                            Please describe the changes you have made.
                                        </p>
                                        <textarea rows="4" nz-input [(ngModel)]="newVersion.changeLog"></textarea>
                                        <p *ngIf="error2" style="color:red;">Please enter a description of the
                                            changes
                                            made.</p>

                                    </div>
                                </nz-modal>
                            </div>
                            <div style="margin-top:20px;">
                                <div *ngIf="page.type !== 'url' && page.type !== 'html'"
                                    style="margin-top:20px;text-align: center;">
                                    <span style="display:inline-block;color:#aaaaaa;">
                                        Version {{ pageFileHash[page._id].versions[currentVersionIndex].version }}
                                    </span>
                                </div>
                                <div style="text-align: center;margin-top:5px;">
                                    <vg-player (onPlayerReady)="onPlayerReady($event)"
                                        *ngIf="page.type === 'file' && pageFileHash[page._id] && pageFileHash[page._id].iconType === 'video'">

                                        <vg-controls>
                                            <vg-play-pause></vg-play-pause>
                                            <vg-playback-button></vg-playback-button>

                                            <vg-time-display vgProperty="current" vgFormat="mm:ss"></vg-time-display>

                                            <vg-scrub-bar>
                                                <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                                                <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
                                            </vg-scrub-bar>

                                            <vg-time-display vgProperty="left" vgFormat="mm:ss"></vg-time-display>
                                            <vg-time-display vgProperty="total" vgFormat="mm:ss"></vg-time-display>

                                            <vg-track-selector></vg-track-selector>
                                            <vg-mute></vg-mute>
                                            <vg-volume></vg-volume>

                                            <vg-fullscreen></vg-fullscreen>
                                        </vg-controls>
                                        <video [vgMedia]="media" #media id="singleVideo" preload="'auto'"
                                            [src]="safeFileUrl$ | async" crossorigin></video>
                                        <!--
                                        <video [vgMedia]="media" #media id="singleVideo" preload="'auto'" [src]="(file$ | async)?.versions[currentVersionIndex].safeUrl" crossorigin></video>
                                            -->
                                    </vg-player>
                                </div>
                                <div *ngIf="page.type === 'file' && pageFileHash[page._id] && pageFileHash[page._id].iconType !== 'video'"
                                    style="text-align: center;height:90%;margin-top:5px;">
                                    <div style="width:100%;height:900px;display:inline-block;">
                                        <iframe [src]="(safeFileUrl$ | async)" allowfullscreen width="100%"
                                            height="100%">
                                        </iframe>
                                    </div>
                                </div>
                                <div *ngIf="page.type === 'url'" style="text-align: center;height:90%;margin-top:5px;">
                                    <div style="display: block;color:#bbbbbb;">
                                        {{ page.url }}
                                    </div>
                                    <div style="width:100%;height:900px;display:inline-block;">
                                        <iframe [src]="safeUrlHash[page.url]" allowfullscreen width="100%"
                                            height="100%">
                                        </iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="currentPageId === 'assessment'" class="page">
                    <h3 style="text-align: center;margin-bottom:30px;">Assessment</h3>
                    <div *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'">
                        <div style="display:block;margin-bottom:10px;">
                            <div>
                                <div style="text-align: left;font-size:12px;">
                                    <div style="margin-top: 10px;position:relative;">
                                        <nz-alert nzType="info" [nzMessage]="assessmentTitleTemplate"
                                            [nzDescription]="assessmentDescriptionTemplate" nzShowIcon
                                            nzCloseable="true" [nzCloseText]="assessmentCloseTemplate"
                                            style="margin-bottom:20px;">
                                        </nz-alert>
                                        <ng-template #assessmentCloseTemplate>
                                            <i nz-icon nzType="close-circle" [nzTheme]="'twotone'"
                                                [nzTwotoneColor]="'red'" style="font-size: 24px;"></i>
                                        </ng-template>
                                        <ng-template #assessmentTitleTemplate>
                                            <div style="width:100%;padding:0 20px 20px 0;">
                                                Welcome to the Assessment Wizard. This is where you setup the assessment
                                                for this training.
                                            </div>
                                        </ng-template>
                                        <ng-template #assessmentDescriptionTemplate>
                                            <p>
                                                Select the toggle to activate an assessment for this training.
                                            </p>
                                            <p>
                                                Once activated, you can set the passing grade for this training. Users
                                                are required to
                                                score above or equal to the passing grade in order to complete the
                                                training.
                                            </p>
                                            <p>
                                                Building your assessment is easy. Selecting the <span
                                                    style="color:blue;">Add New Question</span> button brings up
                                                the New Question dialog. Pretty straight forward.
                                            </p>
                                            <p>
                                                When you are done inputing your questions, give it a spin by switching
                                                to <span style="color:blue;">Preview</span> mode (the mode
                                                dropdown menu is located in the training header).
                                            </p>
                                            <p>
                                                Questions are displayed in a list. Selecting a question opens the
                                                questions panel
                                                that shows the question along with all of the choices, with the correct
                                                choice being tagged
                                                with a <i nz-icon nzType="check" [nzTheme]="'outline'"
                                                    style="font-size:16px;vertical-align: baseline;color:#52c41a;"></i>.

                                            </p>
                                        </ng-template>

                                    </div>
                                </div>
                            </div>
                            <div style="display:inline-block;">
                                <nz-switch nzSize="small" [(ngModel)]="selectedTraining.useAssessment"
                                    (ngModelChange)="saveTraining(false)"></nz-switch>
                            </div>
                            <div *ngIf="!selectedTraining.useAssessment" style="display:inline-block;margin-left:20px;">
                                <label>Assessment page is disabled!</label>
                            </div>
                            <div *ngIf="selectedTraining.useAssessment" style="display:inline-block;margin-left:20px;">
                                <label>Assessment page is enabled</label>
                            </div>
                        </div>
                        <div *ngIf="selectedTraining.useAssessment">
                            <div style="margin-bottom: 10px;">
                                <div style="width:20%;text-align: center;display:inline-block;">
                                    <label style="font-size:12px;color:#bbbbbb;">Passing
                                        Grade</label>
                                </div>
                                <div style="width:70%;text-align: left;display:inline-block;padding-left:10px;">
                                    <nz-input-number nzSize="small" nzId="passingGrade" class="foo"
                                        style="font-size:12px;" (ngModelChange)="assessmentChanged($event)"
                                        [(ngModel)]="selectedTraining.assessment.passingGrade" [nzMin]="0" [nzMax]="100"
                                        [nzStep]="5">
                                    </nz-input-number>
                                    <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp;%</span>
                                </div>
                            </div>

                            <nz-modal [(nzVisible)]="questionEditorVisible" nzTitle="Question Editor"
                                (nzOnCancel)="handleQuestionEditCancel()" (nzOnOk)="updateQuestion()" nzWidth="800">
                                <div style="background-color: white;">
                                    <div style="display:block;">
                                        <label
                                            style="display:inline-block;margin-right: 10px;font-size:18px;">Question</label>
                                        <input nz-input type="text" placeholder="Question Text" ngDefaultControl
                                            [(ngModel)]="currentQuestion.question"
                                            style="display:inline-block;margin-bottom:10px;width:500px;">
                                    </div>
                                    <div style="display:block;">
                                        <label
                                            style="display:inline-block;margin-right: 10px;font-size:18px;">Choices</label>
                                        <div style="display:block;padding-left:50px;">
                                            <div class="choice-container">
                                                <label class="choice-label">{{alpha[0]}}</label>
                                                <input nz-input type="text" placeholder="Choice" ngDefaultControl
                                                    [(ngModel)]="currentQuestion.choices[0]" class="choice-input">
                                                <div style="clear: both;"></div>
                                            </div>
                                            <div class="choice-container">
                                                <label class="choice-label">{{alpha[1]}}</label>
                                                <input nz-input type="text" placeholder="Choice" ngDefaultControl
                                                    [(ngModel)]="currentQuestion.choices[1]" class="choice-input">
                                                <div style="clear: both;"></div>
                                            </div>
                                            <div class="choice-container">
                                                <label class="choice-label">{{alpha[2]}}</label>
                                                <input nz-input type="text" placeholder="Choice" ngDefaultControl
                                                    [(ngModel)]="currentQuestion.choices[2]" class="choice-input">
                                                <div style="clear: both;"></div>
                                            </div>
                                            <div class="choice-container">
                                                <label class="choice-label">{{alpha[3]}}</label>
                                                <input nz-input type="text" placeholder="Choice" ngDefaultControl
                                                    [(ngModel)]="currentQuestion.choices[3]" class="choice-input">
                                                <div style="clear: both;"></div>
                                            </div>
                                            <div class="choice-container">
                                                <label class="choice-label">{{alpha[4]}}</label>
                                                <input nz-input type="text" placeholder="Choice" ngDefaultControl
                                                    [(ngModel)]="currentQuestion.choices[4]" class="choice-input">
                                                <div style="clear: both;"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display:block;margin-top: 10px;font-size:18px;">
                                        <label style="display:inline-block;margin-right: 10px;font-size:18px;">Correct
                                            Choice</label>
                                        <nz-radio-group [(ngModel)]="currentCorrectChoice">
                                            <label nz-radio [nzDisabled]="currentQuestion.choices[0] === undefined"
                                                nzValue="0">A</label>
                                            <label nz-radio [nzDisabled]="currentQuestion.choices[1] === undefined"
                                                nzValue="1">B</label>
                                            <label nz-radio [nzDisabled]="currentQuestion.choices[2] === undefined"
                                                nzValue="2">C</label>
                                            <label nz-radio [nzDisabled]="currentQuestion.choices[3] === undefined"
                                                nzValue="3">D</label>
                                            <label nz-radio [nzDisabled]="currentQuestion.choices[4] === undefined"
                                                nzValue="4">E</label>
                                        </nz-radio-group>
                                    </div>
                                </div>
                            </nz-modal>
                            <button
                                *ngIf="mode === 'Edit' && selectedTraining.status === 'unlocked' && production === 'false'"
                                nz-button nzType="primary" nzSize="small" style="margin-bottom:10px;"
                                (click)="addNewQuestion()">Add
                                New Question</button>
                            <nz-collapse nzAccordion="true">
                                <nz-collapse-panel [nzHeader]="headerTemplate"
                                    [nzActive]="itemIndex === currentQuestionIndex"
                                    *ngFor="let item of selectedTraining.assessment.items; index as itemIndex">
                                    <ng-template #headerTemplate>
                                        <div style="width:15%;display:inline-block;color:blue;">Question
                                            {{ itemIndex + 1 }}
                                        </div>
                                        <div
                                            style="vertical-align:middle;display:inline-block;width:80%;overflow: hidden;white-space: nowrap;">
                                            {{item.question}}
                                        </div>
                                    </ng-template>
                                    <!--
                                    <div style="float:right;width:84%;font-size:16px;margin-bottom:10px;">
                                        <input nz-input type="text" nzSize="small" placeholder="Question"
                                            ngDefaultControl [(ngModel)]="item.question" style="margin-bottom:10px;"
                                            (keydown.enter)="questionChanged($event, item, itemIndex)"
                                            (blur)="questionChanged($event, item, itemIndex)">
                                    </div>
                                    <div style="clear:both;"></div>
                                        -->

                                    {{ item.question }}
                                    <div style="font-weight:300;margin-top:10px;padding-left:25px;">
                                        <div *ngFor="let choice of item.choices; index as choiceIndex"
                                            style="width:100%;">
                                            <div *ngIf="choice !== ''">
                                                <div style="font-weight:300;width:25px;height:1em;float:left;">
                                                    <i *ngIf="item.correctChoice === choiceIndex" nz-icon nzType="check"
                                                        [nzTheme]="'outline'"
                                                        style="font-size:16px;vertical-align: baseline;color:#52c41a;"></i>

                                                </div>
                                                <div
                                                    style="display: inline-block;font-weight:300;width:30px;color:#bbbbbb;margin-bottom:5px;text-align: right;">
                                                    {{alpha[choiceIndex]}}&nbsp;)
                                                </div>
                                                <div style="display: inline-block;">
                                                    <span
                                                        style="font-weight:300;width:2%;color:#bbbbbb;margin-bottom:5px;">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                    {{ choice }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--
                                        <i class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon nzType="plus-square"
                                            theme="twotone" [nzTwotoneColor]="'#52c41a'"
                                            (click)="addNewChoice($event, itemIndex)"
                                            style="display:block;text-align:left;padding-left:50px;margin-bottom:10px;cursor: pointer;width:fit-content;"
                                            nz-tooltip nzTooltipTitle="Add new Choice"></i>
                                            -->
                                    <!--
                                    <div style="margin-top:10px;">
                                        The correct choice is
                                        <span *ngIf="item.correctChoice > -1" style="margin-left:10px;color:green;">
                                            {{ alpha[item.correctChoice] }}
                                        </span>
                                        <span *ngIf="item.correctChoice === -1" style="margin-left:10px;color:red;">
                                            Not Specified
                                        </span>
                                    </div>
                                    -->
                                    <div style="margin-top:20px;">
                                        <i nz-icon nzType="edit" [nzTheme]="'twotone'" nz-tooltip
                                            nzTooltipTitle="Edit Question" (click)="editQuestion(itemIndex)"
                                            style="cursor:pointer;font-size:16px;vertical-align: baseline;">
                                        </i>
                                        <i nz-icon nzType="delete" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                                            nz-tooltip nzTooltipTitle="Delete Question" nz-popconfirm
                                            nzPopconfirmTitle="Delete this Question?" [nzPopconfirmTrigger]="'click'"
                                            [nzPopconfirmPlacement]="'top'"
                                            (nzOnConfirm)="confirmDeleteQuestion(itemIndex)"
                                            style="cursor:pointer;font-size:16px;vertical-align: baseline;margin-left:20px;">
                                        </i>
                                    </div>
                                </nz-collapse-panel>
                            </nz-collapse>
                        </div>
                    </div>
                    <div *ngIf="production === 'true' || selectedTraining.status === 'locked' || mode === 'Preview'" style="position:relative;">
                        <div *ngIf="currentAssessmentItemIndex === -1 && !assessmentComplete">
                            <button nz-button nzType="primary" nzSize="small" (click)="beginAssessment()">Begin
                                Assessment</button>
                        </div>
                        <div
                            *ngIf="assessmentComplete && selectedTraining.status === 'unlocked' && production === 'false'">
                            <button nz-button nzType="primary" nzSize="small" (click)="resetAssessment()">Reset
                                Assessment</button>
                        </div>
                        <div *ngIf="currentAssessmentItemIndex > -1" style="margin-bottom:4px;">
                            <div>
                                <div style="display: inline-block;">
                                    <i nz-icon nzType="check-circle" theme="twotone" [nzTwotoneColor]="'#52c41a'"
                                        style="font-size: 24px;vertical-align: baseline;"></i>
                                    <span style="font-size:20px;margin-right:30px;">
                                        &nbsp;{{ assessmentCorrectCnt }}</span>
                                </div>
                                <div style="display: inline-block;">
                                    <i nz-icon nzType="close-circle" theme="twotone" [nzTwotoneColor]="'red'"
                                        style="font-size: 24px;vertical-align: baseline;display:inline-block;"></i>
                                    <span style="font-size:20px;margin-right:30px;">
                                        &nbsp;{{ assessmentIncorrectCnt }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div style="display:block;margin:20px ;">
                            <div *ngIf="assessmentComplete && passedAssessment" style="margin:20px 0;">
                                <nz-alert nzType="success" nzMessage="Congratulations, you passed!" nzShowIcon>
                                </nz-alert>
                            </div>
                            <div *ngIf="assessmentComplete && !passedAssessment" style="margin:20px 0;">
                                <nz-alert nzType="error" nzMessage="Sorry, you did not pass!" nzShowIcon></nz-alert>

                                <button nz-button nzType="primary" nzSize="small" (click)="retake()"
                                    style="display:block;margin-top:20px;">Retake</button>

                            </div>
                        </div>
                        <div *ngIf="assessmentInProgress && !assessmentComplete">
                            <div *ngFor="let item of selectedTraining.assessment.items; index as itemIndex"
                                [@questionSlide]="slideNewQuestionHash[itemIndex] ? 'in' : 'out'"
                                style="position:absolute;top:40px;left:600px;width:100%;height:200px;background-color: white;"
                                [ngStyle]="{'z-index': 10000 - itemIndex}">
                                <div style="width:100%;position:relative;padding:0">
                                    <div
                                        style="color:#bbbbbb;font-size:16px;font-weight:300;margin-right:20px;float:left;">
                                        Question
                                        {{ itemIndex + 1 }}
                                    </div>
                                    <div style="display: inline-block;font-size:16px;">
                                        <div style="color:black;font-weight: 300;">
                                            {{item.question}}
                                        </div>
                                    </div>
                                    <div style="padding:10px 0 0 0;">
                                        <nz-radio-group [(ngModel)]="assessmentResponseHash[itemIndex]"
                                            [nzDisabled]="showNext" style="display:block;"
                                            (ngModelChange)="answeredQuestion(itemIndex)">
                                            <div *ngFor="let choice of item.choices; index as choiceIndex"
                                                style="width:100%;padding-left:50px;position:relative;margin:10px 0;"
                                                [ngClass]="">
                                                <div *ngIf="choice !== ''">
                                                    <i *ngIf="(assessmentResponseHash[itemIndex] !== null || assessmentResponseHash[itemIndex] !== undefined) && assessmentResponseHash[itemIndex] === choiceIndex && assessmentResponseHash[itemIndex] !== item.correctChoice"
                                                        nz-icon nzType="close-circle" theme="twotone"
                                                        [nzTwotoneColor]="'red'"
                                                        style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                    <i *ngIf="(assessmentResponseHash[itemIndex] !== null || assessmentResponseHash[itemIndex] !== undefined) && assessmentResponseHash[itemIndex] === choiceIndex && assessmentResponseHash[itemIndex] === item.correctChoice"
                                                        nz-icon nzType="check-circle" theme="twotone"
                                                        [nzTwotoneColor]="'#52c41a'"
                                                        style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                    <i *ngIf="showNext && item.correctChoice === choiceIndex" nz-icon
                                                        nzType="check-circle" theme="twotone"
                                                        [nzTwotoneColor]="'#52c41a'"
                                                        style="position:absolute;top:0;left:20px;font-size: 20px;vertical-align: top;"></i>
                                                    <label nz-radio [nzValue]="choiceIndex"
                                                        style="display:inline-block;"></label>
                                                    <span
                                                        style="font-weight:300;color:#bbbbbb;">{{alpha[choiceIndex]}}&nbsp;)&nbsp;&nbsp;</span>
                                                    <span
                                                        style="font-size:14px;color:black;font-weight: 300;">{{choice}}</span>
                                                </div>
                                            </div>
                                        </nz-radio-group>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="showNext" style="position:absolute;top:330px;left:0;">
                            <button nz-button nzType="primary" nzSize="small" (click)="nextQuestion()">Next
                                Question</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>