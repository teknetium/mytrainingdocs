<div *ngIf="selectedTraining" [ngClass]="{'training-viewer': !fullscreen, 'training-viewer-fullscreen': fullscreen}">
    <div class="training-header">
        <div>
            <i nz-icon nzType="close-square" [nzTheme]="'twotone'" [nzTwotoneColor]="'red'"
                (click)="closeViewer()"
                style="position:absolute;top:10px;right:10px;cursor:pointer;font-size:24px;vertical-align: baseline;"
                nz-tooltip nzTooltipTitle="Close Training"></i>
        </div>
        <div>
            <i *ngIf="!fullscreen" nz-icon nzType="fullscreen" [nzTheme]="'outline'" (click)="fullscreen = true"
                style="position:absolute;top:50px;right:10px;cursor:pointer;font-size:24px;vertical-align: baseline;" nz-tooltip
                nzTooltipTitle="Expand"></i>
            <i *ngIf="fullscreen" nz-icon nzType="fullscreen-exit" [nzTheme]="'outline'" (click)="fullscreen = false"
                style="position:absolute;top:50px;right:10px;cursor:pointer;font-size:24px;vertical-align: baseline;" nz-tooltip
                nzTooltipTitle="Shrink"></i>
        </div>
        <div class="header-left">
            <i [ngClass]="selectedTraining.iconClass" style="display: block;font-size:40px;cursor: pointer;"
                [ngStyle]="{'color': selectedTraining.iconColor}" (click)="isIconSelectModalVisible = true"></i>

            <div *ngIf="mode === 'edit'" [style.color]="iconColor" [cpPosition]="'right'"
                [cpPositionRelativeToArrow]="true" (colorPickerChange)="onColorChange($event)"
                [(colorPicker)]="selectedTraining.iconColor" style="cursor: pointer;"
                [ngStyle]="{'color': selectedTraining.iconColor}" nz-tooltip nzTooltipPlacement="bottom"
                nzTooltipTitle="Select icon color">
                <i class="fas fa-palette" style="font-size:14px;color:red;"></i>
            </div>
        </div>
        <div class="header-middle">
            <div class="middle-top">
                <div style="display: inline-block;">
                    <p *ngIf="mode === 'edit'" nz-paragraph style="color:black;margin-bottom:0;"
                        (nzContentChange)="contentChanged($event, 'title')" nzEditable
                        [(nzContent)]="selectedTraining.title">
                    </p>
                    <span *ngIf="mode === 'preview'">{{selectedTraining.title}}</span>
                </div>
            </div>
            <div class="middle-bottom">
            </div>
        </div>
        <div class="header-right" style="margin-top:5px;">
            <div style="display:block;">
                <i nz-icon nzType="clock-circle" [nzTheme]="'twotone'" (click)="dataItemIndex = 0"
                    style="display:inline-block;cursor:pointer;font-size:16px;vertical-align: baseline;" nz-tooltip
                    nzTooltipTitle="Estimated Time To Complete"></i>&nbsp;
                    <span *ngIf="mode === 'view'">{{ selectedTraining.estimatedTimeToComplete}}</span>
                <nz-input-number *ngIf="mode === 'edit'" nzSize="small" nzId="estTimeToComplete" class="foo" style="font-size:12px;"
                    [(ngModel)]="selectedTraining.estimatedTimeToComplete" [nzMin]="10" [nzMax]="240" [nzStep]="5">
                </nz-input-number>
                <span style="display:inline-block;font-size:12px;">&nbsp;&nbsp; minutes</span>
            </div>

            <div style="display:block;">
                <i nz-icon nzType="idcard" [nzTheme]="'twotone'" [nzTwotoneColor]="'magenta'"
                    (click)="viewTraining(item, i)"
                    style="display:inline-block;cursor:pointer;font-size:16px;vertical-align: baseline;" nz-tooltip
                    nzTooltipTitle="Job Title"></i>&nbsp;
                <p *ngIf="mode === 'edit'" nz-paragraph
                    style="display:inline-block;color:black;margin-bottom:0;font-size:14px;"
                    (nzContentChange)="contentChanged($event, 'jobTitle')" nzEditable
                    [(nzContent)]="selectedTraining.jobTitle">
                </p>
                <span *ngIf="mode === 'view'">&nbsp;{{selectedTraining.jobTitle}}</span>
            </div>
            <!--
                    <span style="margin-right:20px;font-size:20px;"> {{selectedTraining.jobTitle}}</span>
                    -->
            <div class="right-bottom">

            </div>

        </div>
        <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon" (nzOnCancel)="handleIconSelectCancel()"
            nzOkDisabled="false" (nzOnOk)="handleIconSelectConfirm()">
            <mtd-icon-picker (icon)="setIcon($event)"></mtd-icon-picker>
        </nz-modal>
    </div>
    <div style="width:100%; height: 90%; overflow: scroll;">
        <div class="main-content">
            <div *ngIf="!isOpen" class="toc-opener">
                <i nz-icon nzType="menu-unfold" [nzTheme]="'outline'" (click)="toggleTOC(true)"
                    style="cursor:pointer;font-size:24px;vertical-align: baseline;"></i>

            </div>
            <div [@tocToggle]="isOpen ? 'open' : 'closed'" class="toc">
                <div style="position: relative;text-align: left;">
                    <div class="toc-title">
                        Table of Contents
                        <i nz-icon nzType="menu-fold" [nzTheme]="'outline'" (click)="toggleTOC(false)"
                            style="float:right;cursor:pointer;font-size:24px;vertical-align: baseline;margin-left:20px;"></i>
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('intro')"
                        [ngClass]="{'active-toc':currentPageId === 'intro'}">
                        {{selectedTraining.introductionLabel}}
                    </div>
                    <div class="toc-entry" *ngFor="let page of selectedTraining.pages; index as i"
                        (click)="setCurrentPage(page._id)" [ngClass]="{'active-toc':currentPageId === page._id}">
                        {{page.title}}
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('assessment')"
                        [ngClass]="{'active-toc':currentPageId === 'assessment'}">
                        Assessment
                    </div>
                    <div class="toc-entry" (click)="setCurrentPage('ratings-comments')"
                        [ngClass]="{'active-toc':currentPageId === 'ratings-comments'   }">
                        Ratings & Comments
                    </div>
                </div>
            </div>
            <div class="page-container" [ngStyle]="{'margin-left.px': pageContainerMarginLeft}">
                <div *ngIf="currentPageId === 'intro'" class="page">
                    <div style="margin-top:50px;">
                        <h4>
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'introductionLabel')" nzEditable
                                [(nzContent)]="selectedTraining.introductionLabel">
                            </p>
                        </h4>
                        <span *ngIf="mode === 'view'">
                            <h4>{{selectedTraining.introductionLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'introduction')" nzEditable
                                [(nzContent)]="selectedTraining.introduction" style=""></p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.introduction}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:50px;">
                        <h4>
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummaryLabel')" nzEditable
                                [(nzContent)]="selectedTraining.execSummaryLabel">
                            </p>
                        </h4>
                        <span *ngIf="mode === 'view'">
                            <h4>{{selectedTraining.execSummaryLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'execSummary')" nzEditable
                                [(nzContent)]="selectedTraining.execSummary" style=""></p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.execSummary}}
                            </span>
                        </span>
                    </div>
                    <div style="margin-top:50px;">
                        <h4>
                            <p *ngIf="mode === 'edit'" nz-paragraph
                                (nzContentChange)="contentChanged($event, 'goalsLabel')" nzEditable
                                [(nzContent)]="selectedTraining.goalsLabel">
                            </p>
                        </h4>
                        <span *ngIf="mode === 'view'">
                            <h4>{{selectedTraining.goalsLabel}}</h4>
                        </span>
                    </div>

                    <div style="padding-left: 30px;">
                        <span style="font-size:14px;">
                            <p *ngIf="mode === 'edit'" nz-paragraph (nzContentChange)="contentChanged($event, 'goals')"
                                nzEditable [(nzContent)]="selectedTraining.goals" style="">
                            </p>
                            <span *ngIf="mode === 'view'">
                                {{selectedTraining.goals}}
                            </span>
                        </span>
                    </div>
                </div>

                <ng-container *ngFor="let page of selectedTraining.pages; index as pageIndex">
                    <div *ngIf="currentPageId === page._id" class="page">
                        <div style="">
                            <h3>
                                <p *ngIf="mode === 'edit'" nz-paragraph
                                    (nzContentChange)="pageContentChanged($event, pageIndex, 'title')" nzEditable
                                    [(nzContent)]="page.title">
                                </p>
                            </h3>
                            <span *ngIf="mode === 'view'">
                                <h3>{{page.title}}</h3>
                            </span>
                        </div>

                        <div style="padding-left: 30px;">
                            <span style="font-size:18px;">
                                <p *ngIf="mode === 'edit'" nz-paragraph
                                    (nzContentChange)="pageContentChanged($event, pageIndex, 'intro')" nzEditable
                                    [(nzContent)]="selectedTraining.introduction" style=""></p>
                                <span *ngIf="mode === 'view'">
                                    {{page.intro}}
                                </span>
                            </span>
                        </div>
                        <div *ngFor="let portlet of page.portlets; index as portletIndex"
                            style="width:100%;height:100%;">

                            <div *ngIf="mode === 'edit'">
                                <i style="font-size:30px;margin-top: 10px;" twoToneColor="#3f87f5" nz-icon
                                    nzType="file-unknown" theme="twotone" (click)="setContent(portlet)" nz-tooltip
                                    nzTooltipTitle="Change Content">
                                </i>
                            </div>
                            <div style="width:100%;height:100%;">
                                <div
                                    *ngIf="!(portlet.file === null) && fileService.getFile(portlet.file).iconType === 'image'">
                                    <img [src]="fileService.getFile(portlet.file).versions[0].url" alt="blah" />
                                </div>
                                <!-- this next block uses the filestack document viewer -->
                                <div *ngIf="!(portlet.file === null)  && previewDocTypes.includes(fileService.getFile(portlet.file).iconType)"
                                    style="width:100%;height:100%">
                                    <iframe [src]="privateDocumentHash[portlet._id]" allowfullscreen width="100%"
                                        height="100%">
                                    </iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    <nz-modal [(nzVisible)]="isFileSelectModalVisible" nzTitle="Select Document"
                        (nzOnCancel)="handleCancel()" nzOkDisabled="true">
                        <ul style="list-style-type:none;">
                            <li *ngFor="let item of files$ | async; index as i" class="fileList"
                                (click)="selectFile(item, i)" style="padding:5px 0;">
                                <div style="display: inline-block;">
                                    <i *ngIf="item.iconSource === 'ngZorro'" class="font-size-24"
                                        [twoToneColor]="item.iconColor" nz-icon [nzType]="item.iconClass"
                                        theme="twotone"></i>
                                    <i *ngIf="item.iconSource === 'fontawesome'" class="font-size-24"
                                        [ngStyle]="{'color': item.iconColor}" [ngClass]="item.iconClass"></i>
                                </div>
                                <div class="" style="display: inline-block;">
                                    &nbsp;&nbsp;&nbsp;&nbsp;{{ item.name }}
                                </div>
                            </li>
                        </ul>
                    </nz-modal>
                    <nz-modal [(nzVisible)]="isIconSelectModalVisible" nzTitle="Select Icon"
                        (nzOnCancel)="handleIconSelectCancel()" nzOkDisabled="false"
                        (nzOnOk)="handleIconSelectConfirm()">
                        <mtd-icon-picker (icon)="setIcon($event)"></mtd-icon-picker>
                    </nz-modal>
                </ng-container>
                <div *ngIf="currentPageId === 'ratings-comments'" class="page">
                    <h3>Ratings & Comments</h3>
                    <nz-rate [(ngModel)]="rating" style="display:block;text-align:left;"></nz-rate>
                </div>
                <div *ngIf="currentPageId === 'assessment'" class="page">
                    <h3>Assessment</h3>
                    <div>
                        <div style="margin-bottom:2px;">
                            Create a test to evaluate mastery of the content presented in this training. Questions are
                            multiple
                            choice and can have multiple correct choices. Each test must include at least 3 questions.
                        </div>
                        <label nz-checkbox [(ngModel)]="applyAssessment"
                            (ngModelChange)="applyAssessmentChanged($event)" style="display:block;margin:20px 0;"
                            nz-popconfirm nzPopconfirmTitle="Remove this assessment?" nzPopconfirmPlacement="bottom"
                            (nzOnConfirm)="deleteItemConfirm()" (nzOnCancel)="deleteItemCancel()">Use
                            this assessment</label>
                        <div>
                            <div *ngFor="let item of assessment.items; index as itemIndex"
                                style="width:90%;border-bottom: 1px solid #bbbbbb;">
                                <span style="display:inline-block;font-size:18px;margin-right:20px;">Question
                                    {{ itemIndex + 1 }}</span>

                                <span style="display: inline-block;width:80%;font-size:22px;">
                                    <p *ngIf="mode === 'edit'" nz-paragraph
                                        (nzContentChange)="questionChanged($event, itemIndex)" nzEditable
                                        [(nzContent)]="item.question" style="">
                                    </p>
                                    <span *ngIf="mode === 'view'">
                                        {{item.question}}
                                    </span>
                                </span>
                                <div style="padding-left:80px;">
                                    <ng-container *ngIf="mode === 'edit'">
                                        <span style="font-size:16px;">Choices - </span>
                                        <span style="font-size:12px;"> select the checkbox to indicate that the choice
                                            is correct. </span>

                                    </ng-container>
                                    <div *ngFor="let choice of item.choices; index as choiceIndex" style="width:100%;">
                                        <ng-container *ngIf="mode === 'edit'">
                                            <label nz-checkbox [(ngModel)]="choice.correct"
                                                (ngModelChange)="choiceContentChanged($event, itemIndex, choiceIndex, 'correct')"
                                                style="display:inline-block;">&nbsp;&nbsp;</label>
                                            <p nz-paragraph
                                                (nzContentChange)="choiceContentChanged($event, itemIndex, choiceIndex, 'text')"
                                                nzEditable [(nzContent)]="choice.text"
                                                style="display:inline-block;width:90%;">
                                        </ng-container>
                                        <div *ngIf="mode === 'view'">
                                            <label nz-checkbox style="display:inline-block;">&nbsp;&nbsp;</label>
                                            <span>{{choice.text}}</span>
                                        </div>
                                    </div>
                                    <i *ngIf="mode === 'edit'" class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon
                                        nzType="plus-square" theme="twotone" (click)="addNewChoice(itemIndex)"
                                        style="margin-bottom:10px;cursor: pointer;"></i>

                                </div>
                            </div>
                            <i *ngIf="mode === 'edit'" class="font-size-18" [twoToneColor]="'#3f87f5'" nz-icon
                                nzType="plus-square" theme="twotone" (click)="addNewQuestion()"
                                style="margin-top:10px;cursor: pointer;"></i>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>